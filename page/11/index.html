<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="心有希冀，目有繁星，追光而遇，沐光而行">
<meta property="og:type" content="website">
<meta property="og:title" content="鹿鹿祁">
<meta property="og:url" content="http://example.com/page/11/index.html">
<meta property="og:site_name" content="鹿鹿祁">
<meta property="og:description" content="心有希冀，目有繁星，追光而遇，沐光而行">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="鹿祁">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/page/11/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>鹿鹿祁</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">鹿鹿祁</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-schedule">

    <a href="/schedule/" rel="section"><i class="fa fa-calendar fa-fw"></i>日程表</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/10/22/mysql%E6%95%B0%E6%8D%AE%E5%BA%93-%E5%9F%BA%E7%A1%80-%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%89%E8%A3%85/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="鹿祁">
      <meta itemprop="description" content="心有希冀，目有繁星，追光而遇，沐光而行">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鹿鹿祁">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/10/22/mysql%E6%95%B0%E6%8D%AE%E5%BA%93-%E5%9F%BA%E7%A1%80-%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AE%89%E8%A3%85/" class="post-title-link" itemprop="url">mysql数据库-基础-数据库安装</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-10-22 22:41:13" itemprop="dateCreated datePublished" datetime="2023-10-22T22:41:13+08:00">2023-10-22</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/10/22/mysql%E6%95%B0%E6%8D%AE%E5%BA%93-%E5%9F%BA%E7%A1%80-%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BB%8B%E7%BB%8D/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="鹿祁">
      <meta itemprop="description" content="心有希冀，目有繁星，追光而遇，沐光而行">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鹿鹿祁">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/10/22/mysql%E6%95%B0%E6%8D%AE%E5%BA%93-%E5%9F%BA%E7%A1%80-%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BB%8B%E7%BB%8D/" class="post-title-link" itemprop="url">mysql数据库-基础-数据库介绍</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-10-22 22:41:08" itemprop="dateCreated datePublished" datetime="2023-10-22T22:41:08+08:00">2023-10-22</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/10/22/linux%E4%B9%8Bandroid%E7%8E%AF%E5%A2%83%E4%B8%8E%E5%91%BD%E4%BB%A4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="鹿祁">
      <meta itemprop="description" content="心有希冀，目有繁星，追光而遇，沐光而行">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鹿鹿祁">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/10/22/linux%E4%B9%8Bandroid%E7%8E%AF%E5%A2%83%E4%B8%8E%E5%91%BD%E4%BB%A4/" class="post-title-link" itemprop="url">linux之android环境与命令</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-10-22 22:40:22 / 修改时间：23:29:25" itemprop="dateCreated datePublished" datetime="2023-10-22T22:40:22+08:00">2023-10-22</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="一、Android-SDK配置"><a href="#一、Android-SDK配置" class="headerlink" title="一、Android SDK配置"></a>一、Android SDK配置</h4><p>（1）ADB：Android Debug Bridge，是用于电脑端连接android端的桥梁。</p>
<p>（2）访问网址“<a target="_blank" rel="noopener" href="http://tools.android-studio.org/index.php/sdk%E2%80%9D%E4%B8%8B%E8%BD%BD%E4%B8%8E%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%89%88%E6%9C%AC%E5%AF%B9%E5%BA%94%E7%9A%84Android">http://tools.android-studio.org/index.php/sdk”下载与操作系统版本对应的Android</a> SDK压缩包，并解压到操作系统任意目录即可。目前最新的SDK版本为24.4.1。</p>
<p>（3）配置环境变量“ANDROID_HOME”并设置到该SDK的主目录，如图所示。</p>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/dengqiang/20210819002121.png" alt="image-20210819002121292"></p>
<p>（4）将“ANDROID_HOME”目录下的“tools”、“platform-tools”和“build-tools”添加到“PATH”环境变量中，如图。</p>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/dengqiang/20210819002158.png" alt="image-20210819002158644"></p>
<p>再把 D:\AndroidADT\sdk\build-tools\23.0.1 添加到PATH环境变量中。</p>
<p>（5）打开命令行，运行命令“adb version”，如果正常运行，说明SDK已经配置完成。如图所示。</p>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/dengqiang/20210819002259.png" alt="image-20210819002259322"></p>
<p>将Nox的adb.exe命令复制到SDK目录下进行替换，使用新版本的adb.</p>
<p>将C:\Program Files (x86)\Nox\bin\adb.exe 复制到 D:\AndroidADT\sdk\platform-tools</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\Denny&gt;adb devicesList of devices attached127.0.0.1:62001 device运行上述命令，如果能够看到127.0.0.1:62001这台设备信息，说明ADB配置完成，接下来，电脑就可以直接操作android了。</span><br></pre></td></tr></table></figure>

<h4 id="二、夜神模拟器配置"><a href="#二、夜神模拟器配置" class="headerlink" title="二、夜神模拟器配置"></a>二、夜神模拟器配置</h4><p>当我们安装好了Android SDK后，我们就可以开始正式的基于Android的测试开发了。但是有时候为了调试方便，我们并不建议直接连接到真机上进行调试，尤其是在测试脚本还没有稳定的情况下，有可能对系统有一定破坏。所以建议读者使用Android模拟器进行调试。</p>
<p>目前市面上有很多Android模拟器工具可以选择，从速度，性能，可用性方面来看，目前做得比较好的几款模拟器是国产厂商提供的，比如夜神模拟器，蓝叠模拟器，逍遥模拟器等。本书将使用夜神模拟器为读者进行展示，夜神模拟器支持同时开启多个模拟器，并且支持多个Android版本的模拟。相对来说各方面都比较均衡。安装配置过程如下：</p>
<h5 id="1、下载安装夜神模拟器"><a href="#1、下载安装夜神模拟器" class="headerlink" title="1、下载安装夜神模拟器"></a>1、下载安装夜神模拟器</h5><p>直接去夜神模拟器官网（<a target="_blank" rel="noopener" href="https://www.yeshen.com/%EF%BC%89%E4%B8%8B%E8%BD%BD%E5%B9%B6%E5%AE%89%E8%A3%85%E6%9C%80%E6%96%B0%E7%89%88%E6%9C%AC%E6%A8%A1%E6%8B%9F%E5%99%A8%E3%80%82%E5%AE%89%E8%A3%85%E5%AE%8C%E6%88%90%E5%90%8E%E7%9B%B4%E6%8E%A5%E7%94%B5%E8%84%91%E4%B8%8A%E5%90%AF%E5%8A%A8%E3%80%82%E5%A6%82%E5%9B%BE%E6%89%80%E7%A4%BA%E3%80%82">https://www.yeshen.com/）下载并安装最新版本模拟器。安装完成后直接电脑上启动。如图所示。</a></p>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/dengqiang/20210819002949.png" alt="image-20210819002949067"></p>
<h5 id="2、夜神模拟器参数配置"><a href="#2、夜神模拟器参数配置" class="headerlink" title="2、夜神模拟器参数配置"></a>2、夜神模拟器参数配置</h5><p>夜神模拟器的默认设置主要是为游戏玩家进行配置的，并不太适合于日常工作用。所以我们需要对其进行一些参数的调整，以便于提高操作体验，降低资源消耗，更好的适配我们的电脑屏幕等。其中主要对以下参数进行修改：</p>
<p>（1）CPU内核和内存设置：根据读者的电脑自行配置，内存消耗建议1G以上。CPU数量请根据电脑CPU的内核数量进行同行配置，以便于夜神能够流畅运行。</p>
<p>（2）分辨率设置：默认情况下是为游戏玩家设置的“平板版”，即横屏，此处建议修改为“手机版”，即竖屏，将其分辨率设置为“720*1280”，这样的分辨率设置目前比较适用于绝大多数的电脑屏幕。当然，夜神模拟器提供了直接用鼠标拖放来调整窗口大小的功能，所以即使设置为其它分辨率，也影响不大。</p>
<p>（3）帧数设置：由于我们并不需要使用夜神来玩游戏，所以不需要太高的帧数，建议设置为20帧每秒即可，这样可以显著降低对CPU的消耗，如图所示。</p>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/dengqiang/20210819003037.png" alt="image-20210819003037628"></p>
<h5 id="3、确认ADB是否连接成功"><a href="#3、确认ADB是否连接成功" class="headerlink" title="3、确认ADB是否连接成功"></a>3、确认ADB是否连接成功</h5><p>将Nox的adb.exe命令复制到SDK目录下进行替换，使用新版本的adb.</p>
<p>将C:\Program Files (x86)\Nox\bin\adb.exe 复制到 D:\AndroidADT\sdk\platform-tools，然后运行下述命令，如果能够看到 127.0.0.1:62001 这台设备信息，说明ADB配置完成，接下来，电脑就可以直接操作android了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\Denny&gt;adb devicesList of devices attached127.0.0.1:62001 device</span><br></pre></td></tr></table></figure>

<h4 id="三、ADB常用命令"><a href="#三、ADB常用命令" class="headerlink" title="三、ADB常用命令"></a>三、ADB常用命令</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(1)    adb devices：显示当前运行的全部Android设备。(2)    adb -s 设备编号 指定命令：对某一设备执行命令。(3)    adb install -r 应用程序.apk：安装应用程序,-r表示replace覆盖安装。(4)    adb uninstall apk主包名：卸载应用程序。(5)    adb pull &lt;remote&gt; &lt;local&gt;：获取模拟器中的文件。(6)    adb push &lt;local&gt; &lt;remote&gt;：向模拟器中写文件。(7)    adb shell：进入模拟器的shell模式，可直接运行Linux命令。(8)    adb shell am start -n 主包名/主类名：启动应用程序。(9)    aapt查看某个apk的主包名和主类包。aapt dump badging D:\yibijizhang.apk，aapt程序位于SDK目录的build-tools目录下     的相应版本的SDK目录下。(10) adb shell am start -W -n 主包名/主类名：启动应用程序并查看启动时间。(11) adb shell am force-stop 应用包名：强制停止某个应用程序(12) adb logcat -s ActivityManager，启动后再手工启动App，可即时查看Activity 名称.(13) adb shell ps | finstr 主包名：查看某个进程是否在启动状态。(14) adb forward tcp:5555 tcp:8000：设置任意的端口号，作为主机向模拟器或设备的请求端口。(15) adb monkey 参数：在Android设备上执行Monkey测试。(16) adb kill-server：关闭adb服务。(17) adb start-server：启动adb服务。(18) adb connect 设备编号：让adb再次连接到某台设备上。(19) adb shell screencap -p /sdcard/screen.png：对设备进行截图并保存到/sdcard目录下。(20) adb shell pm list package: 列出所有的应用的包名。(21) adb shell pm list package -3: 列出所有第三方安装的应用程序包名。(22) adb shell pm dump 包名：列出指定应用的 dump 信息，里面有各种信息。(23) adb shell input text 文本内容：在设备的焦点位置发送文本内容，不能发送中文。(24) adb shell input keyevent 模拟按键：发送一个键盘事件，按键键码见本书296页。(25) adb shell input tap X Y：在设备的(X，Y)坐标位置发送一个触摸事件（即单击）。(26) adb shell input swipe X1 Y1 X2 Y2 持续时间：模拟滑动操作，整个过程持续多少秒。(27) adb shell input swipe X1 Y1 X2+1 Y2+1 2000：模拟在同一个位置实现2秒钟的长按。(28) adb shell uiautomator dump：获取当前页面的控件信息文件，可用于查找元素的属性。(29) adb shell dumpsys cpuinfo：查看应用程序消耗的CPU资源，可通过包名过滤。(30) adb shell dumpsys meminfo：查看应用程序消耗的内存资源，可通过包名过滤。(31) adb shell dumpsys battery：查看应用程序消耗的电量资源，可通过包名过滤。</span><br></pre></td></tr></table></figure>

<h4 id="四、真机操作"><a href="#四、真机操作" class="headerlink" title="四、真机操作"></a>四、真机操作</h4><h5 id="1、真机与模拟器的区别："><a href="#1、真机与模拟器的区别：" class="headerlink" title="1、真机与模拟器的区别："></a>1、真机与模拟器的区别：</h5><p>（1）运行性能与流畅度：真机性能好，运行流畅，而模拟器运行非常消耗电脑资源，也很不流畅。</p>
<p>（2）测试可行性：真机更适合于真实项目的测试，而模拟器通常更多用于调试而非测试。</p>
<p>（3）用户权限：真机通常情况下只有Linux的普通用户权限，而模拟器默认就是Linux的Root用户权限，可以完全不受限制，所以在测试过程中尽量使用真机模拟真实场景。</p>
<p>（4）网络连接：真机往往支持各类网络连接，比如移动信息，WIFI连接等，而模拟器仅使用WIFI。</p>
<p>（5） Android版本：Android由于其开源的特性，所以被全世界各个厂商进行了大量的改动，所以也导致APP的研发和兼容性测试非常耗时耗力，但是模拟器无法模拟此类情况。</p>
<p>（6）硬件设备：模拟器严格意义上来说只是使用电脑上的硬件，而真机厂商一般都是使用手机专用硬件，比如CPU，内存，硬盘，GPS，摄像头，陀螺仪等。</p>
<h5 id="2、打开移动端开发人员选项："><a href="#2、打开移动端开发人员选项：" class="headerlink" title="2、打开移动端开发人员选项："></a>2、打开移动端开发人员选项：</h5><p>如果需要使用电脑端通过ADB命令与手机端连接，首先必须要打开Android端的“开发人员选项”。通常的操作步骤为：进入Android的“系统设置”菜单，点击最后的“关于系统”或者“系统”菜单项，进入“关于手机”界面，在里面找到“版本号”这一行，连续在上面点击5次，即可让系统加载“开发人员选项”。但是由于不同的手机其操作菜单可能存在少许差异，请大家按照类似的操作进行即可，本教材的截图是根据华为的EMUI 9.0版本处理的。</p>
<p>进入开发人员选项设置界面，确保“开发人员选项”和“USB调试”选项均被勾选。</p>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/dengqiang/20210819003406.png" alt="image-20210819003406477"></p>
<h5 id="3、利用USB连接移动设备"><a href="#3、利用USB连接移动设备" class="headerlink" title="3、利用USB连接移动设备"></a>3、利用USB连接移动设备</h5><p>插入USB数据线，并选择“传输文件”的模式（注意：不同的Android版本菜单可能存在差异）。</p>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/dengqiang/20210819003433.png" alt="image-20210819003433219"></p>
<p>安装相应移动设备的厂商提供的手机助手之类的软件，以便于更好地安装对应版本的PC端驱动程序。启动手机助手后可能会存在类似这样的提示，选择确定，允许连接即可。</p>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/dengqiang/20210819003454.png" alt="image-20210819003454831"></p>
<p>如果手机助手能够连接成功，那么基本上可以确定ADB命令现在可以操作了。运行命令adb devices查看是否有真机的设备编号，如果没有的话，可以使用命令adb kill-server和adb start-server重启一下ADB服务，再重新连接一下真机设备确认。</p>
<h5 id="4、在真机上运行ADB命令："><a href="#4、在真机上运行ADB命令：" class="headerlink" title="4、在真机上运行ADB命令："></a>4、在真机上运行ADB命令：</h5><p>运行命令adb -s 设备编号 shell ls -l &#x2F;：表示查看 &#x2F; 根目录下的文件列表，会存在很多没有权限的提示信息，如图：</p>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/dengqiang/20210819003556.png" alt="image-20210819003556102"></p>
<p>这是因为在真机上，默认用户的权限都是一般用户，很多系统文件和文件夹是不允许普通用户访问的，这也是为什么我们很多时候为了获取更多操作权限而需要进行ROOT破解。</p>
<p>利用screencap命令在真机上截图并传输至电脑端：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">adb shell screencap -p /sdcard/myscreen.pngadb pull /sdcard/myscreen.png D:/android/myscreen.png</span><br></pre></td></tr></table></figure>

<p>上述命令可以实现对真机屏幕进行截图，并且将其图片保存在设备的&#x2F;sdcard目录下。&#x2F;sdcard这个目录非常特殊，这是一个专门给普通移动设备用户使用的目录，有正常的读写权限。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/10/22/shell%E8%84%9A%E6%9C%AC%E5%AE%9E%E6%88%98-%E9%87%8D%E7%82%B9%E6%96%87%E4%BB%B6%E7%9B%91%E6%8E%A7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="鹿祁">
      <meta itemprop="description" content="心有希冀，目有繁星，追光而遇，沐光而行">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鹿鹿祁">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/10/22/shell%E8%84%9A%E6%9C%AC%E5%AE%9E%E6%88%98-%E9%87%8D%E7%82%B9%E6%96%87%E4%BB%B6%E7%9B%91%E6%8E%A7/" class="post-title-link" itemprop="url">shell脚本实战-重点文件监控</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-10-22 22:39:53 / 修改时间：23:28:00" itemprop="dateCreated datePublished" datetime="2023-10-22T22:39:53+08:00">2023-10-22</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="一、敏感文件的监控原理"><a href="#一、敏感文件的监控原理" class="headerlink" title="一、敏感文件的监控原理"></a>一、敏感文件的监控原理</h4><p>判断一个文件是否被篡改：可以使用 md5sum 命令记录文件的md5的数字指纹。md5是一种摘要算法，是不可逆的加密，主要用于标识某个文件是否被篡改，或者用于保存密码。可以针对任意文件类型进行摘要。</p>
<p>在安全的状态下，针对敏感文件生成基线摘要数据，保存起来，下一次，再根据当前最新的文件状态生成一次，两次进行对比，可以知道是否被篡改。（潜在的风险：基线数据也被篡改，解决方案：离线保存）</p>
<p>另外，针对文本型文件，还可以继续深入，去比较哪些内容被篡改了。</p>
<h4 id="二、先进行基线操作"><a href="#二、先进行基线操作" class="headerlink" title="二、先进行基线操作"></a>二、先进行基线操作</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /optmkdir baselearn/filescd baselearn/cp ../learn/* ./files/md5sum /opt/learn/*  # md5无法针对文件夹进行摘要，所以，如果learn目录下有文件夹，则此命令无法成功执行find /opt/learn -type f | xargs md5sum    # 这是比较标准的用法find /opt/learn -type f | xargs md5sum &gt; /opt/baselearn/learn.md5 # 将基线数据保存起来# 利用md5sum -c base 来检查文件是否被篡改md5sum -c learn.md5.basemd5sum -c --quiet learn.md5.base  &gt; learn.diff   # 将对比失败的文件信息保存到 learn.diff</span><br></pre></td></tr></table></figure>

<h4 id="三、比较文件的具体修改内容"><a href="#三、比较文件的具体修改内容" class="headerlink" title="三、比较文件的具体修改内容"></a>三、比较文件的具体修改内容</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@centqiang baselearn]# diff /opt/learn/date.txt /opt/baselearn/files/date.txt 2d1&lt; 2021-08-18 15:44:06[root@centqiang baselearn]# diff /opt/baselearn/files/date.txt /opt/learn/date.txt 1a2&gt; 2021-08-18 15:44:06#比较两个文件内容的不同之处：d 代表 删除，a 代表新增， c 代表修改# 如何检测被检测目录下有新的文件diff /opt/learn/  /opt/baselearn/files/diff /opt/learn/  /opt/baselearn/files/ | grep ^diff  | awk &#x27;&#123;print $2&#125;&#x27;  # 列出内容发生变化的文件名diff /opt/learn/  /opt/baselearn/files/ | grep ^Only   # 列出文件新增或删除的信息# 继续基于上述信息，通过sed进行替换，拼接出完成的文件名diff /opt/learn/  /opt/baselearn/files/ | grep ^Only | sed -e &#x27;s/Only in //g&#x27; -e &#x27;s/: //g&#x27;</span><br></pre></td></tr></table></figure>

<h4 id="四、最终实现的版本"><a href="#四、最终实现的版本" class="headerlink" title="四、最终实现的版本"></a>四、最终实现的版本</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># 通过参数传递监控的目标目录和基线备份目录target=$1base=$2action=$3# 判断用户输入的两个文件夹是否存在if [ ! -d $target -o ! -d $base ]; then    echo &quot;参数一或者参数二指定的文件夹不存在.&quot;    exit 1fi# 如果第三个参数设置为new，则基线备份目录进行预处理if [ $action = &quot;new&quot; ]; then    mkdir $base/files    cp -r $target/* $base/files/    find $target -type f | xargs md5sum &gt; $base/learn.md5fi# 正式开始之前先清空日志文件echo &gt; $base/result.log# 通过对比基线MD5数据来确定文件是否在删除的情况md5sum -c --quiet $base/learn.md5  1&gt; $base/learn.diff 2&gt; /dev/nullremove=$(cat $base/learn.diff | grep &quot;FAILED open or read&quot; | sed &#x27;s/: FAILED open or read//g&#x27;)if [ $&#123;#remove&#125; -gt 0 ]; then    echo -e &quot;******** $target 目录有文件被删除: ********\n$remove\n&quot; | tee -a $base/result.logfi# 通过文件对比结果来确定哪些文件被修改了change=$(cat $base/learn.diff | grep &quot;FAILED$&quot; | sed &#x27;s/: FAILED//g&#x27;)if [ $&#123;#change&#125; -gt 0 ]; then     echo -e &quot;******** $target 目录中有文件被修改：********\n$change\n&quot; | tee -a $base/result.logfi# 列出文件变化情况，其中sed的替换分隔符可以使用 # 号list=$(diff $target  $base/files | grep ^Only | sed -e &#x27;s#Only in ##g&#x27; -e &#x27;s#/: #/#g&#x27; -e &#x27;s#: #/#g&#x27; -e &#x27;s#//#/#g&#x27;) if [ $(#list) -gt 0 ]; then    echo -e &quot;******** 两个目录中有文件的数量的变化：********\n$list\n&quot; | tee -a $base/result.logfi# 将运行过程的结果数据发送到指定邮箱，发送之前要判断，result.log里面有内容才发送# mail -s &quot;关键文件监控警报&quot; 15903523@qq.com &lt; $base/result.log</span><br></pre></td></tr></table></figure>

<p>要运行上述脚本，输入如下命令便可以看到类似下图的结果：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh keyfile.sh.old /opt/learn /opt/baselearn new或sh keyfile.sh.old /opt/learn /opt/baselearn check</span><br></pre></td></tr></table></figure>

<p>运行结果如下：</p>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai202204011137525.png" alt="image-20210819000917178"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/10/22/shell%E8%84%9A%E6%9C%AC%E5%AE%9E%E6%88%98-%E9%98%B2%E7%81%AB%E5%A2%99%E5%AE%89%E5%85%A8%E5%BA%94%E6%80%A5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="鹿祁">
      <meta itemprop="description" content="心有希冀，目有繁星，追光而遇，沐光而行">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鹿鹿祁">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/10/22/shell%E8%84%9A%E6%9C%AC%E5%AE%9E%E6%88%98-%E9%98%B2%E7%81%AB%E5%A2%99%E5%AE%89%E5%85%A8%E5%BA%94%E6%80%A5/" class="post-title-link" itemprop="url">shell脚本实战-防火墙安全应急</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-10-22 22:39:40 / 修改时间：23:27:43" itemprop="dateCreated datePublished" datetime="2023-10-22T22:39:40+08:00">2023-10-22</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="一、防火墙应急实战脚本"><a href="#一、防火墙应急实战脚本" class="headerlink" title="一、防火墙应急实战脚本"></a>一、防火墙应急实战脚本</h4><h5 id="1、需求描述"><a href="#1、需求描述" class="headerlink" title="1、需求描述"></a>1、需求描述</h5><ul>
<li>服务器监控脚本，当发现某一台主机向服务器进行SSH远程管理，在1分钟内输错密码3次，使用firewalld进行响应，禁止此IP再次连接，6个小时候后再次允许连接</li>
</ul>
<h5 id="2、实现步骤"><a href="#2、实现步骤" class="headerlink" title="2、实现步骤"></a>2、实现步骤</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# cat blockip.sh #!/bin/bash# 功能描述：分析系统登录日志，过滤异常IP地址，并通过防火墙禁用该IP# 强制退出时关闭所有后台进程#trap &#x27;kill $one_pid exit&#x27; EXIT INT# 日志文件路径logfile=/var/log/secureblockfile=/tmp/blockip.txtone_minute()&#123;  while :  do    # 获取计算机当前时间，以及1分钟前的时间，时间格式：    # %b(月份简写,Jan) %e（日期，1） %T（时间 18:00:00）    # LANG=C 的作用是否防止输出中文    # 使用local定义局部变量的好处是多个函数使用相同的变量名也不会冲突    local curtime_month=$(LANG=C date +&quot;%b&quot;)    local curtime_day=$(LANG=C date +&quot;%e&quot;)    local curtime_time=$(LANG=C date +&quot;%T&quot;)    local one_minus_ago=$(LANG=C date -d &quot;10 minutes ago&quot; +&quot;%T&quot;)    # 将当前时间转换为距离 1970-01-01 00:00:00 的秒数，方便后期计算    local curtime_seconds=$(LANG=C date +&quot;%s&quot;)    # 分析1分钟内所有的日志，如果密码失败则过滤倒数第4列的IP地址    # 通过管道对过滤的IP进行计数统计，提取密码失败次数大于等于3次的IP地址    # awk 调用外部shell的变量是，双引号在外面表示字符串(&quot;&#x27;&#x27;&quot;),单引号在外边便是数字(&#x27;&quot;&quot;&#x27;)    pass_fail_ip=$(awk &#x27;$1==&quot;&#x27;$curtime_month&#x27;&quot; &amp;&amp; $2==&#x27;&quot;$curtime_day&quot;&#x27; &amp;&amp; $3&gt;=&quot;&#x27;$one_minus_ago&#x27;&quot; &amp;&amp; $3&lt;=&quot;&#x27;$curtime_time&#x27;&quot; &#123; if($6==&quot;Failed&quot; &amp;&amp; $9!=&quot;invalid&quot;) &#123;print $(NF-3)&#125;&#125;&#x27; $logfile | awk &#x27;&#123;IP[$1]++&#125; END&#123; for(i in IP)&#123; if(IP[i]&gt;=3) &#123;print i&#125; &#125; &#125;&#x27;)    #echo &quot;$pass_fail_ip&quot;    # 将密码失败次数大于3次的IP写入黑名单文件    # 每次写入前需要判断黑名单中是否已存在该IP    # 写入黑名单时附加时间标记，实现仅将IP放入黑名单特定的时间    for i in $pass_fail_ip    do      if ! grep -q &quot;$i&quot; $blockfile      then        echo &quot;$curtime_seconds $i&quot; &gt;&gt; $blockfile      fi    done    # 提取无效账户登录服务器3次的IP地址，并将其加入黑名单    user_invalid_ip=$(awk &#x27;$1==&quot;&#x27;$curtime_month&#x27;&quot; &amp;&amp; $2==&#x27;&quot;$curtime_day&quot;&#x27; &amp;&amp; $3&gt;=&quot;&#x27;$one_minus_ago&#x27;&quot; &amp;&amp; $3&lt;=&quot;&#x27;$curtime_time&#x27;&quot; &#123; if($9==&quot;invalid&quot;) &#123;print $(NF-3)&#125;&#125;&#x27; $logfile | awk &#x27;&#123;IP[$1]++&#125; END&#123; for(i in IP)&#123; if(IP[i]&gt;=3) &#123;print i&#125; &#125; &#125;&#x27;)    for j in $user_invalid_ip    do      if ! grep -q &quot;$j&quot; $blockfile      then        echo &quot;$curtime_seconds $j&quot; &gt;&gt; $blockfile      fi    done    sleep 60  done&#125;# 记录了违规IP后将违规IP加入到防火墙策略中拒绝，并设置生效时间firewall_answer()&#123;#开启防火墙systemctl start firewalld &amp;&gt; /dev/nullif [ -f $blockfile ]then  for z in $(awk &#x27;&#123;print $2&#125;&#x27; $blockfile)  do    firewall-cmd --add-rich-rule=&quot;rule family=ipv4 source address=$z reject&quot; --timeout=1200  echo &quot;$z&quot;  donefi&#125;# 每隔20分钟检查一次黑名单，清理大于20分钟的黑名单IPclear_blockip()&#123;  while :  do    sleep 1200    # 将当前时间转换为距离1970-01-01 00:00:00的秒数，方便后期计算    local curtime_seconds=$(LANG=C date +&quot;%s&quot;)    # awk 调用外部shell变量的另一种方式是使用-v选项    # 当前时间去黑名单中的时间标记    # 大于等于1200秒（20分钟）则将其从黑名单中删除    tmp=$(awk -v now=$curtime_seconds &#x27;(now-$1)&gt;=1200 &#123;print $2&#125;&#x27; $blockfile)    for i in $tmp    do      sed -i &quot;/$i/d&quot;    done  done&#125;#&gt; $blockfileone_minute &amp;noe_pid=&quot;$!&quot;firewall_answerclear_blockip</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/10/22/shell%E8%84%9A%E6%9C%AC%E5%AE%9E%E6%88%98-%E7%B3%BB%E7%BB%9F%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="鹿祁">
      <meta itemprop="description" content="心有希冀，目有繁星，追光而遇，沐光而行">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鹿鹿祁">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/10/22/shell%E8%84%9A%E6%9C%AC%E5%AE%9E%E6%88%98-%E7%B3%BB%E7%BB%9F%E6%80%A7%E8%83%BD%E7%9B%91%E6%8E%A7/" class="post-title-link" itemprop="url">shell脚本实战-系统性能监控</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-10-22 22:39:28 / 修改时间：23:27:25" itemprop="dateCreated datePublished" datetime="2023-10-22T22:39:28+08:00">2023-10-22</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h5 id="1、需求描述"><a href="#1、需求描述" class="headerlink" title="1、需求描述"></a>1、需求描述</h5><ul>
<li>编写名为 sysmon.sh 的 Shell 监控脚本。</li>
<li>监控内容包括 CPU 使用率、内存使用率、根分区的磁盘占用率。</li>
<li>百分比只需精确到个位，如 7%、12%、23%等。</li>
<li>出现以下任一情况时告警：磁盘占用率超过 90%、CPU 使用率超过 80%、内存使用率超过 90%，告警邮件通过 mail 命令发送到指定邮箱。</li>
<li>结合 crond 服务，每半小时执行一次监控脚本。</li>
</ul>
<h5 id="2、实现步骤"><a href="#2、实现步骤" class="headerlink" title="2、实现步骤"></a>2、实现步骤</h5><ul>
<li><p>编写脚本</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# vi /root/sysmon.sh#!/bin/bash# 提取性能监控指标（磁盘占用、CPU 使用、内存使用）DUG=$(df -h | grep &quot;/$&quot; | awk &#x27;&#123;print $5&#125;&#x27; | awk -F% &#x27;&#123;print $1&#125;&#x27;)CUG=$(expr 100 - $(mpstat | tail -1 | awk &#x27;&#123;print $12&#125;&#x27; | awk -F. &#x27;&#123;print $1&#125;&#x27;))MUG=$(expr $(free | grep &quot;Mem:&quot; | awk &#x27;&#123;print $3&#125;&#x27;) \* 100 / $(free | grep &quot;Mem:&quot; | awk &#x27;&#123;print $2&#125;&#x27;))# 设置告警日志文件、告警邮箱ALOG=&quot;/tmp/alert.txt&quot;AMAIL=&quot;root@localhost&quot;# 判断是否记录告警if [ $DUG -gt 90 ]then echo &quot;磁盘占用率：$DUG %&quot; &gt;&gt; $ALOGfiif [ $CUG -gt 80 ]then echo &quot;CPU 使用率：$CUG %&quot; &gt;&gt; $ALOGfiif [ $MUG -gt 90 ]then echo &quot;内存使用率：$MUG %&quot; &gt;&gt; $ALOGfi# 判断是否发送告警邮件，最后删除告警日志文件if [ -f $ALOG ]then cat $ALOG | mail -s &quot;Host Alert&quot; $AMAIL rm -rf $ALOGfi[root@localhost ~]# chmod +x /root/sysmon.sh</span><br></pre></td></tr></table></figure>
</li>
<li><p>测试 sysmon.sh 脚本的执行情况</p>
<ul>
<li>首先确认有可用的邮件服务器（如 Postfix、Sendmail 等），执行sysmon.sh 脚本进行测试。</li>
<li>查收 root<a target="_blank" rel="noopener" href="https://github.com/localhost">@localhost</a> 的邮箱，确认告警邮件内容。</li>
</ul>
</li>
<li><p>设置 crontab 计划任务</p>
<ul>
<li><p>确认系统服务 crond 已经运行。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# /etc/init.d/crond statuscrond (pid 5839) 正在运行...</span><br></pre></td></tr></table></figure>
</li>
<li><p>添加 crontab 计划任务配置，每半小时调用一次 sysmon.sh 脚本程序。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# crontab -e*/30 * * * * /root/sysmon.sh</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/10/22/shell%E8%84%9A%E6%9C%AC%E5%AE%9E%E6%88%98-%E8%AE%B0%E5%BD%95%E5%B1%80%E5%9F%9F%E7%BD%91%E4%B8%BB%E6%9C%BA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="鹿祁">
      <meta itemprop="description" content="心有希冀，目有繁星，追光而遇，沐光而行">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鹿鹿祁">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/10/22/shell%E8%84%9A%E6%9C%AC%E5%AE%9E%E6%88%98-%E8%AE%B0%E5%BD%95%E5%B1%80%E5%9F%9F%E7%BD%91%E4%B8%BB%E6%9C%BA/" class="post-title-link" itemprop="url">shell脚本实战-记录局域网主机</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-10-22 22:39:11 / 修改时间：23:27:02" itemprop="dateCreated datePublished" datetime="2023-10-22T22:39:11+08:00">2023-10-22</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="一、记录局域网主机实战"><a href="#一、记录局域网主机实战" class="headerlink" title="一、记录局域网主机实战"></a>一、记录局域网主机实战</h4><h5 id="1、需求描述"><a href="#1、需求描述" class="headerlink" title="1、需求描述"></a>1、需求描述</h5><ul>
<li>编写名为 system.sh 的小脚本，记录局域网中各主机的 MAC 地址，保存到&#x2F;etc&#x2F;ethers文件中；若此文件已存在，应先转移进行备份；每行一条记录，第 1 列为 IP 地址，第2 列为对应的 MAC 地址。</li>
<li>检查有哪些主机开启了匿名 FTP 服务，扫描对象为&#x2F;etc&#x2F;ethers 文件中的所有 IP 地址，扫描的端口为 21。</li>
</ul>
<h5 id="2、实现步骤"><a href="#2、实现步骤" class="headerlink" title="2、实现步骤"></a>2、实现步骤</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# vi system.sh#!/bin/bash# 1. 定义网段地址、MAC 列表文件NADD=&quot;192.168.4.&quot;FILE=&quot;/etc/ethers&quot;# 2. 发送 ARP 请求，并记录反馈结果[ -f $FILE ] &amp;&amp; /bin/cp -f $FILE $FILE.old                     #备份原有文件HADD=1                                                         #定义起始扫描地址while [ $HADD -lt 254 ]do arping -c 2 -w 1 $&#123;NADD&#125;$&#123;HADD&#125; &amp;&gt; /dev/null if [ $? -eq 0 ] ; then arp -n | grep $&#123;NADD&#125;$&#123;HADD&#125; | awk &#x27;&#123;print $1,$3&#125;&#x27; &gt;&gt; $FILE fi let HADD++doneTARGET=$(awk &#x27;&#123;print $1&#125;&#x27; /etc/ethers)echo &quot;以下主机已开放匿名 FTP 服务：&quot;for IP in $TARGETdo wget ftp://$IP/ &amp;&gt; /dev/null if [ $? -eq 0 ] ; then echo $IP rm -rf index.html                                         #事先在 ftp 服务器上准备下载文件，测试后删除 fidone[root@localhost ~]# chmod +x system.sh[root@localhost ~]# ./sysem.sh[root@localhost ~]# cat /etc/ethers                     #确认记录结果</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/10/22/shell%E8%84%9A%E6%9C%AC%E5%9F%BA%E7%A1%80-%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1%E7%A8%8B%E5%BA%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="鹿祁">
      <meta itemprop="description" content="心有希冀，目有繁星，追光而遇，沐光而行">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鹿鹿祁">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/10/22/shell%E8%84%9A%E6%9C%AC%E5%9F%BA%E7%A1%80-%E8%AE%A1%E5%88%92%E4%BB%BB%E5%8A%A1%E7%A8%8B%E5%BA%8F/" class="post-title-link" itemprop="url">shell脚本基础-计划任务程序</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-10-22 22:38:54 / 修改时间：23:26:45" itemprop="dateCreated datePublished" datetime="2023-10-22T22:38:54+08:00">2023-10-22</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="一、一次性任务设置"><a href="#一、一次性任务设置" class="headerlink" title="一、一次性任务设置"></a>一、一次性任务设置</h4><h5 id="1、简介"><a href="#1、简介" class="headerlink" title="1、简介"></a>1、简介</h5><ul>
<li><p>使用 <code>at</code> 命令设置的计划任务只在指定的时间点执行一次，前提是对应的系统服务 <code>atd</code> 必须已经运行。需要注意的是，计划执行任务的时间、日期必须安排在当前系统的时刻之后，否则将无法正确设置计划任务。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#安装并启动 atd 服务[root@localhost ~]# yum -y install at[root@localhost ~]# systemctl start atd</span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="2、使用方法"><a href="#2、使用方法" class="headerlink" title="2、使用方法"></a>2、使用方法</h5><ul>
<li><p>设置一次性计划任务时，在 <code>at</code> 命令行中依次指定计划执行任务的时间、日期作为参数（若只指定时间则表示当天的该时间，若只指定日期则表示该日期的当前时间），确认后将进入带<code>at&gt;</code>提示符的任务编辑界面，每行设置一条执行命令，可以依次设置多条语句，最后按 <code>Ctrl＋D</code> 组合键提交任务。</p>
</li>
<li><p>所设置的命令操作将在计划的时间点被依次执行。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">at 16:00at 16:00 2021-12-30at now +5 minuts        #五分钟后执行</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# at 9:20 2021-12-30 at&gt; ls -lh                #直接输入命令，回显的内容系统自动发送本地邮件到 /var/spool/mail/ 目录中已用户名命名的文件中at&gt; &lt;EOT&gt;                #任务设置完成后按 ctrl+d 组合键提交job 2 at Thu Dec 30 09:20:00 2021</span><br></pre></td></tr></table></figure>
</li>
<li><p>查询及删除计划任务</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#atq查询未执行的计划任务[root@localhost ~]# atq2    Thu Dec 30 09:20:00 2021 a root#删除指定编号的at任务（执行过的无法删除）[root@localhost ~]# atrm 2</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="二、周期性任务设置"><a href="#二、周期性任务设置" class="headerlink" title="二、周期性任务设置"></a>二、周期性任务设置</h4><h5 id="1、简介-1"><a href="#1、简介-1" class="headerlink" title="1、简介"></a>1、简介</h5><ul>
<li>使用 <code>crontab</code> 命令设置的计划任务可以按预设的周期重复执行，从而大大减轻设置重复性系统管理任务的操作。</li>
<li>启用周期性任务也有一个前提条件，即对应的系统服务 <code>crond</code> 必须已经运行（默认系统已经开启）</li>
</ul>
<h5 id="2、crontab-配置文件及目录"><a href="#2、crontab-配置文件及目录" class="headerlink" title="2、crontab 配置文件及目录"></a>2、crontab 配置文件及目录</h5><ul>
<li>&#x2F;etc&#x2F;crontab (系统任务配置文件)</li>
<li>&#x2F;var&#x2F;spool&#x2F;cron&#x2F; （用户 cron 任务的配置文件存放目录）</li>
</ul>
<h5 id="3、使用-crontab命令管理用户的计划任务"><a href="#3、使用-crontab命令管理用户的计划任务" class="headerlink" title="3、使用 crontab命令管理用户的计划任务"></a>3、使用 crontab命令管理用户的计划任务</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-e：编辑计划任务列表。-u：指定所管理的计划任务属于哪个用户，默认是针对当前用户（自己），一般只有 root 用户有权限使用此选项（用于编辑、删除其他用户的计划任务）。-l：列表显示计划任务。-r：删除计划任务列表。</span><br><span class="line">[root@localhost ~]# crontab -e55 23 * * 7 /usr/bin/ls</span><br></pre></td></tr></table></figure>

<ul>
<li><code>crontab</code> 计划任务的配置格式</li>
</ul>
<table>
<thead>
<tr>
<th align="left">分钟</th>
<th align="left">小时</th>
<th align="left">日期</th>
<th align="left">月份</th>
<th align="left">星期</th>
<th align="left">执行的命令</th>
</tr>
</thead>
<tbody><tr>
<td align="left">01</td>
<td align="left">*</td>
<td align="left">*</td>
<td align="left">*</td>
<td align="left">*</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">02</td>
<td align="left">4</td>
<td align="left">*</td>
<td align="left">*</td>
<td align="left">*</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">22</td>
<td align="left">4</td>
<td align="left">*</td>
<td align="left">*</td>
<td align="left">0</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">42</td>
<td align="left">4</td>
<td align="left">1</td>
<td align="left">*</td>
<td align="left">*</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">50</td>
<td align="left">3</td>
<td align="left">2</td>
<td align="left">1</td>
<td align="left">*</td>
<td align="left"></td>
</tr>
</tbody></table>
<ul>
<li>字段说明</li>
</ul>
<table>
<thead>
<tr>
<th align="left">字段</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">分钟</td>
<td align="left">取值为 0～59 的任意整数</td>
</tr>
<tr>
<td align="left">小时</td>
<td align="left">取值为 0～23 的任意整数</td>
</tr>
<tr>
<td align="left">日期</td>
<td align="left">取值为 1～31 的任意整数（日期在该月份中必须有效）</td>
</tr>
<tr>
<td align="left">月份</td>
<td align="left">取值为 1～12 的任意整数</td>
</tr>
<tr>
<td align="left">星期</td>
<td align="left">取值为 0～7 的任意整数，0 或 7 代表星期日</td>
</tr>
<tr>
<td align="left">命令</td>
<td align="left">可以是普通的命令，也可以是自己编写的程序脚本</td>
</tr>
</tbody></table>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">减号“-”：可以表示一个连续的时间范围，如“1-4”表示整数 1、2、3、4。 逗号“,”：可以表示一个间隔的不连续范围，如“3, 4, 6, 8”。斜杠符号“/”：可以用来指定间隔频率，如在日期字段中的“*/3”表示每隔 3 天</span><br></pre></td></tr></table></figure>

<h5 id="4、示例"><a href="#4、示例" class="headerlink" title="4、示例"></a>4、示例</h5><ul>
<li>每天早上 <code>7:50</code>自动开启 <code>sshd</code> 服务，<code>22:50</code> 关闭 <code>sshd</code> 服务；</li>
<li>每隔五天清空一次 FTP 服务器公共目录<code>/var/ftp/pub</code> 中的数据；</li>
<li>每周六的 <code>7:30</code> 重新启动系统中的 <code>httpd</code> 服务；</li>
<li>每周一、周三、周五的下午 <code>17:30</code>，使用 tar 命令自动备份<code>/etc/httpd</code> 目录</li>
</ul>
<h5 id="5、其他操作"><a href="#5、其他操作" class="headerlink" title="5、其他操作"></a>5、其他操作</h5><ul>
<li><p>查看用户的计划任务列表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# crontab –l                    #默认查看的是用户自身[root@localhost ~]# crontab -l -u zhangsan</span><br></pre></td></tr></table></figure>
</li>
<li><p>删除用户的计划任务列表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# crontab –r</span><br></pre></td></tr></table></figure></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/10/22/shell%E8%84%9A%E6%9C%AC%E5%9F%BA%E7%A1%80-awk%E6%A0%BC%E5%BC%8F%E5%8C%96%E8%BE%93%E5%87%BA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="鹿祁">
      <meta itemprop="description" content="心有希冀，目有繁星，追光而遇，沐光而行">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鹿鹿祁">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/10/22/shell%E8%84%9A%E6%9C%AC%E5%9F%BA%E7%A1%80-awk%E6%A0%BC%E5%BC%8F%E5%8C%96%E8%BE%93%E5%87%BA/" class="post-title-link" itemprop="url">shell脚本基础-awk格式化输出</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-10-22 22:38:44 / 修改时间：23:26:21" itemprop="dateCreated datePublished" datetime="2023-10-22T22:38:44+08:00">2023-10-22</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="一、awk-常见用法"><a href="#一、awk-常见用法" class="headerlink" title="一、awk 常见用法"></a>一、awk 常见用法</h4><h5 id="1、命令格式"><a href="#1、命令格式" class="headerlink" title="1、命令格式"></a>1、命令格式</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk 选项 &#x27;模式或条件 &#123;编辑指令&#125;&#x27; 文件 1 文件 2 ···         #过滤并输出文件符条件的内容awk -f 脚本文件 文件 1 文件 2 ···                         #从脚本中调用编辑指令,过滤并输出内容</span><br></pre></td></tr></table></figure>

<ul>
<li>单引号加上大括号“{}”用于设置对数据进行的处理动作。</li>
<li>awk 可以直接处理目标文件，也可以通过“-f”读取脚本对目标文件进行处理</li>
<li>可以使用逻辑操作符“&amp;&amp;”，表示“与”，“||”表示“或”，“！”表示“非”；还可以进行简单的数学运算，如+、-、*、&#x2F;、%、^分别表示加、减、乘、除、取余和乘方</li>
</ul>
<h5 id="2、awk处理过程"><a href="#2、awk处理过程" class="headerlink" title="2、awk处理过程"></a>2、awk处理过程</h5><ul>
<li><p>举例：查找出&#x2F;etc&#x2F;passwd 的用户名、用户 ID、组 ID 等列</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk -F &#x27;:&#x27; &#x27;&#123;print $1,$3,$4&#125;&#x27; /etc/passwd</span><br></pre></td></tr></table></figure>
</li>
<li><p>awk 命令对&#x2F;etc&#x2F;passwd 文件的处理过程</p>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai202204011046784.png" alt="image-20220401104631674"></p>
</li>
</ul>
<h5 id="3、awk的特殊内建变量"><a href="#3、awk的特殊内建变量" class="headerlink" title="3、awk的特殊内建变量"></a>3、awk的特殊内建变量</h5><ul>
<li>FS：指定每行文本的字段分隔符，默认为空格或制表位。</li>
<li>NF：当前处理的行的字段个数。</li>
<li>NR：当前处理的行的行号（序数）。</li>
<li>$0：当前处理的行的整行内容。</li>
<li>$n：当前处理行的第 n 个字段（第 n 列）。</li>
<li>FILENAME：被处理的文件名。</li>
<li>RS：数据记录分隔，默认为\n，即每行为一条记录。</li>
</ul>
<h4 id="二、用法示例"><a href="#二、用法示例" class="headerlink" title="二、用法示例"></a>二、用法示例</h4><h5 id="1、按行输出文本"><a href="#1、按行输出文本" class="headerlink" title="1、按行输出文本"></a>1、按行输出文本</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27;&#123;print&#125;&#x27; test.txt                     #输出所有内容,等同于 cat test.txtawk &#x27;&#123;print $0&#125;&#x27; test.txt                 #输出所有内容,等同于 cat test.txtawk &#x27;NR==1,NR==3&#123;print&#125;&#x27; test.txt         #输出第 1~3 行内容awk &#x27;(NR&gt;=1)&amp;&amp;(NR&lt;=3)&#123;print&#125;&#x27; test.txt     #输出第 1~3 行内容awk &#x27;NR==1||NR==3&#123;print&#125;&#x27; test.txt         #输出第 1 行、第 3 行内容awk &#x27;(NR%2)==1&#123;print&#125;&#x27; test.txt         #输出所有奇数行的内容awk &#x27;(NR%2)==0&#123;print&#125;&#x27; test.txt         #输出所有偶数行的内容awk &#x27;/^root/&#123;print&#125;&#x27; /etc/passwd         #输出以 root 开头的行awk &#x27;/nologin$/&#123;print&#125;&#x27; /etc/passwd        #输出以 nologin 结尾的行awk &#x27;BEGIN &#123;x=0&#125; ; /\/bin\/bash$/&#123;x++&#125;;END &#123;print x&#125;&#x27; /etc/passwd        #统计以/bin/bash 结尾的行数,等同于 grep -c &quot;/bin/bash$&quot; /etc/passwdawk &#x27;BEGIN&#123;RS=&quot;&quot;&#125;;END&#123;print NR&#125;&#x27; /etc/squid/squid.conf             #统计以空行分隔的文本段落数</span><br></pre></td></tr></table></figure>

<h5 id="2、按字段输出文本"><a href="#2、按字段输出文本" class="headerlink" title="2、按字段输出文本"></a>2、按字段输出文本</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk &#x27;&#123;print $3&#125;&#x27; test.txt                 #输出每行中(以空格或制表位分隔)的第 3 个字段awk &#x27;&#123;print $1,$3&#125;&#x27; test.txt             #输出每行中的第 1、3 个字段awk -F &quot;:&quot; &#x27;$2==&quot;&quot;&#123;print&#125;&#x27; /etc/shadow     #输出密码为空的用户的 shadow 记录awk &#x27;BEGIN &#123;FS=&quot;:&quot;&#125;; $2==&quot;&quot;&#123;print&#125;&#x27; /etc/shadow         #输出密码为空的用户的 shadow 记录awk -F &quot;:&quot; &#x27;$7~&quot;/bash&quot;&#123;print $1&#125;&#x27; /etc/passwd             #输出以冒号分隔且第 7 个字段中包含/bash 的行的第 1 个字段awk &#x27;($1~&quot;nfs&quot;)&amp;&amp;(NF==8)&#123;print $1,$2&#125;&#x27; /etc/services     #输出包含 8 个字段且第 1 个字段中包含 nfs 的行的第 1、2 个字段awk -F &quot;:&quot; &#x27;($7!=&quot;/bin/bash&quot;)&amp;&amp;($7!=&quot;/sbin/nologin&quot;)&#123;print&#125;&#x27; /etc/passwd     #输出第 7 个字段既不为/bin/bash 也不为/sbin/nologin 的所有行</span><br></pre></td></tr></table></figure>

<h5 id="3、通过管道、双引号调用-Shell-命令"><a href="#3、通过管道、双引号调用-Shell-命令" class="headerlink" title="3、通过管道、双引号调用 Shell 命令"></a>3、通过管道、双引号调用 Shell 命令</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">awk -F: &#x27;/bash$/&#123;print | &quot;wc -l&quot;&#125;&#x27; /etc/passwd         #调用 wc -l 命令统计使用 bash 的用户个数,等同于 grep -c &quot;bash$&quot; /etc/passwd awk &#x27;BEGIN &#123;while (&quot;w&quot; | getline) n++ ; &#123;print n-2&#125;&#125;&#x27;     #调用 w 命令,并用来统计在线用户数awk &#x27;BEGIN &#123; &quot;hostname&quot; | getline ; print $0&#125;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/10/22/shell%E8%84%9A%E6%9C%AC%E5%9F%BA%E7%A1%80-sed%E4%BF%AE%E6%94%B9%E6%96%87%E6%A1%A3%E6%93%8D%E4%BD%9C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="鹿祁">
      <meta itemprop="description" content="心有希冀，目有繁星，追光而遇，沐光而行">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鹿鹿祁">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/10/22/shell%E8%84%9A%E6%9C%AC%E5%9F%BA%E7%A1%80-sed%E4%BF%AE%E6%94%B9%E6%96%87%E6%A1%A3%E6%93%8D%E4%BD%9C/" class="post-title-link" itemprop="url">shell脚本基础-sed修改文档操作</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-10-22 22:38:32 / 修改时间：23:26:06" itemprop="dateCreated datePublished" datetime="2023-10-22T22:38:32+08:00">2023-10-22</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="一、sed-工具"><a href="#一、sed-工具" class="headerlink" title="一、sed 工具"></a>一、sed 工具</h4><h5 id="1、介绍"><a href="#1、介绍" class="headerlink" title="1、介绍"></a>1、介绍</h5><ul>
<li>sed（Stream EDitor）是一个强大而简单的文本解析转换工具，可以读取文本，并根据指定的条件对文本内容进行编辑（删除、替换、添加、移动等），最后输出所有行或者仅输出处理的某些行。sed 也可以在无交互的情况下实现相当复杂的文本处理操作，被广泛应用于 Shell 脚本中，用以完成各种自动化处理任务。</li>
</ul>
<h5 id="2、工作流程"><a href="#2、工作流程" class="headerlink" title="2、工作流程"></a>2、工作流程</h5><ul>
<li>读取：sed 从输入流（文件、管道、标准输入）中读取一行内容并存储到临时的缓冲区中（又称模式空间，pattern space）。</li>
<li>执行：默认情况下，所有的 sed 命令都在模式空间中顺序地执行，除非指定了行的地址，否则 sed 命令将会在所有的行上依次执行。</li>
<li>显示：发送修改后的内容到输出流。再发送数据后，模式空间将会被清空。</li>
</ul>
<p><strong>在所有的文件内容都被处理完成之前，上述过程将重复执行，直至所有内容被处理完。</strong></p>
<blockquote>
<p>注意：默认情况下,所有的 sed 命令都是在模式空间内执行的，因此输入的文件并不会发生任何变化，除非是用重定向存储输出。</p>
</blockquote>
<h4 id="二、sed-使用"><a href="#二、sed-使用" class="headerlink" title="二、sed 使用"></a>二、sed 使用</h4><h5 id="1、sed-命令常见用法"><a href="#1、sed-命令常见用法" class="headerlink" title="1、sed 命令常见用法"></a>1、sed 命令常见用法</h5><ul>
<li><p>通常情况下调用 sed 命令有两种格式，如下所示。其中，“参数”是指操作的目标文件，当存在多个操作对象时用，文件之间用逗号“，”分隔；而 scriptfile 表示脚本文件，需要用“-f”选项指定，当脚本文件出现在目标文件之前时，表示通过指定的脚本文件来处理输入的目标文件。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed[选项] &#x27;操作&#x27; 参数 sed [选项] -f scriptfile 参数</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#常见选项-e 或--expression=：表示用指定命令或者脚本来处理输入的文本文件。-f 或--file=：表示用指定的脚本文件来处理输入的文本文件。-h 或--help：显示帮助。-n、--quiet 或 silent：表示仅显示处理后的结果。-i：直接编辑文本文件。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#常见操作a：增加，在当前行下面增加一行指定内容。c：替换，将选定行替换为指定内容。d：删除，删除选定的行。i：插入，在选定行上面插入一行指定内容。p：打印，如果同时指定行，表示打印指定行；如果不指定行，则表示打印所有内容；如果有非打印字符，则以 ASCII 码输出。其通常与“-n”选项一起使用。s：替换，替换指定字符。y：字符转换。</span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="2、用法示例"><a href="#2、用法示例" class="headerlink" title="2、用法示例"></a>2、用法示例</h5><ul>
<li><p>输出符合条件的文本（p 表示正常输出）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -n &#x27;p&#x27; test.txt            #输出所有内容,等同于 cat test.txtsed -n &#x27;3p&#x27; test.txt         #输出第 3 行sed -n &#x27;3,5p&#x27; test.txt        #输出 3~5 行sed -n &#x27;p;n&#x27; test.txt        #输出所有奇数行,n 表示读入下一行资料sed -n &#x27;n;p&#x27; test.txt        #输出所有偶数行,n 表示读入下一行资料sed -n &#x27;1,5&#123;p;n&#125;&#x27; test.txt    #输出第 1~5 行之间的奇数行(第 1、3、5 行)sed -n &#x27;10,$&#123;n;p&#125;&#x27; test.txt        #输出第 10 行至文件尾之间的偶数行sed -n &#x27;/the/p&#x27; test.txt        #输出包含 the 的行sed -n &#x27;4,/the/p&#x27; test.txt        #输出从第 4 行至第一个包含 the 的行sed -n &#x27;/the/=&#x27; test.txt        #输出包含 the 的行所在的行号,等号(=)用来输出行号sed -n &#x27;/^PI/p&#x27; test.txt         #输出以 PI 开头的行sed -n &#x27;/\&lt;wood\&gt;/p&#x27; test.txt    #输出包含单词 wood 的行,\&lt;、\&gt;代表单词边界</span><br></pre></td></tr></table></figure>
</li>
<li><p>删除符合条件的文本（d）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#为了方面查看效果，使用 nl 来计算行数nl test.txt | sed &#x27;3d&#x27;                 #删除第 3 行nl test.txt | sed &#x27;3,5d&#x27;             #删除第 3~5 行nl test.txt |sed &#x27;/cross/d&#x27;            #删除包含 cross 的行,原本的第 8 行被删除，删除不包含 cross 的行,用!符号表示取反操作,如&#x27;/cross/！d&#x27;sed &#x27;/^[a-z]/d&#x27; test.txt             #删除以小写字母开头的行sed &#x27;/\.$/d&#x27; test.txt                 #删除以&quot;.&quot;结尾的行sed &#x27;/^$/d&#x27; test.txt                 #删除所有空行</span><br></pre></td></tr></table></figure>
</li>
<li><p>替换符合条件的文本（在使用 sed 命令进行替换操作时需要用到 s（字符串替换）、c（整行&#x2F;整块替换）、y（字符转换）命令选项）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed &#x27;s/the/THE/&#x27; test.txt             #将每行中的第一个 the 替换为 THEsed &#x27;s/l/L/2&#x27; test.txt                 #将每行中的第 3 个 l 替换为 Lsed &#x27;s/the/THE/g&#x27; test.txt             #将文件中的所有 the 替换为 THEsed &#x27;s/o//g&#x27; test.txt                 #将文件中的所有 o 删除(替换为空串)sed &#x27;s/^/#/&#x27; test.txt                 #在每行行首插入#号sed &#x27;/the/s/^/#/&#x27; test.txt             #在包含 the 的每行行首插入#号sed &#x27;s/$/EOF/&#x27; test.txt             #在每行行尾插入字符串 EOFsed &#x27;3,5s/the/THE/g&#x27; test.txt         #将第 3~5 行中的所有 the 替换为 THEsed &#x27;/the/s/o/O/g&#x27; test.txt         #将包含 the 的所有行中的 o 都替换为 O</span><br></pre></td></tr></table></figure>
</li>
<li><p>迁移符合条件的文本（其中，H，复制到剪贴板；g、G，将剪贴板中的数据覆盖&#x2F;追加至指定行；w，保存为文件；r，读取指定文件；a，追加指定内容）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed &#x27;/the/&#123;H;d&#125;;$G&#x27; test.txt         #将包含the 的行迁移至文件末尾,&#123;;&#125;用于多个操作sed &#x27;1,5&#123;H;d&#125;;17G&#x27; test.txt         #将第 1~5 行内容转移至第 17 行后sed &#x27;/the/w out.file&#x27; test.txt         #将包含 the 的行另存为文件 out.filesed &#x27;/the/r /etc/hostname&#x27; test.txt #将文件/etc/hostname 的内容添加到包含 the 的每行以后sed &#x27;3aNew&#x27; test.txt                 #在第 3 行后插入一个新行,内容为 Newsed &#x27;/the/aNew&#x27; test.txt             #在包含 the 的每行后插入一个新行,内容为 Newsed &#x27;3aNew1\nNew2&#x27; test.txt         #在第 3 行后插入多行内容,中间的\n 表示换行</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用脚本编辑文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed &#x27;1,5&#123;H;d&#125;;17G&#x27; test.txt         #将第 1~5 行内容转移至第 17 行后#修改为下面操作vi opt.list    1,5H    1,5d    17Gsed -f opt.list test.txt</span><br></pre></td></tr></table></figure></li>
</ul>
<p>3、实战案例</p>
<ul>
<li><p>调整 vsftpd 服务配置：禁止匿名用户，但允许本地用户（也允许写入）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# vim local_only_ftp.sh#!/bin/bash# 指定样本文件路径、配置文件路径SAMPLE=&quot;/usr/share/doc/vsftpd-3.0.2/EXAMPLE/INTERNET_SITE/vsftpd.conf &quot;CONFIG=&quot;/etc/vsftpd/vsftpd.conf&quot;# 备份原来的配置文件,检测文件名为/etc/vsftpd/vsftpd.conf.bak 备份文件是否存在,若不存在则使用 cp 命令进行文件备份[ ! -e &quot;$CONFIG.bak&quot; ] &amp;&amp; cp $CONFIG $CONFIG.bak# 基于样本配置进行调整,覆盖现有文件sed -e &#x27;/^anonymous_enable/s/YES/NO/g&#x27; $SAMPLE &gt; $CONFIGsed -i -e &#x27;/^local_enable/s/NO/YES/g&#x27; -e &#x27;/^write_enable/s/NO/YES/g&#x27; $CONFIGgrep &quot;listen&quot; $CONFIG || sed -i &#x27;$alisten=YES&#x27; $CONFIG# 启动 vsftpd 服务,并设为开机后自动运行systemctl restart vsftpdsystemctl enable vsftpd[root@localhost ~]# chmod +x local_only_ftp.sh</span><br></pre></td></tr></table></figure></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/10/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/10/">10</a><span class="page-number current">11</span><a class="page-number" href="/page/12/">12</a><span class="space">&hellip;</span><a class="page-number" href="/page/22/">22</a><a class="extend next" rel="next" href="/page/12/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">鹿祁</p>
  <div class="site-description" itemprop="description">心有希冀，目有繁星，追光而遇，沐光而行</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">219</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">12</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">鹿祁</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  
  <script color='0,0,255' opacity='0.5' zIndex='-1' count='99' src="/lib/canvas-nest/canvas-nest.min.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>


  <script defer src="/lib/three/three.min.js"></script>


  















  

  

</body>
</html>

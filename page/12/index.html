<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="心有希冀，目有繁星，追光而遇，沐光而行">
<meta property="og:type" content="website">
<meta property="og:title" content="鹿鹿祁">
<meta property="og:url" content="http://example.com/page/12/index.html">
<meta property="og:site_name" content="鹿鹿祁">
<meta property="og:description" content="心有希冀，目有繁星，追光而遇，沐光而行">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="鹿祁">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/page/12/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>鹿鹿祁</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">鹿鹿祁</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-schedule">

    <a href="/schedule/" rel="section"><i class="fa fa-calendar fa-fw"></i>日程表</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/10/22/shell%E8%84%9A%E6%9C%AC%E5%9F%BA%E7%A1%80-shell%E6%95%B0%E7%BB%84%E4%B8%8E%E5%87%BD%E6%95%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="鹿祁">
      <meta itemprop="description" content="心有希冀，目有繁星，追光而遇，沐光而行">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鹿鹿祁">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/10/22/shell%E8%84%9A%E6%9C%AC%E5%9F%BA%E7%A1%80-shell%E6%95%B0%E7%BB%84%E4%B8%8E%E5%87%BD%E6%95%B0/" class="post-title-link" itemprop="url">shell脚本基础-shell数组与函数</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-10-22 22:38:18 / 修改时间：23:25:37" itemprop="dateCreated datePublished" datetime="2023-10-22T22:38:18+08:00">2023-10-22</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="一、数组"><a href="#一、数组" class="headerlink" title="一、数组"></a>一、数组</h4><p>shell支持一种特殊的变量-数组，数组是一组数据的集合，数组中的每个数据被称为一个数组元素，bash仅支持一维索引数组和关联数组，对数组大小没有限制</p>
<p>Shell 数组用括号（）来表示，元素用空格分隔，元素的下标与大部分编程语言类似由 0 开始</p>
<h5 id="1、基本语法"><a href="#1、基本语法" class="headerlink" title="1、基本语法"></a>1、基本语法</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">数组名=（value0 value1 value2 ...）</span><br><span class="line">数组名=（[0]=value [1]=value [2]=value ...）</span><br><span class="line">列表名=”value0 value1 value2 ...”数组名=（$列表名）</span><br><span class="line">数组名[0]=”value”数组名[1]=”value”数组名[2]=”value”......</span><br></pre></td></tr></table></figure>

<ul>
<li><p>获取数组长度</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# arr_number=(1 2 3 4 5);[root@localhost ~]# arr_length=$&#123;#arr_number[*]&#125;[root@localhost ~]# echo $arr_length5</span><br></pre></td></tr></table></figure>
</li>
<li><p>读取某下标赋值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# arr_index2=$&#123;arr_number[2]&#125;[root@localhost ~]# echo $arr_index23</span><br></pre></td></tr></table></figure>
</li>
<li><p>数组遍历</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# cat arr.sh #!/bin/basharr_number=(1 2 3 4 5)for v in $&#123;arr[@]&#125;do  echo $vdone</span><br></pre></td></tr></table></figure>
</li>
<li><p>对数组中某个索引重新赋值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# arr_number=(1 2 3 4 5)[root@localhost ~]# $arr_number[2]=5</span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="2、关联数组"><a href="#2、关联数组" class="headerlink" title="2、关联数组"></a>2、关联数组</h5><ul>
<li><p>需要现使用 <code>declare -A 数组名称</code> 才可以定义一个关联数组</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# declare -A man[root@localhost ~]# man[name]=xiaoming[root@localhost ~]# man[age]=26[root@localhost ~]# man[addr]=chengdu</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# declare -A woman[root@localhost ~]# woman=([name]=xiaohong [age]=22 [addr]=mianyang)</span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="3、案例"><a href="#3、案例" class="headerlink" title="3、案例"></a>3、案例</h5><ul>
<li>网站日志分析脚本（通过对日志文件数据的分析，掌握网站的运行状态、是否存在潜在的安全威胁、热点数据、时间段趋势、客户来源等信息）</li>
</ul>
<h4 id="二、函数"><a href="#二、函数" class="headerlink" title="二、函数"></a>二、函数</h4><p>在 Linux 系统中 Shell 函数类似于 Shell 脚本，可以存放一系列的指令。Shell 函数存放在内存中，每次执行函数时不需要从硬盘读取，因此运行与调用速度比较快。在 Shell中函数并非是必须的编程元素，但使用函数可以对程序进行更好的组织。将一些相对独立的代码变成函数，可以提高程序可读性与重用性，避免重复编写大量相同代码。</p>
<h5 id="1、函数定义"><a href="#1、函数定义" class="headerlink" title="1、函数定义"></a>1、函数定义</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[function] 函数名()&#123;命令序列[return x]&#125;#“function”关键字表示定义一个函数，可以省略；#“&#123;”符号表示函数执行命令的入口，该符号可以与函数名同行与可以在函数名下一行的句首；#“&#125;”符号表示函数体结束，两个大括号之间&#123; &#125;是函数体；#“命令序列”部分可以是任意的 Shell 命令，也可以调用其他函数；#“return”表示退出函数返回一个退出值，通过返回值判断执行是否成功，也可以使用 exit 终止整个 Shell 脚本</span><br><span class="line">函数名称()&#123;    代码序列&#125;</span><br><span class="line">function 函数名&#123;    代码序列&#125;</span><br></pre></td></tr></table></figure>

<h5 id="2、函数调用"><a href="#2、函数调用" class="headerlink" title="2、函数调用"></a>2、函数调用</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">函数名 [参数 1] [参数 2]</span><br></pre></td></tr></table></figure>

<ul>
<li><p>两个数求和</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# vim sum.sh #!/bin/bashsum()&#123;read -p &quot;请输入第一个数：&quot; NUM1read -p &quot;请输入第二个数：&quot; NUM2echo “你输入的两个数为： $NUM1 和$NUM2.”SUM=$(( NUM1+$NUM2))echo “两个数的和为： $SUM” &#125;sum</span><br></pre></td></tr></table></figure>
</li>
<li><p>编写自定义函数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# vim functionservicectl_usage () &#123; echo &quot;Usage:servicectl &lt;service-name&gt; &lt;start|stop|restart|reload|status&gt;&quot;; return 1&#125;chk_centos_ver () &#123; grep &quot;CentOS.*release 7.&quot; /etc/centos-release &amp;&gt; /dev/null &amp;&amp; echo &quot;7&quot; grep &quot;CentOS.*release 6.&quot; /etc/centos-release &amp;&gt; /dev/null &amp;&amp; echo &quot;6&quot; grep &quot;CentOS.*release 5.&quot; /etc/centos-release &amp;&gt; /dev/null &amp;&amp; echo &quot;5&quot;&#125;servicectl () &#123; [[ -z $1 || -z $2 ]] &amp;&amp; servicectl_usage [ $(chk_centos_ver)==&quot;7&quot; ] &amp;&amp; systemctl $2 $&#123;1&#125;.service || service $1 $2&#125;[root@localhost ~]# source function[root@localhost ~]# servicectl crond stop[root@localhost ~]# servicectl crond start</span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="3、返回值"><a href="#3、返回值" class="headerlink" title="3、返回值"></a>3、返回值</h5><ul>
<li><p>返回值也称为”状态码“或”状态返回值“，是命令执行的状态返回的结果，在系统执行命令时，系统需要判断命令是否执行成功</p>
</li>
<li><p>返回值范围是0<del>255，只有0表示成功，1</del>255都表示失败</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bashfunction fun_1&#123;  echo &quot;这是一个函数&quot;  ls /etc/passwd  return 3&#125;fun_1</span><br></pre></td></tr></table></figure>
</li>
<li><p>将函数返回值赋给变量</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bashfun1()&#123;  read -p &quot;输入一个值：&quot; va  echo $[$va*5]&#125;num=$(fun1)echo &quot;打印num的值为：$num&quot;</span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="4、案例"><a href="#4、案例" class="headerlink" title="4、案例"></a>4、案例</h5><ul>
<li><p>多进程ping测试主机是否存活</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">net=&quot;192.168.188&quot;multi_ping()&#123;    ping -c 2 -i 0.2 -W 1 $1 &amp;&gt; /dev/null    if [ $? -eq 0 ]    then      echo &quot;$1 is up&quot;    else      echo &quot;$1 is down&quot;    fi&#125;for i in &#123;1..254&#125;do  multi_ping $net.$i &amp;done</span><br></pre></td></tr></table></figure></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/10/22/shell%E8%84%9A%E6%9C%AC%E5%9F%BA%E7%A1%80-shell%E7%BB%93%E6%9E%84%E8%AF%AD%E5%8F%A5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="鹿祁">
      <meta itemprop="description" content="心有希冀，目有繁星，追光而遇，沐光而行">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鹿鹿祁">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/10/22/shell%E8%84%9A%E6%9C%AC%E5%9F%BA%E7%A1%80-shell%E7%BB%93%E6%9E%84%E8%AF%AD%E5%8F%A5/" class="post-title-link" itemprop="url">shell脚本基础-shell结构语句</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-10-22 22:38:08 / 修改时间：23:25:18" itemprop="dateCreated datePublished" datetime="2023-10-22T22:38:08+08:00">2023-10-22</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="一、条件语句"><a href="#一、条件语句" class="headerlink" title="一、条件语句"></a>一、条件语句</h4><h5 id="1、条件测试"><a href="#1、条件测试" class="headerlink" title="1、条件测试"></a>1、条件测试</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">test 条件表达式或[ 条件表达式 ]</span><br></pre></td></tr></table></figure>

<ul>
<li><p>文件测试</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-d：测试是否为目录（Directory）。-e：测试目录或文件是否存在（Exist）。-f：测试是否为文件（File）。-r：测试当前用户是否有权限读取（Read）。-w：测试当前用户是否有权限写入（Write）。-x：测试是否设置有可执行（Excute）权限。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#测试/media/目录是否存在，测试条件存在则返回 0 ，测试条件不成立，则范围值不为 0 （通常为1）[root@localhost ~]# test -d /media/    [root@localhost ~]# [ -d /media/ ][root@localhost ~]# echo $?0</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#测试条件成立，直接输出yes[root@localhost ~]# [ -d /media/cdrom ] &amp;&amp; echo &quot;yes&quot;yes</span><br></pre></td></tr></table></figure>
</li>
<li><p>整数值比较</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-eq：第一个数等于（Equal）第二个数。-ne：第一个数不等于（Not Equal）第二个数。-gt：第一个数大于（Greater Than）第二个数。-lt：第一个数小于（Lesser Than）第二个数。-le：第一个数小于或等于（Lesser or Equal）第二个数。-ge：第一个数大于或等于（Greater or Equal）第二个数。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#判断当前登录的用户数，超过5个时输出“用户登录过多”[root@localhost ~]# users=`who | wc -l | uniq`[root@localhost ~]# [ $users -gt 5 ] &amp;&amp; echo &quot;当前登录用户过多&quot;当前登录用户过多# uniq    去掉重复内容</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#判断物理内存（Mem）当前的磁盘缓存（buff/cache）大小，当低于 1024MB时输出具体数值[root@localhost ~]# RAM=$(free -m | grep &quot;Mem: &quot; | awk &#x27;&#123;print $6&#125;&#x27;)[root@localhost ~]# [ $RAM -lt 1024 ] &amp;&amp; echo $&#123;RAM&#125;MB436MB</span><br></pre></td></tr></table></figure>
</li>
<li><p>字符串比较</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">=：第一个字符串与第二个字符串相同。!=：第一个字符串与第二个字符串不相同，其中“!”符号表示取反。-z：检查字符串是否为空（Zero），对于未定义或赋予空值的变量将视为空串。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#检测是否安装中文[root@localhost ~]# echo $LANGen_US.UTF-8[root@localhost ~]# [ $LANG != &quot;zh_CN&quot; ] &amp;&amp; echo &quot;没有安装中文&quot;没有安装中文</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#经常需要用户输入“yes”或“no”来确认某个任务，还需根据变量“ACK”的取值分别执行进一步的操作[root@localhost ~]# read -p &quot;是否覆盖现有文件(yes/no)?&quot; ACK是否覆盖现有文件(yes/no)?yes[root@localhost ~]# [ $ACK = &quot;yes&quot; ] &amp;&amp; echo &quot;覆盖&quot;覆盖[root@localhost ~]# read -p &quot;是否覆盖现有文件(yes/no)?&quot; ACK是否覆盖现有文件(yes/no)?no[root@localhost ~]# [ $ACK = &quot;no&quot; ] &amp;&amp; echo &quot;不覆盖&quot;不覆盖</span><br></pre></td></tr></table></figure>
</li>
<li><p>逻辑测试</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&amp;&amp;：逻辑与，表示“而且”，只有当前后两个条件都成立时，整个测试命令的返回值才为 0（结果成立）。使用 test 命令测试时，“&amp;&amp;”可改为“-a”。||：逻辑或，表示“或者”，只要前后两个条件中有一个成立，整个测试命令的返回值即为 0（结果成立）。使用 test 命令测试时，“||”可改为“-o”。!：逻辑否，表示“不”，只有当指定的条件不成立时，整个测试命令的返回值才为0（结果成立）。</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#检测当前Linux系统的内核版本是否大于3.4[root@localhost ~]# uname -r                                                     //查看内核版本信息3.10.0-514.el7.x86_64[root@localhost ~]# Mnum=$(uname -r | awk -F. &#x27;&#123;print $1&#125;&#x27;)                        //取主版本号[root@localhost ~]# Snum=$(uname -r | awk -F. &#x27;&#123;print $2&#125;&#x27;)                        //取次版本号[root@localhost ~]# [ $Mnum -ge 3 ] &amp;&amp; [ $Snum -gt 4 ] &amp;&amp; echo &quot;符合要求&quot;符合要求</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# a=&quot;woniu&quot;[root@localhost ~]# [ ! $a = &quot;woniu&quot; ][root@localhost ~]# echo $?1</span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="2、if结构语句"><a href="#2、if结构语句" class="headerlink" title="2、if结构语句"></a>2、if结构语句</h5><ul>
<li><p>单分支if语句</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if 条件测试操作then  命令序列fi</span><br></pre></td></tr></table></figure>

<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/202112281301750.png" alt="image-20211228130128686"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#判断挂载点目录，若不存在则自动创建[root@localhost ~]# cat chkmountdir.sh#!/bin/bashMOUNT_DIR=&quot;/media/cdrom/&quot;if [ ! -d $MOUNT_DIR ]then    mkdir -p $MOUNT_DIRfi</span><br></pre></td></tr></table></figure>
</li>
<li><p>双分支if语句</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if 条件测试操作then  命令序列 1else  命令序列 2fi</span><br></pre></td></tr></table></figure>

<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/202112281302945.png" alt="image-20211228130211891"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#判断目标主机是否存活，显示检测结果[root@localhost ~]# cat pinghost.sh#!/bin/bashping -c 3 -i 0.2 -W 3 $1 &amp;&gt; /dev/nullif [ $? -eq 0 ]then    echo &quot;Host $1 is up.&quot;else    echo &quot;Host $1 is down.&quot;fi</span><br></pre></td></tr></table></figure>
</li>
<li><p>多分支if语句</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if 条件测试操作 1then 命令序列 1elif 条件测试操作 2then 命令序列 2else 命令序列 3fi</span><br></pre></td></tr></table></figure>

<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/202112281302607.png" alt="image-20211228130234529"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#判断分数范围，分出优秀、合格、不合格三档[root@localhost ~]# cat gradediv.sh#!/bin/bashread -p &quot;请输入您的分数(0-100):&quot; GRADEif [ $GRADE -ge 85 ] &amp;&amp; [ $GRADE -le 100 ]then    echo &quot;$GRADE 分,优秀!&quot;elif [ $GRADE -ge 70 ] &amp;&amp; [ $GRADE -le 84 ]then    echo &quot;$GRADE 分,合格!&quot;else    echo &quot;$GRADE 分,不合格!&quot; fi</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="二、case分支语句"><a href="#二、case分支语句" class="headerlink" title="二、case分支语句"></a>二、case分支语句</h4><p><strong>case 语句主要适用于以下情况：某个变量存在多种取值，需要对其中的每一种取值分别执行不同的命令序列。这种情况与多分支的 if 语句非常相似，只不过 if 语句需要判断多个不同的条件，而 case 语句只是判断一个变量的不同取值</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">case 变量值 in模式 1) 命令序列 1 ;;模式 2) 命令序列 2 ;; „„* ) 默认命令序列esac#case 后面跟的是“变量值”，即“$变量名”,整个分支结构包括在 case„esac 之间，中间的模式 1、模式2、„„、*对应为变量的不同取值（程序期望的取值），其中*作为通配符，可匹配任意值</span><br></pre></td></tr></table></figure>

<h5 id="1、执行流程："><a href="#1、执行流程：" class="headerlink" title="1、执行流程："></a>1、执行流程：</h5><ul>
<li>首先使用<code>“变量值”</code>与模式 1 进行比较，若取值相同则执行模式 1 后的命令序列，直到遇见双分号<code>“;;”</code>后跳转至 esac，表示结束分支；若与模式 1 不相匹配，则继续与模式 2 进行比较，若取值相同则执行模式 2 后的命令序列，直到遇见双分号<code>“;;”</code>后跳转至 esac，表示结束分支········依此类推，若找不到任何匹配的值，则执行默认模式<code>“*)”</code>后的命令序列，直到遇见 <code>esac</code> 后结束分支</li>
</ul>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/202112281311592.png" alt="image-20211228131150524"></p>
<h5 id="2、注意："><a href="#2、注意：" class="headerlink" title="2、注意："></a>2、注意：</h5><ul>
<li>case 行尾必须为单词<code>“in”</code>，每一模式必须以右括号“)”结束。</li>
<li>双分号<code>“;;”</code>表示命令序列的结束。</li>
<li>模式字符串中，可以用方括号表示一个连续的范围，如<code>“[0-9]”</code>；还可以用竖杠符号<code>“|”</code>表示或，如<code>“A|B”</code>。</li>
<li>最后的<code>“*)”</code>表示默认模式，其中的*相当于通配符</li>
</ul>
<h5 id="3、示例："><a href="#3、示例：" class="headerlink" title="3、示例："></a>3、示例：</h5><ul>
<li><p>检查用户输入的字符类型（提示用户从键盘输入一个字符，通过 case 语句判断该字符是否为字母、数字或者其他控制字符，并给出相应的提示信息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# vim hitkey.sh#!/bin/bashread -p &quot;请输入一个字符,并按 Enter 键确认:&quot; KEYcase &quot;$KEY&quot; in [a-z]|[A-Z]) //匹配任意字母 echo &quot;您输入的是 字母.&quot; ;; [0-9]) //匹配任意数字 echo &quot;您输入的是 数字.&quot; ;; *) //默认模式,匹配任意字符 echo &quot;您输入的是 空格､功能键或其他控制字符.&quot;esac</span><br></pre></td></tr></table></figure>
</li>
<li><p>编写系统服务脚本（编写一个名为 myprog 的系统服务脚本，通过位置变量$1 指定的 start、stop、restart、status 控制参数，分别用来启动、停止、重启 sleep 进程，以及查看 sleep 进程的状态。其中，命令 sleep 用来暂停指定秒数的时间，这里仅用做测试，在实际工作中应将 sleep改为相应后台服务的控制命令序列</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# vim myprog#!/bin/bashcase &quot;$1&quot; instart) echo -n &quot;正在启动 sleep 服务 ... &quot; if sleep 7200 &amp; then //在后台启动 sleep 进程 echo &quot;OK&quot; fi ;;stop) echo -n &quot;正在停止 sleep 服务 ... &quot; pkill &quot;sleep&quot; &amp;&gt; /dev/null echo &quot;OK&quot; //停止 sleep 进程 ;;status) if pgrep &quot;sleep&quot; &amp;&gt;/dev/null ; then             #判断并提示 sleep 进程状态 echo &quot;sleep 服务已经启动.&quot; else echo &quot;sleep 服务已经停止.&quot; fi ;;restart) //先停止、再启动服务 $0 stop $0 start ;;*) //默认显示用法信息 echo &quot;用法: $0 &#123;start|stop|status|restart&#125;&quot;esac</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="三、循环语句"><a href="#三、循环语句" class="headerlink" title="三、循环语句"></a>三、循环语句</h4><h5 id="1、for循环语句"><a href="#1、for循环语句" class="headerlink" title="1、for循环语句"></a>1、for循环语句</h5><ul>
<li><p>语法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">for 变量名 in 取值列表do 命令序列done</span><br></pre></td></tr></table></figure>

<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/202112281320489.png" alt="image-20211228132039436"></p>
<ul>
<li>首先将列表中的第一个取值赋给变量，并执行 do„done 循环体中的命令序列；然后将列表中的第二个取值赋给变量，并执行循环体中的命令序列„„依此类推，直到列表中的所有取值用完，最后将跳至 done 语句，表示结束循环</li>
</ul>
</li>
<li><p>示例</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#根据姓名列表批量添加用户[root@localhost ~]# vim /root/users.txt                 #用做测试的列表文件zhangsanlisiwangwuwoniuxy[root@localhost ~]# vim uaddfor.sh                         #批量添加用户的脚本#!/bin/bashULIST=$(cat /root/users.txt)for UNAME in $ULISTdo useradd $UNAME echo &quot;123456&quot; | passwd --stdin $UNAME &amp;&gt;/dev/nulldone</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#批量删除用户[root@localhost ~]# vim udelfor.sh #!/bin/bashULIST=$(cat /root/users.txt)for UNAME in $ULISTdo userdel -r $UNAME &amp;&gt;/dev/null done</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#根据 IP 地址列表检查主机状态[root@localhost ~]# vim /root/ipadds.txt             #用做测试的列表文件192.168.188.100192.168.188.200192.168.188.150[root@localhost ~]# vim chkhosts.sh                 #循环检查各主机的脚本#!/bin/bashHLIST=$(cat /root/ipadds.txt)for IP in $HLISTdo ping -c 3 -i 0.2 -W 3 $IP &amp;&gt; /dev/null if [ $? -eq 0 ] then echo &quot;Host $IP is up.&quot; else echo &quot;Host $IP is down.&quot; fidone</span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="2、while-循环语句"><a href="#2、while-循环语句" class="headerlink" title="2、while 循环语句"></a>2、while 循环语句</h5><ul>
<li><p>语法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">while 条件测试操作 do  命令序列done</span><br></pre></td></tr></table></figure>

<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/202112281328699.png" alt="image-20211228132839644"></p>
<ul>
<li>使用 while 循环语句时，有两个特殊的条件测试操作，即 true（真）和 false（假）。使用 true 作为条件时，表示条件永远成立，循环体内的命令序列将无限执行下去，除非强制终止脚本（或通过 exit 语句退出脚本）；反之，若使用 false 作为条件，则循环体将不会被执行。这两个特殊条件也可以用在 if 语句的条件测试中</li>
</ul>
</li>
<li><p>示例</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#批量添加规律编号的用户[root@localhost ~]# vim uaddwhile.sh                     #批量添加用户的脚本#!/bin/bashPREFIX=&quot;stu&quot;i=1while [ $i -le 20 ]do useradd $&#123;PREFIX&#125;$i echo &quot;123456&quot; | passwd --stdin $&#123;PREFIX&#125;$i &amp;&gt; /dev/null let i++                                                    #同于 i=`expr $i + 1`done</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#批量删除上述添加的用户[root@localhost ~]# vim udelwhile.sh#!/bin/bashPREFIX=&quot;stu&quot;i=1while [ $i -le 20 ]do userdel -r $&#123;PREFIX&#125;$i let i++done</span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="3、until-循环语句"><a href="#3、until-循环语句" class="headerlink" title="3、until 循环语句"></a>3、until 循环语句</h5><ul>
<li><p>语法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">until 条件测试操作 do  命令序列done</span><br></pre></td></tr></table></figure>

<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/202112281333509.png" alt="image-20211228133352459"></p>
<ul>
<li>首先判断 until 后的条件测试操作结果，如果条件不成立，则执行 do„done 循环体中的命令序列；返回 until 后再次判断条件测试结果，如果条件仍然不成立，则继续执行循环体；再次返回到 until 后，判断条件测试结果„„如此循环，直到until 后的条件测试结果成立为止，最后跳转到 done 语句，表示结束循环</li>
</ul>
</li>
<li><p>示例</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#计算 1~50 的和值[root@localhost ~]# vi sum1to50_until_v1.sh#!/bin/bash##filename:sum1to50_until_v1.shi=0;s=0until [ $i -eq 50 ]dolet &quot;i=$i+1&quot;;let &quot;s=$s+$i&quot;doneecho &#x27;sum(1..50)=&#x27;$s</span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="4、select循环语句"><a href="#4、select循环语句" class="headerlink" title="4、select循环语句"></a>4、select循环语句</h5><ul>
<li><p>主要目的是方便的创建菜单</p>
</li>
<li><p>语法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select 变量名 in 值列表do  命令序列done</span><br></pre></td></tr></table></figure>
</li>
<li><p>示例</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bashecho &quot;请根据提示选择一个选项：&quot;select item in &quot;CPU&quot; &quot;IP&quot; &quot;MEM&quot; &quot;exit&quot;do  case $item in  &quot;CPU&quot;)    uptime;;                #显示系统运行时间  &quot;IP&quot;)    ip add;;  &quot;MEM&quot;)    free;;  &quot;exit&quot;)    exit;;  *)    echo error;;  esacdone</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="四、中断与退出控制"><a href="#四、中断与退出控制" class="headerlink" title="四、中断与退出控制"></a>四、中断与退出控制</h4><h5 id="1、continue（结束单次循环）"><a href="#1、continue（结束单次循环）" class="headerlink" title="1、continue（结束单次循环）"></a>1、continue（结束单次循环）</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bashfor i in &#123;1..5&#125;do  [ $i -eq 3 ] &amp;&amp; continue  echo $idone</span><br></pre></td></tr></table></figure>

<h5 id="2、break（结束整个循环体）"><a href="#2、break（结束整个循环体）" class="headerlink" title="2、break（结束整个循环体）"></a>2、break（结束整个循环体）</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bashfor i in &#123;1..5&#125;do  [ $i -eq 3 ] &amp;&amp; break  echo $idoneecho &quot;程序结束&quot;</span><br></pre></td></tr></table></figure>

<h5 id="3、exit（直接结束整个脚本）"><a href="#3、exit（直接结束整个脚本）" class="headerlink" title="3、exit（直接结束整个脚本）"></a>3、exit（直接结束整个脚本）</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bashfor i in &#123;1..5&#125;do  [ $i -eq 3 ] &amp;&amp; exit  echo $idoneecho &quot;程序结束&quot;</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/10/22/shell%E8%84%9A%E6%9C%AC%E5%9F%BA%E7%A1%80-shell%E7%8E%AF%E5%A2%83%E4%B8%8E%E5%8F%98%E9%87%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="鹿祁">
      <meta itemprop="description" content="心有希冀，目有繁星，追光而遇，沐光而行">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鹿鹿祁">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/10/22/shell%E8%84%9A%E6%9C%AC%E5%9F%BA%E7%A1%80-shell%E7%8E%AF%E5%A2%83%E4%B8%8E%E5%8F%98%E9%87%8F/" class="post-title-link" itemprop="url">shell脚本基础-shell环境与变量</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-10-22 22:37:56 / 修改时间：23:24:53" itemprop="dateCreated datePublished" datetime="2023-10-22T22:37:56+08:00">2023-10-22</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="一、shell基础"><a href="#一、shell基础" class="headerlink" title="一、shell基础"></a>一、shell基础</h4><h5 id="1、shell的作用"><a href="#1、shell的作用" class="headerlink" title="1、shell的作用"></a>1、shell的作用</h5><ul>
<li><p>Linux 系统中的 Shell 脚本是一个特殊的应用程序，它介于操作系统内核与用户之间，充当了一个“命令解释器”的角色，负责接收用户输入的操作指令（命令）并进行解释，将需要执行的操作传递给内核执行，并输出执行结果。</p>
</li>
<li><p>常见的 Shell 解释器程序有很多种，使用不同的 Shell 脚本时，其内部指令、命令行提示等方面会存在一些区别。通过&#x2F;etc&#x2F;shells 文件可以了解当前系统所支持的 Shell 脚本种类。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#列出系统中所有的Shell[root@localhost ~]# cat /etc/shells/bin/sh/bin/bash/usr/bin/sh/usr/bin/bash</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#查看当前环境变量$SHELL的值[root@localhost ~]# echo $SHELL/bin/bash</span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="2、Shell的类型"><a href="#2、Shell的类型" class="headerlink" title="2、Shell的类型"></a>2、Shell的类型</h5><table>
<thead>
<tr>
<th align="left">命令</th>
<th align="left">作用</th>
</tr>
</thead>
<tbody><tr>
<td align="left">Bourne Shell</td>
<td align="left">是贝尔实验室开发的，Unix普遍使用的Shell，在编程方面比较优秀，但在用户交互方面没有其他Shell优秀。</td>
</tr>
<tr>
<td align="left">Korn Shell</td>
<td align="left">是对Bourne Shell 的发展，在大部分内容上与Bourne Shell兼容，集成了C Shell和Bourne shell优点。</td>
</tr>
<tr>
<td align="left">BASH</td>
<td align="left">是GNU的Bourne Again Shell，是GNU操作系统上默认的Shell，在Bourne Shell基础上增强了很多特性，如命令补全，命令历史表</td>
</tr>
<tr>
<td align="left">C Shell</td>
<td align="left">是SUN公司Shell的BSD版本，语法与c语言相似，比bourne shell 更适合编程</td>
</tr>
</tbody></table>
<h5 id="3、第一个shell脚本"><a href="#3、第一个shell脚本" class="headerlink" title="3、第一个shell脚本"></a>3、第一个shell脚本</h5><ul>
<li><p>新建shell文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# vim first.sh    cd /boot    pwd    ls -lh vml*</span><br></pre></td></tr></table></figure>
</li>
<li><p>添加执行权限</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# chmod +x first.sh [root@localhost ~]# ls -ld first.sh -rwxr-xr-x. 1 root root 25 12月 26 23:46 first.sh</span><br></pre></td></tr></table></figure>
</li>
<li><p>执行shell脚本（3种执行方式）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#使用 ./ 执行需要添加执行权限[root@localhost ~]# ./first.sh /boot-rwxr-xr-x. 1 root root 6.5M 12月 20 04:36 vmlinuz-0-rescue-5255c7d84d8048d6b0bce26a490ad173-rwxr-xr-x. 1 root root 6.5M 8月   8 2019 vmlinuz-3.10.0-1062.el7.x86_64</span><br></pre></td></tr></table></figure>

<ul>
<li>使用 <code>sh</code> 、 <code>.</code> 、 <code>source</code> 来执行就不需要添加执行权限</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# sh first.sh /boot-rwxr-xr-x. 1 root root 6.5M 12月 20 04:36 vmlinuz-0-rescue-5255c7d84d8048d6b0bce26a490ad173-rwxr-xr-x. 1 root root 6.5M 8月   8 2019 vmlinuz-3.10.0-1062.el7.x86_64</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#以下两种方式相等[root@localhost ~]# . first.sh[root@localhost ~]# source first.sh/boot-rwxr-xr-x. 1 root root 6.5M 12月 20 04:36 vmlinuz-0-rescue-5255c7d84d8048d6b0bce26a490ad173-rwxr-xr-x. 1 root root 6.5M 8月   8 2019 vmlinuz-3.10.0-1062.el7.x86_64</span><br></pre></td></tr></table></figure>
</li>
<li><p>完善脚本（<code>#!/bin/bash</code>这是一个特殊声明，<code>echo</code>用于输出字符串）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# vim first.sh     #!/bin/bash    # 这是我的第一个shell脚本。    cd /boot    echo &quot;当前的目录位于:&quot;    pwd    echo &quot;其中以 vml 开头的文件包括:&quot;    ls -lh vml*[root@localhost ~]# sh first.sh 当前的目录位于:/boot其中以 vml 开头的文件包括:-rwxr-xr-x. 1 root root 6.5M 12月 20 04:36 vmlinuz-0-rescue-5255c7d84d8048d6b0bce26a490ad173-rwxr-xr-x. 1 root root 6.5M 8月   8 2019 vmlinuz-3.10.0-1062.el7.x86_64</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="二、重定向与管道操作"><a href="#二、重定向与管道操作" class="headerlink" title="二、重定向与管道操作"></a>二、重定向与管道操作</h4><h5 id="1、重定向操作"><a href="#1、重定向操作" class="headerlink" title="1、重定向操作"></a>1、重定向操作</h5><ul>
<li><p>标准输入（STDIN）：默认的设备是键盘，文件编号为 0，命令将从标准输入文件中读取在执行过程中需要的输入数据，使用 <code>&lt;</code> 操作符</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# vim pass.txt    123456[root@localhost ~]# passwd --stdin zhangsan &lt; pass.txt             #需要关闭seLinux更改用户 zhangsan 的密码 。passwd：所有的身份验证令牌已经成功更新。</span><br></pre></td></tr></table></figure>
</li>
<li><p>标准输出（STDOUT）：默认的设备是显示器，文件编号为 1，命令将执行后的输出结果发送到标准输出文件。</p>
<ul>
<li>重定向输出使用 <code>&gt;</code> 或 <code>&gt;&gt;</code> 操作符号，分别用于覆盖或追加文件</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# uname -p &gt; kernel.txt[root@localhost ~]# cat kernel.txtx86_64</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# uname -r &gt;&gt; kernel.txt[root@localhost ~]# cat kernel.txtx86_643.10.0-514.el7.x86_64</span><br></pre></td></tr></table></figure>
</li>
<li><p>标准错误（STDERR）：默认的设备是显示器，文件编号为 2，命令将执行期间的各种错误信息发送到标准错误文件。</p>
<ul>
<li>错误重定向使用“2&gt;”操作符，其中“2”是指错误文件的编号（在使用标准输出、标准输入重定向时，实际上省略了 1、0 编号）。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# tar jcf /nonedir/etc.tgz /etc/ 2&gt; error.log[root@localhost ~]# cat error.log tar: 从成员名中删除开头的“/”tar (child): /nonedir/etc.tgz：无法 open: 没有那个文件或目录tar (child): Error is not recoverable: exiting now</span><br></pre></td></tr></table></figure>

<ul>
<li>使用 <code>2&gt;</code> 操作符时，会像使用 <code>&gt;</code> 操作符一样覆盖目标文件的内容，若要追加内容而不是覆盖文件，则应改用 <code>2&gt;&gt;</code> 操作符</li>
</ul>
</li>
<li><p>当命令输出的结果可能既包括标准输出（正常执行）信息，又包括错误输出信息时，可以使用操作符 <code>&gt;</code> <code>2&gt;</code> 将两类输出信息分别保存到不同的文件，也可以使用 <code>&amp;&gt;</code> 操作符将两类输出信息保存到同一个文件</p>
</li>
</ul>
<table>
<thead>
<tr>
<th align="left"><strong>类型</strong></th>
<th align="left"><strong>操作符</strong></th>
<th align="left"><strong>用途</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="left">重定向输入</td>
<td align="left">&lt;</td>
<td align="left">从指定的文件读取数据，而不是从键盘输入</td>
</tr>
<tr>
<td align="left">重定向输出</td>
<td align="left">&gt; &gt;&gt;</td>
<td align="left">将输出结果保存到指定的文件（覆盖原有内容） 将输出结果追加到指定的文件</td>
</tr>
<tr>
<td align="left">标准错误输出</td>
<td align="left">2&gt; 2&gt;&gt;</td>
<td align="left">将错误信息保存到指定的文件（覆盖原有内容） 将错误信息追加到指定的文件中</td>
</tr>
<tr>
<td align="left">混合输出</td>
<td align="left">&amp;&gt;</td>
<td align="left">将标准输出、标准错误的内容保存到同一个文件中</td>
</tr>
</tbody></table>
<h5 id="2、管道操作"><a href="#2、管道操作" class="headerlink" title="2、管道操作"></a>2、管道操作</h5><ul>
<li><p>管道（pipe）操作为不同命令之间的协同工作提供了一种机制，位于管道符号“|”左侧的命令输出的结果，将作为右侧命令的输入（处理对象），同一行命令中可以使用多个管道。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#过滤前[root@localhost ~]# grep &quot;/bin/bash$&quot; /etc/passwd        root0root:/root:/bin/bashzhangsan1000:/home/zhangsan:/bin/bash#使用 awk 做进一步过滤（-F指定分隔符，print打印字段1和字段7）[root@localhost ~]# grep &quot;/bin/bash$&quot; /etc/passwd | awk -F: &#x27;&#123;print $1,$7&#125;&#x27;root /bin/bashzhangsan /bin/bash</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# df -hT文件系统                类型      容量  已用  可用 已用% 挂载点devtmpfs                devtmpfs  475M     0  475M    0% /devtmpfs                   tmpfs     487M     0  487M    0% /dev/shmtmpfs                   tmpfs     487M  7.7M  479M    2% /runtmpfs                   tmpfs     487M     0  487M    0% /sys/fs/cgroup/dev/mapper/centos-root xfs        50G  1.4G   49G    3% //dev/sda1               xfs      1014M  137M  878M   14% /boot/dev/mapper/centos-home xfs        47G   33M   47G    1% /hometmpfs                   tmpfs      98M     0   98M    0% /run/user/0[root@localhost ~]# df -hT | grep &quot;/$&quot; | awk &#x27;&#123;print $6&#125;&#x27;3%</span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="3、实验操作"><a href="#3、实验操作" class="headerlink" title="3、实验操作"></a>3、实验操作</h5><ul>
<li><p>使用shell脚本编写一个自动编译安装httpd服务器的脚本</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- 下载源码包- 安装编译环境（gcc、gcc-c++、make）- 安装httpd依赖软件- 解包- 配置- 编译- 安装- 修改配置文件（使用sed命令 sed -i &#x27;3i ServerName 192.168.1.1:80&#x27; httpd.conf   直接修改原文件在第三行插入内容）- 启动服务器</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="三、shell变量"><a href="#三、shell变量" class="headerlink" title="三、shell变量"></a>三、shell变量</h4><h5 id="1、自定义变量"><a href="#1、自定义变量" class="headerlink" title="1、自定义变量"></a>1、自定义变量</h5><ul>
<li><p>由用户自己定义、修改和使用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">变量名=变量值echo $变量名</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# school=woniuxy[root@localhost ~]# echo $school woniuxy</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用 <code>&#123;&#125;</code> 括号</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# classes=wangan[root@localhost ~]# echo $classes7.5.5[root@localhost ~]# echo $&#123;classes&#125;7.5wangan7.5</span><br></pre></td></tr></table></figure>
</li>
<li><p>赋值时使用引号</p>
<ul>
<li><p>双引号<code>&quot; &quot;</code>（允许通过$符号引用其他变量值，变量值中出现空格时使用）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# classes=&quot;wangan 7.5&quot;[root@localhost ~]# echo $classeswangan 7.5</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# classes=wangan[root@localhost ~]# version=7.5[root@localhost ~]# wnwa=&quot;$classes $version&quot;[root@localhost ~]# echo $wnwawangan 7.5</span><br></pre></td></tr></table></figure>
</li>
<li><p>单引号<code>&#39; &#39;</code>（禁止引用其他变量值，$视为普通字符）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# wnwa=&#x27;$classes $version&#x27;[root@localhost ~]# echo $wnwa$classes $version</span><br></pre></td></tr></table></figure>
</li>
<li><p>反撇号&#96;&#96;&#96; <code>，当出现嵌套命令替换时改用 </code>$()&#96; （命令替换，提取命令执行后的输出结果）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# ls -lh `which useradd`-rwxr-xr-x. 1 root root 135K 8月   9 2019 /usr/sbin/useradd</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# rpm -qc $(rpm -qf $(which useradd))/etc/default/useradd/etc/login.defs</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>使用<code>read</code> 命令（从键盘输入内容为变量赋值，使用<code>-p</code>选项来设置提示信息）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# read -p &quot;请输入学校：&quot; school请输入学校：蜗牛学苑[root@localhost ~]# echo $school蜗牛学苑</span><br></pre></td></tr></table></figure>
</li>
<li><p>变量的作用范围</p>
<ul>
<li><p>默认情况下定义的变量为局部变量</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# school=&quot;蜗牛学苑&quot;[root@localhost ~]# echo $school蜗牛学苑[root@localhost ~]# bash[root@localhost ~]# echo $school</span><br></pre></td></tr></table></figure>
</li>
<li><p>可以使用内部命令<code>export</code>将指定的变量导出为全局变量</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# school=&quot;蜗牛学苑&quot;[root@localhost ~]# classes=&quot;网安10期&quot;[root@localhost ~]# export school classes[root@localhost ~]# bash[root@localhost ~]# echo $school $classes蜗牛学苑 网安10期</span><br></pre></td></tr></table></figure></li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# export FQDN=&quot;www.woniuxy.com&quot;[root@localhost ~]# echo $FQDNwww.woniuxy.com[root@localhost ~]# bash[root@localhost ~]# echo $FQDNwww.woniuxy.com</span><br></pre></td></tr></table></figure>
</li>
<li><p>变量的运算</p>
<ul>
<li>在 Bash Shell 环境中，只能进行简单的整数运算，不支持小数运算。整数值的运算主要通过内部命令 <code>expr</code> 进行，运算符与变量之间必须有至少一个空格</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th align="left">运算符</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>+</code></td>
<td align="left">加法运算</td>
</tr>
<tr>
<td align="left"><code>-</code></td>
<td align="left">减法运算</td>
</tr>
<tr>
<td align="left"><code>\*</code></td>
<td align="left">乘法运算，注意不能仅使用“*”符号，否则将被当成文件通配符</td>
</tr>
<tr>
<td align="left"><code>/</code></td>
<td align="left">除法运算</td>
</tr>
<tr>
<td align="left"><code>%</code></td>
<td align="left">求模运算，又称为取余运算，用来计算数值相除后的余数</td>
</tr>
</tbody></table>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# X=35[root@localhost ~]# Y=16[root@localhost ~]# expr $X + $Y51[root@localhost ~]# expr $X - $Y19[root@localhost ~]# expr $X \* $Y560[root@localhost ~]# expr $X / $Y2[root@localhost ~]# expr $X % $Y3[root@localhost ~]# Ycube=`expr $Y \* $Y \* $Y` [root@localhost ~]# echo $Ycube 4096</span><br></pre></td></tr></table></figure>

<h5 id="2、环境变量"><a href="#2、环境变量" class="headerlink" title="2、环境变量"></a>2、环境变量</h5><ul>
<li><p>由系统维护，用于设置用户的工作环境，包括用户宿主目录、命令查找路径、用户当前目录、登录终端等</p>
</li>
<li><p>使用 env 命令可以查看到当前工作环境下的环境变量</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# envXDG_SESSION_ID=4HOSTNAME=localhost.localdomainTERM=xtermSHELL=/bin/bashHISTSIZE=1000SSH_CLIENT=192.168.1.60 63171 22SSH_TTY=/dev/pts/0USER=rootLS_COLORS=rs=0:di=01;34:ln=01;36:mh=00:pi=40;33:so=01;35:do=01;35:bd=40;33;01:cd=40;33;01:or=40;31;01:mi=01;05;37;41:su=37;41:sg=30;43:ca=30;41:tw=30;42:ow=34;42:st=37;44:ex=01;32:*.tar=01;31:*.tgz=01;31:*.arc=01;31:*.arj=01;31:*.taz=01;31:*.lha=01;31:*.lz4=01;31:*.lzh=01;31:*.lzma=01;31:*.tlz=01;31:*.txz=01;31:*.tzo=01;31:*.t7z=01;31:*.zip=01;31:*.z=01;31:*.Z=01;31:*.dz=01;31:*.gz=01;31:*.lrz=01;31:*.lz=01;31:*.lzo=01;31:*.xz=01;31:*.bz2=01;31:*.bz=01;31:*.tbz=01;31:*.tbz2=01;31:*.tz=01;31:*.deb=01;31:*.rpm=01;31:*.jar=01;31:*.war=01;31:*.ear=01;31:*.sar=01;31:*.rar=01;31:*.alz=01;31:*.ace=01;31:*.zoo=01;31:*.cpio=01;31:*.7z=01;31:*.rz=01;31:*.cab=01;31:*.jpg=01;35:*.jpeg=01;35:*.gif=01;35:*.bmp=01;35:*.pbm=01;35:*.pgm=01;35:*.ppm=01;35:*.tga=01;35:*.xbm=01;35:*.xpm=01;35:*.tif=01;35:*.tiff=01;35:*.png=01;35:*.svg=01;35:*.svgz=01;35:*.mng=01;35:*.pcx=01;35:*.mov=01;35:*.mpg=01;35:*.mpeg=01;35:*.m2v=01;35:*.mkv=01;35:*.webm=01;35:*.ogm=01;35:*.mp4=01;35:*.m4v=01;35:*.mp4v=01;35:*.vob=01;35:*.qt=01;35:*.nuv=01;35:*.wmv=01;35:*.asf=01;35:*.rm=01;35:*.rmvb=01;35:*.flc=01;35:*.avi=01;35:*.fli=01;35:*.flv=01;35:*.gl=01;35:*.dl=01;35:*.xcf=01;35:*.xwd=01;35:*.yuv=01;35:*.cgm=01;35:*.emf=01;35:*.axv=01;35:*.anx=01;35:*.ogv=01;35:*.ogx=01;35:*.aac=01;36:*.au=01;36:*.flac=01;36:*.mid=01;36:*.midi=01;36:*.mka=01;36:*.mp3=01;36:*.mpc=01;36:*.ogg=01;36:*.ra=01;36:*.wav=01;36:*.axa=01;36:*.oga=01;36:*.spx=01;36:*.xspf=01;36:MAIL=/var/spool/mail/rootPATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin            #搜索路径PWD=/rootLANG=en_US.UTF-8HISTCONTROL=ignoredupsSHLVL=1HOME=/rootLOGNAME=rootSSH_CONNECTION=192.168.1.60 63171 192.168.1.10 22LESSOPEN=||/usr/bin/lesspipe.sh %sXDG_RUNTIME_DIR=/run/user/0_=/usr/bin/env</span><br></pre></td></tr></table></figure>
</li>
<li><p>搜索路径（PATH变量）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# first.sh-bash: first.sh: command not found[root@localhost ~]# echo $PATH/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/root/bin[root@localhost ~]# PATH=&quot;$PATH:/root&quot;[root@localhost ~]# first.sh当前的目录位于:/boot其中以 vml 开头的文件包括:-rwxr-xr-x. 1 root root 6.5M May 25  2021 vmlinuz-0-rescue-8baa18618aee48cd8dbf18aa34733c14-rwxr-xr-x. 1 root root 6.5M Aug  8  2019 vmlinuz-3.10.0-1062.el7.x86_64</span><br></pre></td></tr></table></figure>
</li>
<li><p>环境变量的全局配置文件为<code>/etc/profile</code> ,除此之外，每个用户还有自己的独立配置文件（<code>～/.bash_profile</code>）,修改用户的配置文件只会对用户生效</p>
</li>
</ul>
<h5 id="3、位置变量"><a href="#3、位置变量" class="headerlink" title="3、位置变量"></a>3、位置变量</h5><ul>
<li><p>通过命令行给脚本程序传递参数</p>
</li>
<li><p>位置变量也称为位置参数，使用$1、$2、$3、·····、$9、${10}、${11}、········· 表示。例如，当执行命令行“ls -lh &#x2F;boot&#x2F;”时，其中第 1 个位置变量为“-lh”，以“$1”表示；第 2 个位置变量为“&#x2F;boot&#x2F;”，以“$2”表示。命令或脚本本身的名称使用“$0”表示，虽然$0 与位置变量的格式相同，但是$0 属于预定义变量而不是位置变量</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# vim sum.sh    #!/bin/bash    sum=`expr $1 + $2`    echo &quot;$1 + $2 = $sum&quot;[root@localhost ~]# sh sum.sh 12 3412 + 34 = 46</span><br></pre></td></tr></table></figure></li>
</ul>
<p>4、预定义变量</p>
<ul>
<li><p>Bash中内置的一类变量，不能直接修改</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$#：表示命令行中位置参数的个数。$*：表示所有位置参数的内容。$?：表示前一条命令执行后的返回状态，返回值为 0 表示执行正确，返回任何非 0值均表示执行出现异常$0：表示当前执行的脚本或程序的名称。</span><br></pre></td></tr></table></figure>
</li>
<li><p>来打包命令行指定的多个文件或目录，并输出相关信息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# vim mybak.sh    #!/bin/bash    backfile=&quot;backup-`date +%s`.tgz&quot;    tar zcf $backfile $* &amp;&gt; /dev/null    echo &quot;已执行 $0 脚本&quot;    echo &quot;共完成 $# 个对象的备份&quot;    echo &quot;具体内容包括：$*&quot;#date +%s 获取秒刻时间（从1970年1月1日开始计算）</span><br></pre></td></tr></table></figure></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/10/22/linux%E9%98%B2%E7%81%AB%E5%A2%99%E5%9F%BA%E7%A1%80-firewalld%E5%AE%9E%E6%88%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="鹿祁">
      <meta itemprop="description" content="心有希冀，目有繁星，追光而遇，沐光而行">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鹿鹿祁">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/10/22/linux%E9%98%B2%E7%81%AB%E5%A2%99%E5%9F%BA%E7%A1%80-firewalld%E5%AE%9E%E6%88%98/" class="post-title-link" itemprop="url">linux防火墙基础-firewalld实战</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-10-22 22:37:26 / 修改时间：23:23:40" itemprop="dateCreated datePublished" datetime="2023-10-22T22:37:26+08:00">2023-10-22</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="一、firewalld实战案例"><a href="#一、firewalld实战案例" class="headerlink" title="一、firewalld实战案例"></a>一、firewalld实战案例</h4><h5 id="1、实验环境"><a href="#1、实验环境" class="headerlink" title="1、实验环境"></a>1、实验环境</h5><p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/202112272347768.png" alt="image-20211227234718712"></p>
<h5 id="2、实验需求"><a href="#2、实验需求" class="headerlink" title="2、实验需求"></a>2、实验需求</h5><ul>
<li>公司内网主机需要通过网关服务器共享上网（dmzWEBserver不允许访问外网）</li>
<li>Internet主机需要访问网站服务器</li>
<li>只允许192.168.1.0&#x2F;24ping网关和网站服务器</li>
<li>网站服务器和网关服务器均通过SSH来远程管理，为了安全，将SSH默认端口改为12345，只允许192.168.1.10主机SSH网关和服务器，允许Internet主机SSH网站服务器</li>
</ul>
<h5 id="3、实验思路"><a href="#3、实验思路" class="headerlink" title="3、实验思路"></a>3、实验思路</h5><ul>
<li><p>网关（直接规则放行穿越的Web和SSH流量）</p>
<ul>
<li>ens33：external区域（开启地址伪装和端口转发，拒绝ICMP）</li>
<li>ens37：internal区域（允许1.10访问TCP的12345端口）</li>
<li>ens38：dmz区域（拒绝ICMP请求）</li>
</ul>
</li>
<li><p>网站服务器</p>
<ul>
<li><p>ens33</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public区域（允许http服务，拒绝ICMP请求，允许TCP的12345端口，拒绝1.0访问TCP的12345端口）internal区域（源IP设置为192.168.1.0/24网段，允许1.10访问TCP的12345端口）</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h5 id="4、实验步骤"><a href="#4、实验步骤" class="headerlink" title="4、实验步骤"></a>4、实验步骤</h5><ul>
<li><p>网站服务器配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@Server network-scripts]# firewall-cmd --list-servicesdhcpv6-client ssh[root@Server network-scripts]# firewall-cmd --remove-service=dhcpv6-clientsuccess[root@Server network-scripts]# firewall-cmd --remove-service=sshsuccess[root@Server network-scripts]# firewall-cmd --add-service=httpsuccess[root@Server network-scripts]# firewall-cmd --add-icmp-block=echo-requestsuccess[root@Server network-scripts]# firewall-cmd --zone=public --add-rich-rule=&#x27;rule family=ipv4 destination address=192.168.2.10 port port=12345 protocol=tcp accept&#x27;success</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@Server network-scripts]# firewall-cmd --zone=internal --add-source=192.168.1.0/24success[root@Server network-scripts]# firewall-cmd --zone=internal --list-servicesssh mdns samba-client dhcpv6-client[root@Server network-scripts]# firewall-cmd --zone=internal --remove-service=sshsuccess[root@Server network-scripts]# firewall-cmd --zone=internal --remove-service=mdnssuccess[root@Server network-scripts]# firewall-cmd --zone=internal --remove-service=samba-clientsuccess[root@Server network-scripts]# firewall-cmd --zone=internal --remove-service=dhcpv6-clientsuccess</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@Server network-scripts]# firewall-cmd --zone=internal --add-rich-rule=&#x27;rule family=ipv4 source address=192.168.1.10 port port=12345 protocol=tcp accept&#x27;Success[root@Server network-scripts]# firewall-cmd --zone=public --add-rich-rule=&#x27;rule family=ipv4 source address=192.168.0.0/16 destination address=192.168.2.10 port port=12345 protocol=tcp reject&#x27;Success[root@gateway ~]# firewall-cmd --runtime-to-permanentsuccess</span><br></pre></td></tr></table></figure>
</li>
<li><p>网关服务器配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@gateway ~]# firewall-cmd --zone=external --add-interface=ens33The interface is under control of NetworkManager, setting zone to &#x27;external&#x27;.success[root@gateway ~]# firewall-cmd --zone=external --list-servicesssh[root@gateway ~]# firewall-cmd --zone=external --remove-service=sshSuccess[root@gateway ~]# firewall-cmd --zone=external --add-icmp-block=echo-requestsuccess[root@gateway ~]# firewall-cmd --zone=external --query-masqueradeyes[root@gateway ~]# firewall-cmd --zone=external --add-forward-port=port=22:proto=tcp:toport=12345:toaddr=192.168.2.10Success[root@gateway ~]# firewall-cmd --zone=external --add-forward-port=port=80:proto=tcp:toport=80:toaddr=192.168.2.10success</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@gateway ~]# firewall-cmd --zone=internal --add-interface=ens37The interface is under control of NetworkManager, setting zone to &#x27;internal&#x27;.success[root@gateway ~]# firewall-cmd --zone=internal --list-servicesssh mdns samba-client dhcpv6-client[root@gateway ~]# firewall-cmd --zone=internal --remove-service=mdnssuccess[root@gateway ~]# firewall-cmd --zone=internal --remove-service=samba-clientsuccess[root@gateway ~]# firewall-cmd --zone=internal --remove-service=dhcpv6-clientSuccess[root@gateway ~]# firewall-cmd --zone=internal --remove-service=sshsuccess[root@gateway ~]# firewall-cmd --zone=internal --add-rich-rule=&#x27;rule family=ipv4 source address=192.168.1.10 port port=12345 protocol=tcp accept&#x27;success</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@gateway ~]# firewall-cmd --zone=dmz --add-interface=ens38The interface is under control of NetworkManager, setting zone to &#x27;dmz&#x27;.success[root@gateway ~]# firewall-cmd --zone=dmz --list-servicesssh[root@gateway ~]# firewall-cmd --zone=dmz --remove-service=sshsuccess[root@gateway ~]# firewall-cmd --zone=dmz --add-icmp-block=echo-requestSuccess[root@gateway ~]# firewall-cmd --direct --add-rule ipv4 filter FORWARD 0 -p tcp --dport 12345 -j ACCEPTsuccess[root@gateway ~]# firewall-cmd --direct --add-rule ipv4 filter FORWARD 0 -p tcp --dport 80 -j ACCEPTSuccess[root@gateway ~]# firewall-cmd --runtime-to-permanentsuccess</span><br></pre></td></tr></table></figure></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/10/22/linux%E9%98%B2%E7%81%AB%E5%A2%99%E5%9F%BA%E7%A1%80-firewalld%E5%AF%8C%E8%A7%84%E5%88%99/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="鹿祁">
      <meta itemprop="description" content="心有希冀，目有繁星，追光而遇，沐光而行">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鹿鹿祁">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/10/22/linux%E9%98%B2%E7%81%AB%E5%A2%99%E5%9F%BA%E7%A1%80-firewalld%E5%AF%8C%E8%A7%84%E5%88%99/" class="post-title-link" itemprop="url">linux防火墙基础-firewalld富规则</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-10-22 22:37:18 / 修改时间：23:23:20" itemprop="dateCreated datePublished" datetime="2023-10-22T22:37:18+08:00">2023-10-22</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="一、IP-伪装和端口转发"><a href="#一、IP-伪装和端口转发" class="headerlink" title="一、IP 伪装和端口转发"></a>一、IP 伪装和端口转发</h4><h5 id="1、IP-地址伪装"><a href="#1、IP-地址伪装" class="headerlink" title="1、IP 地址伪装"></a>1、IP 地址伪装</h5><ul>
<li>地址伪装（masquerade）：通过地址伪装，NAT 设备将经过设备的包转发到指定接收方，同时将通过的数据包的源地址更改为其自己的接口地址。当返回的数据包到达时，会将目的地址修改为原始主机的地址并做路由。地址伪装可以实现局域网多个地址共享单一公网地址上网。类似于 NAT 技术中的端口多路复用（PAT）。IP 地址伪装仅支持 IPv4，不支持 IPv6。</li>
</ul>
<h5 id="2、端口转发"><a href="#2、端口转发" class="headerlink" title="2、端口转发"></a>2、端口转发</h5><ul>
<li>端口转发（Forward-port）：也称为目的地址转换或端口映射。通过端口转发，将指定IP 地址及端口的流量转发到相同计算机上的不同端口，或不同计算机上的端口。企业内网的服务器一般都采用私网地址，可以通过端口转发将使用私网地址的服务器发布到公网，以便让互联网用户访问。例如，当接收互联网用户的 HTTP 请求时，网关服务器判断数据包的目标地址与目标端口，一旦匹配指定规则，则将其目标地址修改为内网真正的服务器地址，从而建立有效连接。</li>
</ul>
<h4 id="二、地址伪装和端口转发配置"><a href="#二、地址伪装和端口转发配置" class="headerlink" title="二、地址伪装和端口转发配置"></a>二、地址伪装和端口转发配置</h4><h5 id="1、地址伪装"><a href="#1、地址伪装" class="headerlink" title="1、地址伪装"></a>1、地址伪装</h5><ul>
<li><p>为指定区域增加地址伪装功能</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd [--permanent] [--zone=zone] --add-masquerade [--timeout=seconds]#--timeout=seconds：在一段时间后自动删除该功能</span><br></pre></td></tr></table></figure>
</li>
<li><p>为指定区域删除地址伪装功能</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd [--permanent] [--zone=zone] --remove-masquerade</span><br></pre></td></tr></table></figure>
</li>
<li><p>查询指定区域是否开启地址伪装功能</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd [--permanent] [--zone=zone] --query-masquerade</span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="2、端口转发-1"><a href="#2、端口转发-1" class="headerlink" title="2、端口转发"></a>2、端口转发</h5><ul>
<li><p>列出端口转发配置</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd [--permanent] [--zone=zone] --list-forward-ports</span><br></pre></td></tr></table></figure>
</li>
<li><p>添加端口转发规则</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd [--permanent] [--zone=zone] --add-forward-port=port=portid[portid]:proto=protocol[:toport=portid[-portid]][:toaddr=address[/mask]][--timeout=seconds]</span><br></pre></td></tr></table></figure>
</li>
<li><p>删除端口转发规则</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd [--permanent] [--zone=zone] --remove-forward-port=port=portid[portid]:proto=protocol[:toport=portid[-portid]][:toaddr=address[/mask]]</span><br></pre></td></tr></table></figure>
</li>
<li><p>查询端口转发规则</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">firewall-cmd [--permanent] [--zone=zone] --query-forward-port=port=portid[portid]:proto=protocol[:toport=portid[-portid]][:toaddr=address[/mask]]</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="三、Firewalld-直接规则"><a href="#三、Firewalld-直接规则" class="headerlink" title="三、Firewalld 直接规则"></a>三、Firewalld 直接规则</h4><ul>
<li>firewalld提供了“direct interface（直接接口），它允许管理员手动 ” 编写的iptables、ip6tables 和 ebtables 规则插入 firewalld 管理的区域中，适用于应用程序，而不是用户。如果对 iptables 不太熟，不建议使用直接接口，可能会无意中导致防火墙被入侵。firewalld保持对所增加项目的追踪，所以它还能质询 firewalld 和发现使用直接端口模式的程序造成的更改。直接端口通过 firewall-cmd 命令中的<code>--direct</code> 选项实现。除非将直接规则显式插入 firewalld 管理的区域，否则将首先解析直接规则，然后解析其他 firewalld 规则。执行以下命令即可添加一些直接规则以将某个 IP 范围列入黑名单。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# firewall-cmd --direct --permanent --add-chain ipv4 raw blacklistsuccess[root@localhost ~]# firewall-cmd --direct --permanent --add-rule ipv4 raw PREROUTING 0 -s 192.168.0.0/24 -j blacklistsuccess[root@localhost ~]# firewall-cmd --direct --permanent --add-rule ipv4 raw blacklist 0 -m limit --limit 1/min -j LOG --log-prefix &quot;blacklisted&quot;success[root@localhost ~]# firewall-cmd --direct --permanent --add-rule ipv4 raw blacklist 1 -j DROPsuccess</span><br></pre></td></tr></table></figure>

<h4 id="四、Firewalld-富语言规则"><a href="#四、Firewalld-富语言规则" class="headerlink" title="四、Firewalld 富语言规则"></a>四、Firewalld 富语言规则</h4><ul>
<li>firewalld 的富语言（rich language）提供了一种不需要了解 iptables 语法的通过高级语言配置复杂 IPv4 和 IPv6 防火墙规则的机制，为管理员提供了一种表达性语言，通过这种语言可以表达 firewalld 的基本语法中未涵盖的自定义防火墙规则。例如，仅允许从单个 IP 地址（而非通过某个区域路由的所有 IP 地址）连接到服务。</li>
<li>富规则可用于表达基本的允许&#x2F;拒绝规则，也可以用于配置记录（面向 syslog 和 auditd），以及端口转发、伪装和速率限制</li>
</ul>
<h5 id="1、基本语法"><a href="#1、基本语法" class="headerlink" title="1、基本语法"></a>1、基本语法</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rule [family=&quot;&lt;rule family&gt;&quot;]  [ source address=&quot;&lt;address&gt;&quot; [invert=&quot;True&quot;] ]  [ destination address=&quot;&lt;address&gt;&quot; [invert=&quot;True&quot;] ]  [ &lt;element&gt; ]  [ log [prefix=&quot;&lt;prefix text&gt;&quot;] [level=&quot;&lt;log level&gt;&quot;] [limit value=&quot;rate/ duration&quot;] ]  [ audit ]  [ accept|reject|drop ]#规则的每个单一元素都能够以 option=value 的形式来采用附加参数</span><br></pre></td></tr></table></figure>

<ul>
<li>规则排序<ul>
<li>一旦向某个区域（一般是指防火墙）中添加了多个规则，规则的排序会在很大程度上影响防火墙的行为。对于所有的区域，区域内的规则的基本排序是相同的。 如果区域中的任何规则与包均不匹配，通常会拒绝该包，但是区域可能具有不同的默认值。例如，可信区域（trusted）将接收任何不匹配的包。此外，在匹配某个记录规则后，将继续正常处理包。</li>
<li>直接规则是个例外。大部分直接规则将首先进行解析，然后由 firewalld 进行其他处理，但是直接规则语法允许管理员在任何区域中的任何位置插入任何规则。</li>
</ul>
</li>
<li>测试和调试<ul>
<li>为了便于测试和调试，几乎所有规则都可以与超时一起添加到运行时配置。当包含超时的规则添加到防火墙时，计时器便针对该规则开始倒计时，一旦规则的计时器达到 0 秒，便从运行时配置中删除该规则。在使用远程防火墙时，使用超时会是一种极其有用的工具，特别是在测试更复杂的规则集时。如果规则有效，则管理员可以再次添加该规则；如果规则没有按照预期运行，甚至可能将管理员锁定而使其无法进入系统，那么规则将被自动删除，以允许管理员可以继续工作。</li>
<li>通过在启用规则的 firewall-cmd 命令的结尾追加选项<code>--timeout=&lt;TIMEINSECONDS&gt;</code>,可向运行时规则中添加超时。</li>
</ul>
</li>
</ul>
<h5 id="2、富语言规则命令"><a href="#2、富语言规则命令" class="headerlink" title="2、富语言规则命令"></a>2、富语言规则命令</h5><table>
<thead>
<tr>
<th align="left">选项</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">—add-rich-rule&#x3D;’RULE’</td>
<td align="left">向指定区域中添加 RULE，如果没有指定区域，则为默认区域</td>
</tr>
<tr>
<td align="left">—remove-rich-rule&#x3D;’RULE’</td>
<td align="left">从指定区域中删除 RULE，如果没有指定区域，则为默认区域</td>
</tr>
<tr>
<td align="left">—query-rich-rule&#x3D;’RULE’</td>
<td align="left">查询 RULE 是否已添加到指定区域，如果未指定区域，则为默认区域。规则存在，则返回 0，否则返回 1</td>
</tr>
<tr>
<td align="left">—list-rich-rules</td>
<td align="left">输出指定区域的所有富规则，如果未指定区域，则为默认区域</td>
</tr>
</tbody></table>
<ul>
<li><p>任 何 已 配 置 的 富 规 则 都 会 显示在 firewall-cmd —list-all 和 firewall-cmd —list-all-zones 的输出结果中</p>
<ul>
<li><p>source：限制源 IP 地址，源地址可以是一个 IPv4、IPv6 地址或者一个网络地址段。</p>
</li>
<li><p>destination：限制目标地址，目标地址使用跟源地址相同的语法。</p>
</li>
<li><p>element：要素，该项只能是以下几种要素类型之一：service、port 、protocol、icmp-block、masquerade 和 forward-port</p>
<ul>
<li><p>service：服务名称是 firewalld 提供的其中一种服务。要获得支持的服务列表，输入以下命令： firewall-cmd —get-services 。如果一个服务提供了一个目标地址，它和规则中的目标地址冲突，则会导致一个错误。命令格式为：service name&#x3D;service_name。</p>
</li>
<li><p>port：端口可以是一个独立端口数字，或者是端口范围，如 5060～5062。协议为 TCP或 UDP 。命令格式为：port port&#x3D;number_or_range protocol&#x3D;protocol。</p>
</li>
<li><p>protocol：协议，可以是一个协议 ID 号，或者一个协议名。查询可用协议，请查阅&#x2F;etc&#x2F;protocols。命令格式为：protocol value&#x3D;protocol_name_or_ID。</p>
</li>
<li><p>icmp-block：阻断一个或多个 ICMP 类型。要获得支持的 ICMP 类型列表，输入firewall-cmd —get-icmptypes 命 令 即 可 查 看 。 命 令 格式为 ： icmp-block name&#x3D;icmptype_name。</p>
</li>
<li><p>masquerade：规则里的 IP 伪装。用源地址而不是目的地址来把伪装限制在一个范围内</p>
</li>
<li><p>forward-port：将指定的 TCP 或 UDP 协议的数据包转发到本机的其他端口，或另一台机器，或另一台机器上的其他端口。 port 和 to-port 可以是一个单独的端口数字，或一个端口范围。而目的地址是一个简单的 IP 地址。命令格式为：</p>
<p>forward-port port&#x3D;number_or_range protocol&#x3D;protocol to-port&#x3D;number_or_range to-addr&#x3D;address</p>
</li>
</ul>
</li>
<li><p>log：注册有内核日志的连接请求到规则中，如系统日志。可以定义一个前缀文本把日志信息作为前缀加入。日志等级可以是emerg、alert、crit、error、warning、notice、info 或者 debug 中的一个。可以选择日志的用法，按以下方式限制日志：</p>
<p>log [prefix&#x3D;prefix text] [level&#x3D;log level] limit value&#x3D;rate&#x2F;duration。持续时间的单位为 s、 m、 h、 d。 s 表示秒， m 表示分钟， h 表示小时， d 表示天。最大限定值是 1&#x2F;d（每天最多有一条日志进入）。</p>
</li>
<li><p>audit：审核，审核类型可以是 accept、reject 或 drop 中的一种，但不能在 audit 命令后指定，因为审核类型将会从规则动作中自动收集。审核不包含自身参数，但可以选择性地增加限制。审核的使用是可选择的</p>
</li>
<li><p>accept|reject|drop：可以是 accept、reject 或 drop 中的一个行为。命令格式为：accept | reject [type&#x3D;reject type] | drop。指定 accept 时，所有新的连接请求都将被允许。指定 reject 时，连接将被拒绝，发起端将接到一个拒绝信息。指定 drop时，所有数据包会被丢弃，并且不会向发起端发送任何信息</p>
</li>
</ul>
</li>
</ul>
<h5 id="3、语法案例"><a href="#3、语法案例" class="headerlink" title="3、语法案例"></a>3、语法案例</h5><ul>
<li><p>为认证报头协议 AH 使用新的 IPv4 和 IPv6 连接</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@gateway-server ~]# firewall-cmd --add-rich-rule=&#x27;rule protocol value=ah accept&#x27; success</span><br></pre></td></tr></table></figure>
</li>
<li><p>允许新的 IPv4 和 IPv6 连接 FTP，并使用审核每分钟记录一次</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@gateway-server ~]# firewall-cmd --add-rich-rule=&#x27;rule service name=ftp log limit value=1/m audit accept&#x27;success</span><br></pre></td></tr></table></figure>
</li>
<li><p>允许来自 192.168.0.0&#x2F;24 地址的 TFTP 协议的 IPv4 连接，并且使用系统日志每分钟记录一次</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@gateway-server ~]# firewall-cmd --add-rich-rule=&#x27;rule family=&quot;ipv4&quot; source address=&quot;192.168.0.0/24&quot; service name=&quot;tftp&quot; log prefix=&quot;tftp&quot; level=&quot;info&quot; limit value=&quot;1/m&quot; accept&#x27; success</span><br></pre></td></tr></table></figure>
</li>
<li><p>为 RADIUS协议拒绝所有来自1∶2∶3∶4∶6∶∶的新IPv6连接，日志前缀为“dns”，级别为“info”，并每分钟最多记录 3 次。接受来自其他发起端新的 IPv6 连接</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@gateway-server ~]# firewall-cmd --add-rich-rule=&#x27;rule family=&quot;ipv6&quot; source address=&quot;136::&quot; service name=&quot;radius&quot; log prefix=&quot;dns&quot; level=&quot;info&quot; limit value=&quot;3/m&quot; reject&#x27; success[root@gateway-server ~]# firewall-cmd --add-rich-rule=&#x27;rule family=&quot;ipv6&quot; service name=&quot;radius&quot; accept&#x27; success</span><br></pre></td></tr></table></figure>
</li>
<li><p>将源 192.168.2.2 地址加入白名单，以允许来自这个源地址的所有连接</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@gateway-server ~]# firewall-cmd --add-rich-rule=&#x27;rule family=&quot;ipv4&quot; source address=&quot;192.168.2.2&quot; accept&#x27; success</span><br></pre></td></tr></table></figure>
</li>
<li><p>拒绝来自 public 区域中 IP 地址 192.168.0.11 的所有流量</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@gateway-server ~]# firewall-cmd --zone=public --add-rich-rule=&#x27;rule family=ipv4 source address=192.168.0.11/32 reject&#x27;success</span><br></pre></td></tr></table></figure>
</li>
<li><p>丢弃来自默认区域中任何位置的所有传入的 ipsec esp 协议包</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@gateway-server ~]# firewall-cmd --add-rich-rule=&#x27;rule protocol value= &quot;esp&quot; drop&#x27; success</span><br></pre></td></tr></table></figure>
</li>
<li><p>在 192.168.1.0&#x2F;24 子网的 dmz 区域中，接收端口 7900～7905 的所有 TCP 包</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@gateway-server ~]# firewall-cmd --zone=dmz --add-rich-rule=&#x27;rule family= ipv4 source address=192.168.1.0/24 port port=7900-7905 protocol=tcp accept&#x27;success</span><br></pre></td></tr></table></figure>
</li>
<li><p>接收从 work 区域到 SSH 的新连接，以 notice 级别且每分钟最多三条消息的方式将新连接记录到 syslog</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@gateway-server ~]# firewall-cmd --zone=work --add-rich-rule=&#x27;rule service name=ssh log prefix=&quot;ssh&quot; level=&quot;notice&quot; limit value=&quot;3/m&quot; accept&#x27; success</span><br></pre></td></tr></table></figure>
</li>
<li><p>在接下来的 5min 内，拒绝从默认区域中的子网 192.168.2.0&#x2F;24 到 DNS 的新连接，并且拒绝的连接将记录到 audit 系统，且每小时最多一条消息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@gateway-server ~]# firewall-cmd --add-rich-rule=&#x27;rule family=ipv4 source address=192.168.2.0/24 service name=dns audit limit value=&quot;1/h&quot; reject&#x27; --timeout=300 success</span><br></pre></td></tr></table></figure></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/10/22/linux%E9%98%B2%E7%81%AB%E5%A2%99%E5%9F%BA%E7%A1%80-firewalld%E6%A0%87%E5%87%86%E8%A7%84%E5%88%99/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="鹿祁">
      <meta itemprop="description" content="心有希冀，目有繁星，追光而遇，沐光而行">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鹿鹿祁">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/10/22/linux%E9%98%B2%E7%81%AB%E5%A2%99%E5%9F%BA%E7%A1%80-firewalld%E6%A0%87%E5%87%86%E8%A7%84%E5%88%99/" class="post-title-link" itemprop="url">linux防火墙基础-firewalld标准规则</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-10-22 22:37:02 / 修改时间：23:23:03" itemprop="dateCreated datePublished" datetime="2023-10-22T22:37:02+08:00">2023-10-22</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="一、Firewalld-概述"><a href="#一、Firewalld-概述" class="headerlink" title="一、Firewalld 概述"></a>一、Firewalld 概述</h4><h5 id="1、简介"><a href="#1、简介" class="headerlink" title="1、简介"></a>1、简介</h5><ul>
<li>firewalld 的作用是为包过滤机制提供匹配规则（或称为策略），通过各种不同的规则，告诉 netfilter 对来自指定源、前往指定目的或具有某些协议特征的数据包采取何种处理方式。</li>
<li>为了更加方便地组织和管理防火墙，firewalld 提供了支持网络区域所定义的网络链接以及接口安全等级的动态防火墙管理工具。</li>
<li>它支持 IPv4、IPv6 防火墙设置以及以太网桥，并且拥有两种配置模式：运行时配置与永久配置。</li>
<li>它还支持服务或应用程序直接添加防火墙规则接口。</li>
</ul>
<h5 id="2、firewalld-和-iptables-的关系"><a href="#2、firewalld-和-iptables-的关系" class="headerlink" title="2、firewalld 和 iptables 的关系"></a>2、firewalld 和 iptables 的关系</h5><ul>
<li><p>firewalld 自身并不具备防火墙的功能，而是和 iptables 一样需要通过内核的netfilter 来实现，也就是说 firewalld 和 iptables 一样，他们的作用都是用于维护规则，而真正使用规则干活的是内核的 netfilter，只不过 firewalld 和 iptables 的结构以及使用方法不一样</p>
</li>
<li><p>系统提供了图像化的配置工具 firewall-config、system-config-firewall, 提供命令行客户端 firewall-cmd, 用于配置 firewalld 永久性或非永久性运行时间的改变:它依次用 iptables 工具与执行数据包筛选的内核中的 Netfilter 通信</p>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/202112230851543.png" alt="image-20211223085145444"></p>
</li>
</ul>
<h5 id="3、firewalld-和-iptables-service-之间最本质的不同"><a href="#3、firewalld-和-iptables-service-之间最本质的不同" class="headerlink" title="3、firewalld 和 iptables service 之间最本质的不同"></a>3、firewalld 和 iptables service 之间最本质的不同</h5><ul>
<li>iptables service 在 &#x2F;etc&#x2F;sysconfig&#x2F;iptables 中储存配置,而 firewalld 将配置储存在&#x2F;usr&#x2F;lib&#x2F;firewalld&#x2F; 和 &#x2F;etc&#x2F;firewalld&#x2F; 中的各种 XML 文件里。</li>
<li>使 用 iptables service 每一个单独更改意味着清除所有旧有的规则和从&#x2F;etc&#x2F;sysconfig&#x2F;iptables 里读取所有新的规则,然而使用 firewalld 却不会再创建任<br>何新的规则;仅仅运行规则中的不同之处。因此,firewalld 可以在运行时间内,改变设置而不丢失现行连接。</li>
</ul>
<h4 id="二、Firewalld-网络区域"><a href="#二、Firewalld-网络区域" class="headerlink" title="二、Firewalld 网络区域"></a>二、Firewalld 网络区域</h4><p>firewalld 将所有的网络数据流量划分为多个区域，从而简化防护墙管理。根据数据包的源 IP 地址或传入网络接口等条件，将数据流量转入相应区域的防火墙规则。对于进入系统的数据包，首先检查的就是其源地址。</p>
<h5 id="1、区域规则"><a href="#1、区域规则" class="headerlink" title="1、区域规则"></a>1、区域规则</h5><ul>
<li>若源地址关联到特定的区域，则执行该区域所制定的规则。</li>
<li>若源地址未关联到特定的区域，则使用传入网络接口的区域并执行该区域所制定的规则。</li>
<li>若网络接口未关联到特定的区域，则使用默认区域并执行该区域所制定的规则。</li>
</ul>
<table>
<thead>
<tr>
<th align="left">区域</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left">trusted （信任区域）</td>
<td align="left">可接收所有的网络连接</td>
</tr>
<tr>
<td align="left">public （公共区域）</td>
<td align="left">除非与传出流量相关，或与 ssh 或 dhcpv6-client 预定义服务匹配，否则拒绝流量传入， 在公共区域内，不能相信网络内的其他计算机不会对计算机造成危害，只能接收经过选择的连接。 并且，该区域是新添加网络接口的默认区域</td>
</tr>
<tr>
<td align="left">work （工作区域）</td>
<td align="left">除非与传出流量相关，或与 ssh、ipp-client、dhcpv6-client 预定义服务匹配，否则拒绝流量传入，用于工作区。 相信网络内的其他计算机不会危害计算机，仅接收经过选择的连接</td>
</tr>
<tr>
<td align="left">home （家庭区域）</td>
<td align="left">除非与传出流量相关，或与 ssh、ipp-client、mdns、samba-client、dhcpv6-client预定义服务匹配， 否则拒绝流量传入，用于家庭网络。 信任网络内的其他计算机不会危害计算机，仅接收经过选择的连接</td>
</tr>
<tr>
<td align="left">internal （内部区域）</td>
<td align="left">除非与传出流量相关，或与 ssh、ipp-client、mdns、samba-client、dhcpv6-client预定义服务匹配， 否则拒绝流量传入，用于内部网络。 信任网络内的其他计算机不会危害计算机，仅接收经过选择的连接</td>
</tr>
<tr>
<td align="left">external （外部区域）</td>
<td align="left">除非与传出流量相关，或与 ssh 预定义服务匹配，否则拒绝流量传入。 通过此区域转发的 IPv4 传出流量将进行地址伪装，可用于为路由器启用了伪装功能的外部网络</td>
</tr>
<tr>
<td align="left">dmz （隔离区域也称为非军事区域）</td>
<td align="left">除非与传出的流量相关，或与 ssh 预定义服务匹配，否则拒绝流量传入</td>
</tr>
<tr>
<td align="left">block （限制区域）</td>
<td align="left">除非与传出流量相关，否则拒绝所有传入流量</td>
</tr>
<tr>
<td align="left">drop （丢弃区域）</td>
<td align="left">除非与传出流量相关，否则丢弃所有传入流量， 并且不产生包含 ICMP（Internet Control Message Protocol，互联网控制报文协议）的错误响应</td>
</tr>
</tbody></table>
<h4 id="三、firewall-cmd-命令行工具配置"><a href="#三、firewall-cmd-命令行工具配置" class="headerlink" title="三、firewall-cmd 命令行工具配置"></a>三、firewall-cmd 命令行工具配置</h4><h5 id="1、启动、停止、查看-firewalld-服务"><a href="#1、启动、停止、查看-firewalld-服务" class="headerlink" title="1、启动、停止、查看 firewalld 服务"></a>1、启动、停止、查看 firewalld 服务</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# systemctl start firewalld[root@localhost ~]# systemctl stop firewalld[root@localhost ~]# systemctl status firewalld[root@localhost ~]# systemctl enable firewalld[root@localhost ~]# firewall-cmd --state            #查看状态running[root@Localhost /]# firewall-cmd --reload            #重载success</span><br></pre></td></tr></table></figure>

<h5 id="2、获取预定义信息"><a href="#2、获取预定义信息" class="headerlink" title="2、获取预定义信息"></a>2、获取预定义信息</h5><ul>
<li><p><code>firewall-cmd --get-zones</code>（显示预定义的区域）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# firewall-cmd --get-zonesblock dmz drop external home internal public trusted work</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>firewall-cmd --get-service</code>（显示预定义的服务）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# firewall-cmd --get-servicesRH-Satellite-6 amanda-client amanda-k5-client amqp amqps apcupsd audit bacula bacula-client bgp bitcoin bitcoin-rpc bitcoin-testnet bitcoin-testnet-rpc ceph ceph-mon cfengine condor-collector ctdb dhcp dhcpv6 dhcpv6-client distcc dns docker-registry docker-swarm dropbox-lansync elasticsearch etcd-client etcd-server finger freeipa-ldap freeipa-ldaps freeipa-replication freeipa-trust ftp ganglia-client ganglia-master git gre high-availability http https imap imaps ipp ipp-client ipsec irc ircs iscsi-target isns jenkins kadmin kerberos kibana klogin kpasswd kprop kshell ldap ldaps libvirt libvirt-tls lightning-network llmnr managesieve matrix mdns minidlna mongodb mosh mountd mqtt mqtt-tls ms-wbt mssql murmur mysql nfs nfs3 nmea-0183 nrpe ntp nut openvpn ovirt-imageio ovirt-storageconsole ovirt-vmconsole plex pmcd pmproxy pmwebapi pmwebapis pop3 pop3s postgresql privoxy proxy-dhcp ptp pulseaudio puppetmaster quassel radius redis rpc-bind rsh rsyncd rtsp salt-master samba samba-client samba-dc sane sip sips slp smtp smtp-submission smtps snmp snmptrap spideroak-lansync squid ssh steam-streaming svdrp svn syncthing syncthing-gui synergy syslog syslog-tls telnet tftp tftp-client tinc tor-socks transmission-client upnp-client vdsm vnc-server wbem-http wbem-https wsman wsmans xdmcp xmpp-bosh xmpp-client xmpp-local xmpp-server zabbix-agent zabbix-server</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>firewall-cmd --get-icmptypes</code>（显示预定义的 ICMP 类型）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# firewall-cmd --get-icmptypesaddress-unreachable bad-header communication-prohibited destination-unreachable echo-reply echo-request fragmentation-needed host-precedence-violation host-prohibited host-redirect host-unknown host-unreachable ip-header-bad neighbour-advertisement neighbour-solicitation network-prohibited network-redirect network-unknown network-unreachable no-route packet-too-big parameter-problem port-unreachable precedence-cutoff protocol-unreachable redirect required-option-missing router-advertisement router-solicitation source-quench source-route-failed time-exceeded timestamp-reply timestamp-request tos-host-redirect tos-host-unreachable tos-network-redirect tos-network-unreachable ttl-zero-during-reassembly ttl-zero-during-transit unknown-header-type unknown-option</span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="3、区域管理"><a href="#3、区域管理" class="headerlink" title="3、区域管理"></a>3、区域管理</h5><table>
<thead>
<tr>
<th align="left">选项</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>--get-default-zone</code></td>
<td align="left">显示网络连接或接口的默认区域</td>
</tr>
<tr>
<td align="left"><code>--set-default-zone=&lt;zone&gt;</code></td>
<td align="left">设置网络连接或接口的默认区域</td>
</tr>
<tr>
<td align="left"><code>--get-active-zones</code></td>
<td align="left">显示已激活的所有区域</td>
</tr>
<tr>
<td align="left"><code>--get-zone-of-interface=&lt;interface&gt;</code></td>
<td align="left">显示指定接口绑定的区域</td>
</tr>
<tr>
<td align="left"><code>--zone=&lt;zone&gt; --add-interface=&lt;interface&gt;</code></td>
<td align="left">为指定接口绑定区域</td>
</tr>
<tr>
<td align="left"><code>--zone=&lt;zone&gt;</code> <code>--change-interface=&lt;interface&gt;</code></td>
<td align="left">为指定的区域更改绑定的网络接口</td>
</tr>
<tr>
<td align="left"><code>--zone=&lt;zone&gt;</code> <code>--remove-interface=&lt;interface&gt;</code></td>
<td align="left">为指定的区域删除绑定的网络接口</td>
</tr>
<tr>
<td align="left"><code>--list-all-zones</code></td>
<td align="left">显示所有区域及其规则</td>
</tr>
<tr>
<td align="left"><code>[--zone=&lt;zone&gt;] --list-all</code></td>
<td align="left">显示所有指定区域的所有规则，省略<code>--zone=&lt;zone&gt;</code>时表示仅对默认区域操作</td>
</tr>
</tbody></table>
<h5 id="4、服务管理"><a href="#4、服务管理" class="headerlink" title="4、服务管理"></a>4、服务管理</h5><table>
<thead>
<tr>
<th align="left">选项</th>
<th align="left">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>[--zone=&lt;zone&gt;] --list-services</code></td>
<td align="left">显示指定区域内允许访问的所有服务</td>
</tr>
<tr>
<td align="left"><code>[--zone=&lt;zone&gt;] --add-service=&lt;service&gt;</code></td>
<td align="left">为指定区域设置允许访问的某项服务</td>
</tr>
<tr>
<td align="left"><code>[--zone=&lt;zone&gt;] --remove-service=&lt;service&gt;</code></td>
<td align="left">删除指定区域已设置的允许访问的某项服务</td>
</tr>
<tr>
<td align="left"><code>[--zone=&lt;zone&gt;] --list-ports</code></td>
<td align="left">显示指定区域内允许访问的所有端口号</td>
</tr>
<tr>
<td align="left"><code>[--zone=&lt;zone&gt;]</code> <code>--add-port=&lt;portid&gt;[-&lt;portid&gt;]/&lt;protocol&gt;</code></td>
<td align="left">为指定区域设置允许访问的某个&#x2F;某段端口号（包括协议名）</td>
</tr>
<tr>
<td align="left"><code>[--zone=&lt;zone&gt;]</code> <code>--remove-port=&lt;portid&gt;[-&lt;portid&gt;]/&lt;protocol&gt;</code></td>
<td align="left">删除指定区域已设置的允许访问的端口号（包括协议名）</td>
</tr>
<tr>
<td align="left"><code>[--zone=&lt;zone&gt;] --list-icmp-blocks</code></td>
<td align="left">显示指定区域内拒绝访问的所有 ICMP 类型</td>
</tr>
<tr>
<td align="left"><code>[--zone=&lt;zone&gt;] --add-icmp-block=&lt;icmptype&gt;</code></td>
<td align="left">为指定区域设置拒绝访问的某项 ICMP 类型</td>
</tr>
<tr>
<td align="left"><code>[--zone=&lt;zone&gt;] --remove-icmp-block=&lt;icmptype&gt;</code></td>
<td align="left">删除指定区域已设置的拒绝访问的某项 ICMP 类型， 省略<code>--zone=&lt;zone&gt;</code>时表示对默认区域操作</td>
</tr>
</tbody></table>
<h5 id="5、端口管理"><a href="#5、端口管理" class="headerlink" title="5、端口管理"></a>5、端口管理</h5><ul>
<li><p>在进行服务配置时，预定义的网络服务可以使用服务名配置，服务所涉及的端口就会自动打开。</p>
</li>
<li><p>但是，对于非预定义的服务只能手动为指定的区域添加端口。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# firewall-cmd --zone=internal --add-port=443/tcp success</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]#firewall-cmd --zone=internal --remove-port=443/tcp success</span><br></pre></td></tr></table></figure></li>
</ul>
<p>6、配置模式</p>
<ul>
<li><p>运行时模式（Runtime mode）：当前内存中运行的防火墙配置，在系统或 firewalld 服务重启、停止时配置将失效</p>
</li>
<li><p>永久模式（Permanent mode）：重启防火墙或重新加载防火墙时的规则配置，是永久存储在配置文件中的。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">--reload：重新加载防火墙规则并保持状态信息，即将永久配置应用为运行时配置。--permanent：带有此选项的命令用于设置永久性规则，这些规则只有在重新启动firewalld 或重新加载防火墙规则时才会生效；若不带有此选项，表示用于设置运行时规则。--runtime-to-permanent：将当前的运行时配置写入规则配置文件中，使之成为永久性配置</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="四、案例"><a href="#四、案例" class="headerlink" title="四、案例"></a>四、案例</h4><h5 id="1、实验环境"><a href="#1、实验环境" class="headerlink" title="1、实验环境"></a>1、实验环境</h5><p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/202112230939076.png" alt="image-20211223093918005"></p>
<h5 id="2、实验需求"><a href="#2、实验需求" class="headerlink" title="2、实验需求"></a>2、实验需求</h5><ul>
<li>禁止主机 ping 服务器</li>
<li>只允许 192.168.8.130 主机访问 SSH 服务</li>
<li>允许所有主机访问 Apache 服务</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/10/22/linux%E9%98%B2%E7%81%AB%E5%A2%99%E5%9F%BA%E7%A1%80-iptables%E5%AE%9E%E6%88%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="鹿祁">
      <meta itemprop="description" content="心有希冀，目有繁星，追光而遇，沐光而行">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鹿鹿祁">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/10/22/linux%E9%98%B2%E7%81%AB%E5%A2%99%E5%9F%BA%E7%A1%80-iptables%E5%AE%9E%E6%88%98/" class="post-title-link" itemprop="url">linux防火墙基础-iptables实战</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-10-22 22:36:41 / 修改时间：23:22:42" itemprop="dateCreated datePublished" datetime="2023-10-22T22:36:41+08:00">2023-10-22</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="一、iptables-NAT策略"><a href="#一、iptables-NAT策略" class="headerlink" title="一、iptables NAT策略"></a>一、iptables NAT策略</h4><h5 id="1、SNAT"><a href="#1、SNAT" class="headerlink" title="1、SNAT"></a>1、SNAT</h5><ul>
<li><p>源地址转换，Source Network Address Translation，典型应用环境（局域网主机共享单个公网IP地址接入Internet）</p>
</li>
<li><p>前提条件</p>
<ul>
<li>局域网各主机正确设置IP地址&#x2F;子网掩码</li>
<li>局域网各主机正确设置默认网关地址</li>
<li>Linux网关支持IP路由转发</li>
</ul>
</li>
<li><p>实现方式</p>
<ul>
<li><p>开启 IPv4 转发</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# echo net.ipv4.ip_forward = 1 &gt;&gt; /etc/sysctl.conf</span><br></pre></td></tr></table></figure>
</li>
<li><p>允许转发</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# iptables -I FORWARD -p tcp -j ACCEPT</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置 SNAT</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# iptables -t nat -A POSTROUTING -s 192.168.1.0/24 -o ens33 -j SNAT --to-source 218.29.30.31#ens33入站网卡</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>地址伪装（MASQUERADE）</p>
<ul>
<li>适用于外网IP地址非固定的情况</li>
<li>对于ADSL拨号连接，接口通常为 ppp0、ppp1</li>
<li>将SNAT规则改为MASQUERADE即可</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# iptables -t nat -A POSTROUTING -s 192.168.1.0/24 -o ens33 -j MASQUERADE</span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="2、DNAT"><a href="#2、DNAT" class="headerlink" title="2、DNAT"></a>2、DNAT</h5><ul>
<li><p>目标地址转换，Destination Network Address Translation，典型应用环境（在Internet中发布位于企业局域网内的服务器）</p>
</li>
<li><p>前提条件</p>
<ul>
<li>局域网的Web服务器能够访问Internet</li>
<li>网关的外网IP地址有正确的DNS解析记录</li>
<li>Linux网关支持IP路由转发</li>
</ul>
</li>
<li><p>实现方式</p>
<ul>
<li><p>开启 IPv4 转发</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# echo net.ipv4.ip_forward = 1 &gt;&gt; /etc/sysctl.conf</span><br></pre></td></tr></table></figure>
</li>
<li><p>允许转发</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# iptables -I FORWARD -p tcp -j ACCEPT</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置 DNAT</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# iptables -t nat -A PREROUTING -i ens33 -d 218.29.30.31 -p tcp --dport 80 -j DNAT --to-destination 192.168.1.6#ens33 入站网卡</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#发布时修改目标端口[root@localhost ~]# iptables -t nat -A PREROUTING -i ens33 -d 218.29.30.31 -p tcp --dport 2346 -j DNAT --to-destination 192.168.1.6:22</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/10/22/linux%E9%98%B2%E7%81%AB%E5%A2%99%E5%9F%BA%E7%A1%80-iptables%E8%AF%AD%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="鹿祁">
      <meta itemprop="description" content="心有希冀，目有繁星，追光而遇，沐光而行">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鹿鹿祁">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/10/22/linux%E9%98%B2%E7%81%AB%E5%A2%99%E5%9F%BA%E7%A1%80-iptables%E8%AF%AD%E6%B3%95/" class="post-title-link" itemprop="url">linux防火墙基础-iptables语法</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-10-22 22:36:34 / 修改时间：23:22:29" itemprop="dateCreated datePublished" datetime="2023-10-22T22:36:34+08:00">2023-10-22</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="一、iptables语法"><a href="#一、iptables语法" class="headerlink" title="一、iptables语法"></a>一、iptables语法</h4><h5 id="1、语法构成"><a href="#1、语法构成" class="headerlink" title="1、语法构成"></a>1、语法构成</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">iptables  [-t 表名]  选项  [链名]  [条件]  [-j 控制类型]举例：[root@localhost ~]# iptables -t filter -I INPUT -p icmp -j REJECT</span><br></pre></td></tr></table></figure>

<ul>
<li>注意事项<ul>
<li>不指定表名时，默认指filter表</li>
<li>不指定链名时，默认指表内的所有链</li>
<li>除非设置链的默认策略，否则必须指定匹配条件</li>
<li>选项、链名、控制类型使用大写字母，其余均为小写</li>
</ul>
</li>
</ul>
<h5 id="2、常见控制类型"><a href="#2、常见控制类型" class="headerlink" title="2、常见控制类型"></a>2、常见控制类型</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ACCEPT：允许通过DROP：直接丢弃，不给出任何回应REJECT：拒绝通过，必要时会给出提示LOG：记录日志信息，然后传给下一条规则继续匹配</span><br></pre></td></tr></table></figure>

<h5 id="3、常见选项"><a href="#3、常见选项" class="headerlink" title="3、常见选项"></a>3、常见选项</h5><ul>
<li>管理选项</li>
</ul>
<table>
<thead>
<tr>
<th align="left">类别</th>
<th align="left">选项</th>
<th align="left">用途</th>
</tr>
</thead>
<tbody><tr>
<td align="left">添加新的规则</td>
<td align="left"><code>-A</code></td>
<td align="left">在链的末尾追加一条规则</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"><code>-I</code></td>
<td align="left">在链的开头（或指定序号）插入一条规则</td>
</tr>
<tr>
<td align="left">查看规则列表</td>
<td align="left"><code>-L</code></td>
<td align="left">列出所有的规则条目</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"><code>-n</code></td>
<td align="left">以数字形式显示地址、端口等信息</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"><code>-v</code></td>
<td align="left">以更详细的方式显示规则信息</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"><code>--line-numbers</code></td>
<td align="left">查看规则时，显示规则的序号</td>
</tr>
<tr>
<td align="left">删除、清空规则</td>
<td align="left"><code>-D</code></td>
<td align="left">删除链内指定序号（或内容）的一条规则</td>
</tr>
<tr>
<td align="left"></td>
<td align="left"><code>-F</code></td>
<td align="left">清空所有的规则</td>
</tr>
<tr>
<td align="left">设置默认策略</td>
<td align="left"><code>-P</code></td>
<td align="left">为指定的链设置默认规则</td>
</tr>
</tbody></table>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#添加新规则[root@localhost ~]# iptables -t filter -A INPUT -p tcp -j ACCEPT[root@localhost ~]# iptables -I INPUT -p udp -j ACCEPT[root@localhost ~]# iptables -I INPUT 2 -p icmp -j ACCEPT</span><br><span class="line">#查看规则[root@localhost ~]# iptables -nL --line-numbersChain INPUT (policy ACCEPT)num  target     prot opt source               destination         1    ACCEPT     tcp  --  0.0.0.0/0            0.0.0.0/0           2    ACCEPT     all  --  0.0.0.0/0            0.0.0.0/0            state RELATED,ESTABLISHED3    ACCEPT     icmp --  0.0.0.0/0            0.0.0.0/0           4    ACCEPT     all  --  0.0.0.0/0            0.0.0.0/0           5    ACCEPT     tcp  --  0.0.0.0/0            0.0.0.0/0            state NEW tcp dpt:226    REJECT     all  --  0.0.0.0/0            0.0.0.0/0            reject-with icmp-host-prohibitedChain FORWARD (policy ACCEPT)num  target     prot opt source               destination         1    ACCEPT     tcp  --  0.0.0.0/0            0.0.0.0/0           2    ACCEPT     icmp --  0.0.0.0/0            0.0.0.0/0           3    REJECT     all  --  0.0.0.0/0            0.0.0.0/0            reject-with icmp-host-prohibitedChain OUTPUT (policy ACCEPT)num  target     prot opt source               destination</span><br><span class="line">[root@localhost ~]# iptables -D INPUT 3        #指定序号删除规则</span><br><span class="line">#删除所有规则[root@localhost ~]# iptables -F[root@localhost ~]# iptables -t nat -F[root@localhost ~]# iptables -t mangle -F[root@localhost ~]# iptables -t raw -F</span><br><span class="line">#为指定的链设置默认规则（要么是允许，要么是丢弃）[root@localhost ~]# iptables -t filter -P FORWARD DROP[root@localhost ~]# iptables -P OUTPUT ACCEPT</span><br></pre></td></tr></table></figure>

<ul>
<li>匹配条件</li>
</ul>
<table>
<thead>
<tr>
<th align="left">类别</th>
<th align="left">条件类型</th>
<th align="left">用法</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td align="left">通用匹配</td>
<td align="left">协议匹配</td>
<td align="left">-p 协议名</td>
<td></td>
</tr>
<tr>
<td align="left"></td>
<td align="left">地址匹配</td>
<td align="left">-s 源地址、-d 目的地址</td>
<td></td>
</tr>
<tr>
<td align="left"></td>
<td align="left">接口匹配</td>
<td align="left">-i 入站网卡、-o 出站网卡</td>
<td></td>
</tr>
<tr>
<td align="left">隐含匹配</td>
<td align="left">端口匹配</td>
<td align="left">—sport 源端口、—dport 目的端口</td>
<td></td>
</tr>
<tr>
<td align="left"></td>
<td align="left">TCP标记匹配</td>
<td align="left">—tcp-flags 检查范围 被设置的标记</td>
<td></td>
</tr>
<tr>
<td align="left"></td>
<td align="left">ICMP类型匹配</td>
<td align="left">—icmp-type ICMP类型</td>
<td></td>
</tr>
<tr>
<td align="left">显式匹配</td>
<td align="left">多端口匹配</td>
<td align="left">-m multiport —sports \</td>
<td>—dports 端口列表</td>
</tr>
<tr>
<td align="left"></td>
<td align="left">IP范围匹配</td>
<td align="left">-m iprange —src-range IP范围</td>
<td></td>
</tr>
<tr>
<td align="left"></td>
<td align="left">MAC地址匹配</td>
<td align="left">-m mac —mac-source MAC地址</td>
<td></td>
</tr>
<tr>
<td align="left"></td>
<td align="left">状态匹配</td>
<td align="left">-m state —state 连接状态 (<code>NEW</code>新连接、<code>ESTABLISHED</code>双向传输、<code>RELATED</code>新连接但前提是有链接、<code>INVAILD</code>未知链接，一般DROP)</td>
<td></td>
</tr>
</tbody></table>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># “ ! ” 表示取反[root@localhost ~]# iptables -I INPUT -p icmp -j DROP[root@localhost ~]# iptables -A FORWARD ! -p icmp -j ACCEPT# -s 指定源地址[root@localhost ~]# iptables -A FORWARD -s 192.168.1.11 -j REJECT[root@localhost ~]# iptables -I INPUT -s 10.20.30.0/24 -j DROP # -i ens37    指定入站网卡[root@localhost ~]# iptables -A INPUT -i ens37 -s 192.168.0.0/16 -j DROP [root@localhost ~]# iptables -A INPUT -i ens37 -s 10.0.0.0/8 -j DROP[root@localhost ~]# iptables -A INPUT -i ens37 -s 172.16.0.0/12 -j DROP</span><br><span class="line"># --dport 20:21 指定目标端口20和21[root@localhost ~]# iptables -A FORWARD -s 192.168.4.0/24 -p udp --dport 53 -j ACCEPT[root@localhost ~]# iptables -A INPUT -p tcp --dport 20:21 -j ACCEPT</span><br><span class="line"># 指定ICMP类型[root@localhost ~]# iptables -A INPUT -p icmp --icmp-type 8 -j DROP[root@localhost ~]# iptables -A INPUT -p icmp --icmp-type 0 -j ACCEPT[root@localhost ~]# iptables -A INPUT -p icmp --icmp-type 3 -j ACCEPT[root@localhost ~]# iptables -A INPUT -p icmp -j DROP</span><br><span class="line">#指定目的范围端口[root@localhost ~]# iptables -P INPUT DROP[root@localhost ~]# iptables -I INPUT -p tcp -m multiport --dport 80 -j  ACCEPT[root@localhost ~]# iptables -I INPUT -p tcp -m state --state ESTABLISHED -j ACCEPT</span><br><span class="line">#指定范围多端口，指定IP范围，指定源MAC[root@localhost ~]# iptables -A INPUT -p tcp -m multiport --dport 25,80,110,143 -j ACCEPT[root@localhost ~]# iptables -A FORWARD -p tcp -m iprange --src-range 192.168.4.21-192.168.4.28 -j ACCEPT[root@localhost ~]# iptables -A INPUT -m mac --mac-source 00:0c:29:c0:55:3f -j DROP</span><br></pre></td></tr></table></figure>

<h5 id="4、永久性保存修改的规则"><a href="#4、永久性保存修改的规则" class="headerlink" title="4、永久性保存修改的规则"></a>4、永久性保存修改的规则</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]#iptables-save &gt; /etc/sysconfig/iptables</span><br></pre></td></tr></table></figure>

<h5 id="5、提供状态化链接"><a href="#5、提供状态化链接" class="headerlink" title="5、提供状态化链接"></a>5、提供状态化链接</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# iptables -I FORWARD -p tcp -m state --state NEW,ESTABLISHED -j ACCEPT</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/10/22/linux%E9%98%B2%E7%81%AB%E5%A2%99%E5%9F%BA%E7%A1%80-iptables%E8%A7%84%E5%88%99%E8%A1%A8%E4%BB%A5%E5%8F%8A%E8%A7%84%E5%88%99%E9%93%BE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="鹿祁">
      <meta itemprop="description" content="心有希冀，目有繁星，追光而遇，沐光而行">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鹿鹿祁">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/10/22/linux%E9%98%B2%E7%81%AB%E5%A2%99%E5%9F%BA%E7%A1%80-iptables%E8%A7%84%E5%88%99%E8%A1%A8%E4%BB%A5%E5%8F%8A%E8%A7%84%E5%88%99%E9%93%BE/" class="post-title-link" itemprop="url">linux防火墙基础-iptables规则表以及规则链</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-10-22 22:36:27 / 修改时间：23:22:13" itemprop="dateCreated datePublished" datetime="2023-10-22T22:36:27+08:00">2023-10-22</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="一、Linux防火墙基础"><a href="#一、Linux防火墙基础" class="headerlink" title="一、Linux防火墙基础"></a>一、Linux防火墙基础</h4><h5 id="1、Linux包过滤防火墙"><a href="#1、Linux包过滤防火墙" class="headerlink" title="1、Linux包过滤防火墙"></a>1、Linux包过滤防火墙</h5><ul>
<li>netfilter<ul>
<li>Linux 2.4.x引入的一个子系统，它作为一个通用的、抽象的框架，提供一整套的hook函数的管理机制，使得诸如数据包过滤、网络地址转换(NAT)和基于协议类型的连接跟踪成为了可能</li>
<li>位于Linux内核中的包过滤功能体系，称为Linux防火墙的“内核态”</li>
</ul>
</li>
<li>iptables<ul>
<li>与最新的 3.5 版本 Linux 内核集成的 IP 信息包过滤系统。如果 Linux 系统连接到因特网或 LAN、服务器或连接 LAN 和因特网的代理服务器， 则该系统有利于在 Linux 系统上更好地控制 IP 信息包过滤和防火墙配置</li>
<li>位于&#x2F;sbin&#x2F;iptables，用来管理防火墙规则的工具</li>
<li>称为Linux防火墙的“用户态”</li>
</ul>
</li>
</ul>
<h5 id="2、包过滤原理"><a href="#2、包过滤原理" class="headerlink" title="2、包过滤原理"></a>2、包过滤原理</h5><ul>
<li><p>主要是网络层，针对IP数据包</p>
</li>
<li><p>体现在对包内的IP地址、端口等信息的处理上</p>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/202112230613687.png" alt="image-20211223061305634"></p>
</li>
</ul>
<h4 id="二、iptables"><a href="#二、iptables" class="headerlink" title="二、iptables"></a>二、iptables</h4><h5 id="1、安装与配置"><a href="#1、安装与配置" class="headerlink" title="1、安装与配置"></a>1、安装与配置</h5><ul>
<li><p>CentOS 7之后系统默认使用 Firealld 防火墙，这里如要使用 iptables 需要进行安装并停用 Fireawalld 防火墙</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@woniuyang ~]# systemctl stop firewalld[root@woniuyang ~]# systemctl disable firewalldRemoved symlink /etc/systemd/system/multi-user.target.wants/firewalld.service.Removed symlink /etc/systemd/system/dbus-org.fedoraproject.FirewallD1.service.</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@woniuyang ~]# yum -y install iptables iptables-services</span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="2、规则链"><a href="#2、规则链" class="headerlink" title="2、规则链"></a>2、规则链</h5><ul>
<li>规则的作用：对数据包进行过滤或处理</li>
<li>链的作用：容纳各种防火墙规则</li>
<li>链的分类依据：处理数据包的不同时机</li>
<li>5种规则链<ul>
<li>INPUT：处理入站数据包</li>
<li>OUTPUT：处理出站数据包</li>
<li>FORWARD：处理转发数据包</li>
<li>POSTROUTING链：在进行路由选择后处理数据包</li>
<li>PREROUTING链：在进行路由选择前处理数据包</li>
</ul>
</li>
</ul>
<h5 id="3、规则表"><a href="#3、规则表" class="headerlink" title="3、规则表"></a>3、规则表</h5><ul>
<li>表的作用：容纳各种规则链</li>
<li>表的划分依据：防火墙规则的作用相似</li>
<li>4个规则表<ul>
<li>raw表：确定是否对该数据包进行状态跟踪</li>
<li>mangle表：为数据包设置标记</li>
<li>nat表：修改数据包中的源、目标IP地址或端口</li>
<li>filter表：确定是否放行该数据包（过滤）</li>
</ul>
</li>
</ul>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/202112230619969.png" alt="image-20211223061910923"></p>
<h5 id="4、匹配流程"><a href="#4、匹配流程" class="headerlink" title="4、匹配流程"></a>4、匹配流程</h5><ul>
<li><p>规则表之间的顺序：raw→mangle→nat→filter</p>
</li>
<li><p>规则链之间的顺序</p>
<ul>
<li>入站：PREROUTING→INPUT</li>
<li>出站：OUTPUT→POSTROUTING</li>
<li>转发：PREROUTING→FORWARD→POSTROUTING</li>
</ul>
</li>
<li><p>按顺序依次检查，匹配即停止（LOG策略例外）</p>
</li>
<li><p>若找不到相匹配的规则，则按该链的默认策略处理</p>
</li>
<li><p>如果没有任何策略，则直接允许</p>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/202112230621997.png" alt="image-20211223062127947"></p>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/10/22/linux%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%9F%BA%E7%A1%80-iptables%E8%A7%84%E5%88%99%E8%A1%A8%E4%BB%A5%E5%8F%8A%E8%A7%84%E5%88%99%E9%93%BE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="鹿祁">
      <meta itemprop="description" content="心有希冀，目有繁星，追光而遇，沐光而行">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鹿鹿祁">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/10/22/linux%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%9F%BA%E7%A1%80-iptables%E8%A7%84%E5%88%99%E8%A1%A8%E4%BB%A5%E5%8F%8A%E8%A7%84%E5%88%99%E9%93%BE/" class="post-title-link" itemprop="url">linux操作系统基础-iptables规则表以及规则链</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-10-22 22:36:08" itemprop="dateCreated datePublished" datetime="2023-10-22T22:36:08+08:00">2023-10-22</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/11/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/11/">11</a><span class="page-number current">12</span><a class="page-number" href="/page/13/">13</a><span class="space">&hellip;</span><a class="page-number" href="/page/22/">22</a><a class="extend next" rel="next" href="/page/13/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">鹿祁</p>
  <div class="site-description" itemprop="description">心有希冀，目有繁星，追光而遇，沐光而行</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">219</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">12</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">鹿祁</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  
  <script color='0,0,255' opacity='0.5' zIndex='-1' count='99' src="/lib/canvas-nest/canvas-nest.min.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>


  <script defer src="/lib/three/three.min.js"></script>


  















  

  

</body>
</html>

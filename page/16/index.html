<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="心有希冀，目有繁星，追光而遇，沐光而行">
<meta property="og:type" content="website">
<meta property="og:title" content="鹿鹿祁">
<meta property="og:url" content="http://example.com/page/16/index.html">
<meta property="og:site_name" content="鹿鹿祁">
<meta property="og:description" content="心有希冀，目有繁星，追光而遇，沐光而行">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="鹿祁">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/page/16/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>鹿鹿祁</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">鹿鹿祁</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-schedule">

    <a href="/schedule/" rel="section"><i class="fa fa-calendar fa-fw"></i>日程表</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/10/22/%E6%B5%81%E9%87%8F%E6%94%BB%E5%87%BB-%E5%BA%94%E7%94%A8%E5%B1%82%E5%8D%8F%E8%AE%AE%EF%BC%88dhcp%E5%8D%8F%E8%AE%AE%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="鹿祁">
      <meta itemprop="description" content="心有希冀，目有繁星，追光而遇，沐光而行">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鹿鹿祁">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/10/22/%E6%B5%81%E9%87%8F%E6%94%BB%E5%87%BB-%E5%BA%94%E7%94%A8%E5%B1%82%E5%8D%8F%E8%AE%AE%EF%BC%88dhcp%E5%8D%8F%E8%AE%AE%EF%BC%89/" class="post-title-link" itemprop="url">流量攻击-应用层协议（dhcp协议）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-10-22 22:04:11 / 修改时间：22:30:09" itemprop="dateCreated datePublished" datetime="2023-10-22T22:04:11+08:00">2023-10-22</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="一、DHCP服务"><a href="#一、DHCP服务" class="headerlink" title="一、DHCP服务"></a>一、DHCP服务</h4><h5 id="1、DHCP概述"><a href="#1、DHCP概述" class="headerlink" title="1、DHCP概述"></a>1、DHCP概述</h5><ul>
<li>DHCP（动态主机配置协议）是一个局域网的网络协议。指的是由服务器控制一段IP地址范围，客户机登录服务器时就可以自动获得服务器分配的IP地址和子网掩码<ul>
<li>为网络中计算机自动分配TCP&#x2F;IP参数的协议<ul>
<li>IP地址、子网掩码、网关、DNS等</li>
</ul>
</li>
</ul>
</li>
<li>使用DHCP的好处<ul>
<li>减少管理员的工作量</li>
<li>避免输入错误的可能</li>
<li>避免IP冲突</li>
<li>提高了IP地址的利用率</li>
<li>方便客户端的配置</li>
</ul>
</li>
<li>DHCP分配方式<ul>
<li>自动分配 ：分配到一个IP地址后永久使用（固定配置）</li>
<li>手动分配：由DHCP服务器管理员专门指定IP地址（在服务器上进行IP&#x2F;MAC绑定）</li>
<li>动态分配：使用完后释放该IP，供其它客户机使用</li>
</ul>
</li>
</ul>
<h5 id="2、DHCP工作原理"><a href="#2、DHCP工作原理" class="headerlink" title="2、DHCP工作原理"></a>2、DHCP工作原理</h5><ul>
<li><p>DHCP协议采用UDP作为传输协议，主机发送请求消息到DHCP服务器的67号端口，DHCP服务器回应应答消息给主机的68号端口</p>
</li>
<li><p>客户机与DHCP服务器交互过程</p>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/20210727135147.png" alt="image-20210727135147033"></p>
<ul>
<li>DHCP Client以广播的方式发出DHCP Discover报文。 （DHCP Discover是广播）</li>
<li>所有的DHCP Server都能够接收到DHCP Client发送的DHCP Discover报文，所有的DHCP Server都会给出响应，向DHCP Client发送一个DHCP Offer报文。</li>
<li>DHCP Offer报文中“Your(Client) IP Address”字段就是DHCP Server能够提供给DHCP Client使用的IP地址，且DHCP Server会将自己的IP地址放在“option”字段中以便DHCP Client区分不同的DHCP Server。DHCP Server在发出此报文后会存在一个已分配IP地址的纪录。</li>
<li>DHCP Client只能处理其中的一个DHCP Offer报文，一般的原则是DHCP Client处理最先收到的DHCP Offer报文。</li>
<li>DHCP Client会发出一个广播的DHCP Request报文，在选项字段中会加入选中的DHCP Server的IP地址和需要的IP地址。 （DHCP Request是广播）</li>
<li>DHCP Server收到DHCP Request报文后，判断选项字段中的IP地址是否与自己的地址相同。如果不相同，DHCP Server不做任何处理只清除相应IP地址分配记录；如果相同，DHCP Server就会向DHCP Client响应一个DHCP ACK报文，并在选项字段中增加IP地址的使用租期信息</li>
</ul>
</li>
</ul>
<h4 id="二、部署DHCP服务器"><a href="#二、部署DHCP服务器" class="headerlink" title="二、部署DHCP服务器"></a>二、部署DHCP服务器</h4><h5 id="1、安装要求"><a href="#1、安装要求" class="headerlink" title="1、安装要求"></a>1、安装要求</h5><ul>
<li>服务器具有静态IP地址</li>
<li>在域环境下需要授权DHCP服务</li>
</ul>
<h5 id="2、部署过程"><a href="#2、部署过程" class="headerlink" title="2、部署过程"></a>2、部署过程</h5><ul>
<li><p>为服务器设置固定IP地址</p>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/20210728114935.png" alt="image-20210728114935590"></p>
</li>
<li><p>添加DHCP服务器角色，添加完成之后，直接下一步进行安装</p>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/20210728115117.png" alt="image-20210728115117379"></p>
</li>
</ul>
<h5 id="3、管理服务器"><a href="#3、管理服务器" class="headerlink" title="3、管理服务器"></a>3、管理服务器</h5><ul>
<li><p>新建作用域</p>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/20210728120213.png" alt="image-20210728120213067"></p>
</li>
<li><p>激活作用域</p>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/20210728120304.png" alt="image-20210728120304723"></p>
</li>
</ul>
<h4 id="三、分析DHCP流量"><a href="#三、分析DHCP流量" class="headerlink" title="三、分析DHCP流量"></a>三、分析DHCP流量</h4><h5 id="1、DHCP-Discover（广播）"><a href="#1、DHCP-Discover（广播）" class="headerlink" title="1、DHCP Discover（广播）"></a>1、DHCP Discover（广播）</h5><ul>
<li>客户端搜索发现DHCP服务器</li>
</ul>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/20210728121912.png" alt="image-20210728121912651"></p>
<h5 id="2、DHCP-Offer（广播）"><a href="#2、DHCP-Offer（广播）" class="headerlink" title="2、DHCP Offer（广播）"></a>2、DHCP Offer（广播）</h5><ul>
<li>DHCP服务器响应客户端</li>
</ul>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/20210728122134.png" alt="image-20210728122134561"></p>
<h5 id="3、DHCP-Request（广播）"><a href="#3、DHCP-Request（广播）" class="headerlink" title="3、DHCP Request（广播）"></a>3、DHCP Request（广播）</h5><ul>
<li>客户机请求DHCP服务器提供的IP地址</li>
</ul>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/20210728122452.png" alt="image-20210728122452811"></p>
<h5 id="4、DHCP-ACK（广播）"><a href="#4、DHCP-ACK（广播）" class="headerlink" title="4、DHCP ACK（广播）"></a>4、DHCP ACK（广播）</h5><ul>
<li>DHCP服务器收到客户机的请求后进行确认</li>
</ul>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/20210728122722.png" alt="image-20210728122722166"></p>
<h5 id="5、DHCP的8种报文"><a href="#5、DHCP的8种报文" class="headerlink" title="5、DHCP的8种报文"></a>5、DHCP的8种报文</h5><ul>
<li>DHCP DISCOVER：<ul>
<li>这是 DHCP 客户端首次登录网络时进行 DHCP 过程的第一个报文，用来寻找 DHCP 服务器。</li>
</ul>
</li>
<li>DHCP OFFER：<ul>
<li>DHCP服务器用来响应DHCP,DISCOVER报文，此报文携带了各种配置信息。</li>
</ul>
</li>
<li>DHCP REQUEST：此报文用于以下三种用途<ul>
<li>客户端初始化后，发送广播的 DHCP REQUEST 报文来回应服务器的 DHCP OFFER 报文。</li>
<li>客户端重启初始化后，发送广播的 DHCP REQUEST 报文来确认先前被分配的 IP 地址等配置信息。</li>
<li>当客户端已经和某个 IP 地址绑定后，发送 DHCP REQUEST 报文来延长 IP 地址的租期（一般情况下，租约时间到50%时，客户机会再次发送DHCP request报文）。</li>
</ul>
</li>
<li>DHCP ACK：<ul>
<li>服务器对客户端的 DHCP REQUEST 报文的确认响应报文，客户端收到此报文后，才真正获得了 IP 地址和相关的配置信息。</li>
</ul>
</li>
<li>DHCP NAK：<ul>
<li>服务器对客户端的 DHCP REQUEST 报文的拒绝响应报文，比如服务器对客户端分配的 IP 地址已超过使用租借期限（服务器没有找到相应的租约记录）或者由于某些原因无法正常分配 IP 地址，则发送 DHCP NAK 报文作为应答（客户端移到了另一个新的网络）。</li>
<li>通知 DHCP 客户端无法分配合适 IP 地址。DHCP 客户端需要重新发送DHCP DISCOVERY 报文来申请新的 IP 地址。</li>
</ul>
</li>
<li>DHCP DECLINE：<ul>
<li>当客户端发现服务器分配给它的 IP 地址发生冲突时会通过发送此报文来通知服务器，并且会重新向服务器申请地址。</li>
</ul>
</li>
<li>DHCP RELEASE：<ul>
<li>客户端可通过发送此报文主动释放服务器分配给它的 IP 地址，当服务器收到此报文后，可将这个 IP 地址分配给其它的客户端。</li>
</ul>
</li>
<li>DHCP INFORM：<ul>
<li>客户端已经获得了 IP 地址，发送此报文的目的是为了从服务器获得其他的一些网络配置信息，比如网关地址、DNS 服务器地址等。</li>
</ul>
</li>
</ul>
<h5 id="6、DHCP报文格式"><a href="#6、DHCP报文格式" class="headerlink" title="6、DHCP报文格式"></a>6、DHCP报文格式</h5><ul>
<li><p>DHCP服务的8种报文的格式是相同的，不同类型的报文只是报文中的某些字段取值不同</p>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/20211128230519.png" alt="image-20211128230519391"></p>
<ul>
<li>Message type：消息类型（1表示请求，2表示响应）</li>
<li>Hardware type：硬件类型（以太网接口类型为1）</li>
<li>Hardware address length：硬件地址长度</li>
<li>Hops：表示当前的DHCP报文经过的DHCP中继的数目。该字段由客户端或服务器设置为0，每经过一个DHCP中继时，该字段加1；此字段的作用是限制DHCP报文所经过的DHCP中继数目</li>
<li>Transaction ID：事务ID，由客户端选择的一个随机数，被服务器和客户端用来在它们之间交流请求和响应，客户端用它对请求和应答进行匹配；该ID由客户端设置并由服务器返回，为32位整数</li>
<li>Seconds elapsed：由客户端填充，表示从客户端开始获得IP地址或IP地址续借后所使用了的秒数</li>
<li>Bootp flags：此字段在BOOTP中保留未用，在DHCP中表示标志字段</li>
<li>Client IP address：客户机 IP 地址</li>
<li>Your (client) IP address：服务器分配给客户端的IP地址。当服务器进行DHCP响应时，将分配给客户端的IP地址填入此字段</li>
<li>Next server IP address：DHCP客户端获得启动配置信息的服务器的IP地址</li>
<li>Relay agent IP address：中继代理IP地址</li>
<li>Client MAC address：客户端MAC地址</li>
<li>Client hardware address padding：客户端硬件地址填充</li>
<li>Server host name not given：未给出服务器主机名</li>
<li>Boot file name not given：未给出引导文件名</li>
<li>Magic cookie：固定字节流，当server看到这个magic COOKIE固定字节流后，就能知道后面是options field</li>
<li>Option：参数字段</li>
</ul>
</li>
</ul>
<h4 id="四、模拟-DHCP-欺骗攻击"><a href="#四、模拟-DHCP-欺骗攻击" class="headerlink" title="四、模拟 DHCP 欺骗攻击"></a>四、模拟 DHCP 欺骗攻击</h4><h5 id="1、DHCP欺骗原理"><a href="#1、DHCP欺骗原理" class="headerlink" title="1、DHCP欺骗原理"></a>1、DHCP欺骗原理</h5><ul>
<li>伪造真实的DHCP服务器向主机分配IP，如果有多个DHCP服务器，用先收到的server的offer来获取IP</li>
</ul>
<h5 id="2、DHCP欺骗实验"><a href="#2、DHCP欺骗实验" class="headerlink" title="2、DHCP欺骗实验"></a>2、DHCP欺骗实验</h5><ul>
<li><p>实验场景</p>
<ul>
<li>一台 Windows 10 作为 client</li>
<li>一台 kali Linux 作为攻击主机</li>
<li>一台 Windows 2016 作为 DHCP server</li>
</ul>
</li>
<li><p>实验拓扑</p>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/20211128211056.png" alt="image-20211128211056328"></p>
</li>
<li><p>实验步骤</p>
<ul>
<li><p>在Windows server 2016上开启 DHCP 服务</p>
</li>
<li><p>在 R1 上开启 DHCP 中继，是 client 可以获取到 IPv4 参数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">R1(config)#int f0/0R1(config-if)#ip helper-address 192.168.2.100</span><br></pre></td></tr></table></figure>
</li>
<li><p>在kali Linux 上实施 DHCP DOS 攻击，使用 Yersinia 工具中的 DHCP 模块攻击，使 DHCP 服务器上地址耗尽</p>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/20211128211531.png" alt="image-20211128211531136"></p>
</li>
<li><p>查看 DHCP 服务器中地址使用情况</p>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/20211128211935.png" alt="image-20211128211935228"></p>
</li>
<li><p>确认 DHCP 服务器地址耗尽，将 kali Linux 伪装为 DHCP 服务器（伪装前，先停止 DHCP 攻击，因为攻击是发送的广播报文，没有停止容易造成自身崩溃）</p>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/20211128212302.png" alt="image-20211128212302360"></p>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/20211128212911.png" alt="image-20211128212910711"></p>
</li>
<li><p>客户机获取 IP 时就获取的是 kali Linux 伪装的 DHCP 服务器所提供的 IP 地址</p>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/20211128212801.png" alt="image-20211128212801432"></p>
</li>
</ul>
</li>
</ul>
<h4 id="五、DHCP-欺骗防护"><a href="#五、DHCP-欺骗防护" class="headerlink" title="五、DHCP 欺骗防护"></a>五、DHCP 欺骗防护</h4><h5 id="1、在交换机设备上配置信任端口"><a href="#1、在交换机设备上配置信任端口" class="headerlink" title="1、在交换机设备上配置信任端口"></a>1、在交换机设备上配置信任端口</h5><ul>
<li><p>启用DHCP监听</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Switch(config)#ip dhcp snooping</span><br></pre></td></tr></table></figure>
</li>
<li><p>设置DHCP监听作用于那个VLAN</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Switch(config)#ip dhcp snooping vlan 1        //可设置多个vlan</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置端口信任或非信任</p>
<ul>
<li>启用DHCP监听后，默认所有端口为非信任端口</li>
<li>配置端口为信任端口</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Switch(config-if)#ip dhcp snooping trust</span><br></pre></td></tr></table></figure>
</li>
<li><p>报文中插入选项82信息</p>
<ul>
<li>DHCP报文中的“选项82”<ul>
<li>选项中主要包括：DHCP请求报文进入设备的端口、属于的Vlan、交换机的MAC等信息</li>
<li>DHCP服务器可以根据这些信息更加精确的为客户端分配IP地址、设置策略等</li>
</ul>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Switch(config)#ip dhcp snooping information option</span><br></pre></td></tr></table></figure>
</li>
<li><p>限制DHCP报文速率，减缓DHCP耗尽攻击（在非信任端口配置）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Switch(config-if)#ip dhcp snooping limit rate 100        //速率单位pps</span><br></pre></td></tr></table></figure>
</li>
<li><p>启用核实MAC地址功能，避免DHCP耗尽攻击</p>
<ul>
<li>检测非信任端口的请求报文中源MAC地址和DHCP请求报文中的客户端MAC地址是否相同</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Switch(config)#ip dhcp snooping verify mac-address</span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="2、DHCP监听配置案例"><a href="#2、DHCP监听配置案例" class="headerlink" title="2、DHCP监听配置案例"></a>2、DHCP监听配置案例</h5><p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/20211202085018.png" alt="image-20211128211056328"></p>
<ul>
<li><p>在SW上启用DHCP监听，并将 SW 的 f0&#x2F;3 接口和 f0&#x2F;8 接口配置为信任端口</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Switch(config)#ip dhcp snooping                     //启用DHCP监听Switch(config)#ip dhcp snooping vlan 1Switch(config)#ip dhcp snooping information option         //启用“选项82”Switch(config)#interface fastEthernet 0/3Switch(config-if)#ip dhcp snooping trust             //设置信任端口Switch(config-if)#exitSwitch(config)#interface fastEthernet 0/8Switch(config-if)#ip dhcp snooping trust             //设置信任端口Switch(config-if)#exitSwitch(config)#interface range fastEthernet 0/1Switch(config-if-range)#ip dhcp snooping limit rate 100        //DHCP报文限速Switch(config-if-range)#exitSwitch(config)#ip dhcp snooping verify mac-address        //启用核实 MAC 地址功能</span><br></pre></td></tr></table></figure>
</li>
<li><p>查看监听表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Switch#show ip dhcp snooping binding</span><br></pre></td></tr></table></figure>
</li>
<li><p>清楚绑定表</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Switch#clear ip dhcp snooping binding</span><br></pre></td></tr></table></figure></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/10/22/%E6%B5%81%E9%87%8F%E6%94%BB%E5%87%BB-%E4%BC%A0%E8%BE%93%E5%B1%82%E5%8D%8F%E8%AE%AE%EF%BC%88udp%E5%8D%8F%E8%AE%AE%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="鹿祁">
      <meta itemprop="description" content="心有希冀，目有繁星，追光而遇，沐光而行">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鹿鹿祁">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/10/22/%E6%B5%81%E9%87%8F%E6%94%BB%E5%87%BB-%E4%BC%A0%E8%BE%93%E5%B1%82%E5%8D%8F%E8%AE%AE%EF%BC%88udp%E5%8D%8F%E8%AE%AE%EF%BC%89/" class="post-title-link" itemprop="url">流量攻击-传输层协议（udp协议）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-10-22 22:03:54 / 修改时间：22:29:42" itemprop="dateCreated datePublished" datetime="2023-10-22T22:03:54+08:00">2023-10-22</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="一、UDP-协议"><a href="#一、UDP-协议" class="headerlink" title="一、UDP 协议"></a>一、UDP 协议</h4><h5 id="1、UDP协议特点："><a href="#1、UDP协议特点：" class="headerlink" title="1、UDP协议特点："></a>1、UDP协议特点：</h5><ul>
<li>没有各种连接：在传输数据前不需要建立连接，也避免了后续的断开连接。</li>
<li>不重新排序：对到达顺序混乱的数据包不进行重新排序。</li>
<li>没有确认：发送数据包无须等待对方确认。因此，使用 UDP 协议可以随时发送数据，但无法保证数据能否成功被目标主机接收。</li>
</ul>
<h5 id="2、报文段"><a href="#2、报文段" class="headerlink" title="2、报文段"></a>2、报文段</h5><table>
<thead>
<tr>
<th>源端口号（16）</th>
<th>目标端口号（16）</th>
</tr>
</thead>
<tbody><tr>
<td>UDP长度（16）</td>
<td>UDP校验和（16）</td>
</tr>
</tbody></table>
<h5 id="3、字段含义"><a href="#3、字段含义" class="headerlink" title="3、字段含义"></a>3、字段含义</h5><ul>
<li>源端口：这个字段占据 UDP 报文头的前 16 位，通常包含发送数据报的应用程序所使用的 UDP 端口。接收端的应用程序利用这个字段的值作为发送响应的目的地址。这个字段是可选的，所以发送端的应用程序不一定会把自己的端口号写入该字段中。如果不写入端口号，则把这个字段设置为 0。这样，接收端的应用程序就不能发送响应了。</li>
<li>目的端口：接收端计算机上 UDP 软件使用的端口，占据 16 位。</li>
<li>长度：该字段占据 16 位，表示 UDP 数据报长度，包含 UDP 报文头和 UDP 数据长度。因为 UDP 报文头长度是 8 个字节，所以这个值最小为 8。</li>
<li>校验值：该字段占据 16 位，可以检验数据在传输过程中是否被损坏</li>
</ul>
<h5 id="4、常用的UDP端口号及其功能"><a href="#4、常用的UDP端口号及其功能" class="headerlink" title="4、常用的UDP端口号及其功能"></a>4、常用的UDP端口号及其功能</h5><table>
<thead>
<tr>
<th>端口</th>
<th>协议</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>53</td>
<td>DNS</td>
<td>域名系统</td>
</tr>
<tr>
<td>69</td>
<td>TFTP</td>
<td>简单文件传输协议</td>
</tr>
<tr>
<td>111</td>
<td>RPC</td>
<td>远程过程调用</td>
</tr>
<tr>
<td>123</td>
<td>NTP</td>
<td>网络时间协议</td>
</tr>
<tr>
<td>161</td>
<td>SNMP</td>
<td>简单网络管理协议</td>
</tr>
</tbody></table>
<h5 id="5、抓包分析（进行Windows-时间同步抓包进行分析）"><a href="#5、抓包分析（进行Windows-时间同步抓包进行分析）" class="headerlink" title="5、抓包分析（进行Windows 时间同步抓包进行分析）"></a>5、抓包分析（进行Windows 时间同步抓包进行分析）</h5><p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/20211101154952.png" alt="image-20211101154952396"></p>
<h4 id="二、实施UDP-Flood攻击"><a href="#二、实施UDP-Flood攻击" class="headerlink" title="二、实施UDP Flood攻击"></a>二、实施UDP Flood攻击</h4><h5 id="1、实验环境"><a href="#1、实验环境" class="headerlink" title="1、实验环境"></a>1、实验环境</h5><ul>
<li>一台kali Linux</li>
<li>一台 Windows server 2016（部署DNS服务器，IP：192.168.2.100）</li>
</ul>
<h5 id="2、实验步骤"><a href="#2、实验步骤" class="headerlink" title="2、实验步骤"></a>2、实验步骤</h5><ul>
<li><p>在 Windows server 2016 上部署 DNS 服务器，创建对应的区域文件，创建对应记录，使用客户端验证DNS服务器允许正常，也能够正常解析域名</p>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/20211130204344.png" alt="image-20211130204344049"></p>
</li>
<li><p>使用 kali Linux 实施 UDP Flood 攻击，多开几个终端同时攻击</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hping3 -q -n --rand-source --udp -p 53 --flood 192.168.2.100 -d 1000# -q    安静模式# -n    数字化输出，象征性输出主机地址# --rand-source        随机源地址# --udp        UDP模式# -p    目标端口# --flood    尽最快发送数据包，不显示回复# -d    发送数据包大小</span><br></pre></td></tr></table></figure>
</li>
<li><p>再使用客户去解析域名时发现会请求超时</p>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/20211130204414.png" alt="image-20211130204414224"></p>
</li>
</ul>
<h5 id="3、抓取流量分析"><a href="#3、抓取流量分析" class="headerlink" title="3、抓取流量分析"></a>3、抓取流量分析</h5><ul>
<li><p>在 Windows server 2016 上抓取流量，可以看出，kali Linux伪造了很多 IP 地址向服务器发起 DNS Query</p>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/20211101173047.png" alt="image-20211101173047424"></p>
</li>
</ul>
<h4 id="三、针对-UDP-Flood-防御"><a href="#三、针对-UDP-Flood-防御" class="headerlink" title="三、针对 UDP Flood 防御"></a>三、针对 UDP Flood 防御</h4><p><strong>UDP协议与TCP协议不同，是无连接状态的协议，因此针对UDPFlood的防护非常困难，UDP攻击是一种互损的攻击方式，消耗对方资源的同时也消耗攻击者本身的资源</strong></p>
<h5 id="1、使用防火墙防御-DDOS"><a href="#1、使用防火墙防御-DDOS" class="headerlink" title="1、使用防火墙防御 DDOS"></a>1、使用防火墙防御 DDOS</h5><ul>
<li><p>静态过滤：直接丢弃位于黑名单中的IP地址发出的流量，或者直接让位于白名单的IP地址发出的流量通过。</p>
</li>
<li><p>畸形报文过滤：过滤利用协议栈漏洞的畸形报文攻击。</p>
</li>
<li><p>扫描窥探报文过滤：过滤探测网络结构的扫描型报文和特殊控制报文。</p>
</li>
<li><p>源合法性认证：基于应用来认证报文源地址的合法性，这些应用支持协议交互。清洗设备通过发送源探测报文及检查响应报文来防范虚假源或工具发出的攻击流量。</p>
</li>
<li><p>基于会话防范：基于会话来防御并发连接、新建连接或异常连接超过阈值的连接耗尽类攻击。</p>
</li>
<li><p>特征识别过滤：主要靠指纹学习和抓包分析来获得流量特征，防范僵尸工具或通过代理发起的攻击流量，以区别正常用户的访问行为。</p>
</li>
<li><p>其中抓包分析是指对异常&#x2F;攻击流量抓包以生成抓包文件，通过对抓包文件进行解析和提取指纹，能够获取流量特征。</p>
<p>流量整形：流量经过此前各分层过滤之后，流量依然很大，超过用户实际带宽，此时采用流量整形技术，确保用户网络带宽可用。</p>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/10/22/%E6%B5%81%E9%87%8F%E6%94%BB%E5%87%BB-%E4%BC%A0%E8%BE%93%E5%B1%82%E5%8D%8F%E8%AE%AE%EF%BC%88tcp-syn-flood%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="鹿祁">
      <meta itemprop="description" content="心有希冀，目有繁星，追光而遇，沐光而行">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鹿鹿祁">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/10/22/%E6%B5%81%E9%87%8F%E6%94%BB%E5%87%BB-%E4%BC%A0%E8%BE%93%E5%B1%82%E5%8D%8F%E8%AE%AE%EF%BC%88tcp-syn-flood%EF%BC%89/" class="post-title-link" itemprop="url">流量攻击-传输层协议（tcp syn flood）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-10-22 22:03:42 / 修改时间：22:29:22" itemprop="dateCreated datePublished" datetime="2023-10-22T22:03:42+08:00">2023-10-22</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="一、实施-TCP-SYN-Flood-攻击"><a href="#一、实施-TCP-SYN-Flood-攻击" class="headerlink" title="一、实施 TCP SYN Flood 攻击"></a>一、实施 TCP SYN Flood 攻击</h4><h5 id="1、实验环境（电脑太卡，wireshark的其他报文没有截图）"><a href="#1、实验环境（电脑太卡，wireshark的其他报文没有截图）" class="headerlink" title="1、实验环境（电脑太卡，wireshark的其他报文没有截图）"></a>1、实验环境（电脑太卡，wireshark的其他报文没有截图）</h5><ul>
<li>一台 kali Linux 系统（包含工具 hping3 ），IP地址为：192.168.18.52</li>
<li>一台 server ，开启基于 TCP 的某个协议端口（这里以 HTTP 的 80 为例），IP地址为：192.168.18.38</li>
</ul>
<h5 id="2、实验步骤"><a href="#2、实验步骤" class="headerlink" title="2、实验步骤"></a>2、实验步骤</h5><ul>
<li><p>在 server 上开启 HTTP 服务，我这里使用的是 XAMPP</p>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/20211027142913.png" alt="image-20211027142912857"></p>
</li>
<li><p>在 kali Linux 上实施 SYN Flood</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hping3 -c 10000 -d 120 -S -w 64 -p 80 --flood --rand-source 192.168.18.38# -c 10000    发送的数据包数量# -d 120    发送到目标机器的每个数据包的大小# -S        只发送SYN数据包# -w 64     TCP窗口大小# -p 80     目的地端口(80是http端口)# --flood    尽可能快地发送数据包，不需要考虑显示入站回复。洪水攻击模式# --rand-source        使用随机性的源头IP地址# 192.168.18.38        目标IP地址或域名</span><br></pre></td></tr></table></figure></li>
</ul>
<h5 id="3、抓取流量分析"><a href="#3、抓取流量分析" class="headerlink" title="3、抓取流量分析"></a>3、抓取流量分析</h5><ul>
<li><p>在 server 上抓取流量，可以看出，kali Linux伪造了很多IP地址向 server 发起 SYN 请求</p>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/20211027145736.png" alt="image-20211027145736560"></p>
</li>
<li><p>提取其中一个伪造的 IP 地址，查看流量情况</p>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/20211027170542.png" alt="image-20211027170542502"></p>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/20211027171247.png" alt="image-20211027171247433"></p>
</li>
</ul>
<h4 id="二、防御-SYN-Flood"><a href="#二、防御-SYN-Flood" class="headerlink" title="二、防御 SYN Flood"></a>二、防御 SYN Flood</h4><h5 id="1、使用TCP代理"><a href="#1、使用TCP代理" class="headerlink" title="1、使用TCP代理"></a>1、使用TCP代理</h5><ul>
<li>TCP代理是指我们的防火墙部署在客户端和服务器中间，当客户端向服务器发送的SYN报文经过防火墙时，防火墙代替服务器与客户端建立三次握手。一般用于报文来回路径一致的场景。</li>
<li>工作过程<ul>
<li>防火墙收到SYN报文，对SYN报文进行拦截，代替服务器回应SYN+ACK报文。</li>
<li>如果客户端不能正常回应ACK报文，则判定此SYN报文为非正常报文，防火墙代替服务器保持半连接一定时间后，放弃此连接。</li>
<li>如果客户端正常回应ACK报文，防火墙与客户端建立正常的三次握手，则判定此SYN报文为正常业务报文，非攻击报文。防火墙立即与服务器再建立三次握手，此连接的后续报文直接送到服务器。</li>
</ul>
</li>
<li>整个TCP代理的过程对于客户端和服务器都是透明的。</li>
</ul>
<h5 id="2、TCP源探测"><a href="#2、TCP源探测" class="headerlink" title="2、TCP源探测"></a>2、TCP源探测</h5><ul>
<li>TCP源探测是防火墙防御SYN Flood攻击的另一种方式，没有报文来回路径必须一致的限制，所以应用普遍。</li>
<li>工作过程<ul>
<li>当防火墙收到客户端发送的SYN报文时，对SYN报文进行拦截，并伪造一个带有错误序列号的的SYN+ACK报文回应给客户端。</li>
<li>如果客户端是虚假源，则不会对错误的SYN+ACK报文进行回应。</li>
<li>如果客户端是真实源发送的正常请求SYN报文，当收到错误的SYN+ACK报文时，会再发出一个RST报文，让防火墙重新发一个正确的SYN+ACK报文；防火墙收到这个RST报文后，判定客户端为真实源，则将这个源加入白名单，在白名单老化前，这个源发出的报文都认为是合法的报文，防火墙直接放行，不在做验证。</li>
</ul>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/10/22/%E6%B5%81%E9%87%8F%E6%94%BB%E5%87%BB-%E4%BC%A0%E8%BE%93%E5%B1%82%E5%8D%8F%E8%AE%AE%EF%BC%88tcp%E5%8D%8F%E8%AE%AE%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="鹿祁">
      <meta itemprop="description" content="心有希冀，目有繁星，追光而遇，沐光而行">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鹿鹿祁">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/10/22/%E6%B5%81%E9%87%8F%E6%94%BB%E5%87%BB-%E4%BC%A0%E8%BE%93%E5%B1%82%E5%8D%8F%E8%AE%AE%EF%BC%88tcp%E5%8D%8F%E8%AE%AE%EF%BC%89/" class="post-title-link" itemprop="url">流量攻击-传输层协议（tcp协议）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-10-22 22:03:27 / 修改时间：22:29:02" itemprop="dateCreated datePublished" datetime="2023-10-22T22:03:27+08:00">2023-10-22</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="一、回顾传输层功能"><a href="#一、回顾传输层功能" class="headerlink" title="一、回顾传输层功能"></a>一、回顾传输层功能</h4><p><strong>传输层提供了主机应用程序进程之间的端到端的服务</strong></p>
<h5 id="1、基本功能"><a href="#1、基本功能" class="headerlink" title="1、基本功能"></a>1、基本功能</h5><ul>
<li>分割与重组数据</li>
<li>按端口号寻址</li>
<li>连接管理</li>
<li>差错控制和流量控制,纠错的功能</li>
</ul>
<h5 id="2、传输层提供的服务"><a href="#2、传输层提供的服务" class="headerlink" title="2、传输层提供的服务"></a>2、传输层提供的服务</h5><ul>
<li>传输连接服务：通常，对会话层要求的每个传输连接，传输层都要在网络层上建立相应的连接</li>
<li>数据传输服务：强调提供面向连接的可靠服务（很晚OSI才开始制定无连接服务的有关标准），并提供流量控制、差错控制和序列控制，以实现两个终端系统间传输的报文无差错、无丢失、无重复、无乱序</li>
</ul>
<h4 id="二、传输层-TCP-协议"><a href="#二、传输层-TCP-协议" class="headerlink" title="二、传输层 TCP 协议"></a>二、传输层 TCP 协议</h4><h5 id="1、面向连接的传输协议（TCP）传输控制协议："><a href="#1、面向连接的传输协议（TCP）传输控制协议：" class="headerlink" title="1、面向连接的传输协议（TCP）传输控制协议："></a>1、面向连接的传输协议（TCP）传输控制协议：</h5><ul>
<li>数据传输之前必须先建立连接,数据传输完成之后,必须释放连接。</li>
<li>仅支持单播传输：每条传输连接只能有两个端点，只能进行点对点的连接，不支持多播和广播的传输方式,UDP是支持的</li>
<li>在 TCP 协议中，通过三次握手建立连接。通信结束后，还需要断开连接。如果在发送数据包时，没有正确被发送到目的地时，将会重新发送数据包</li>
</ul>
<h5 id="2、UDP协议全称是用户数据报协议："><a href="#2、UDP协议全称是用户数据报协议：" class="headerlink" title="2、UDP协议全称是用户数据报协议："></a>2、UDP协议全称是用户数据报协议：</h5><ul>
<li>在网络中它与TCP协议一样用于处理数据包，是一种无连接的协议。</li>
<li>在OSI模型中，在第四层——传输层，处于IP协议的上一层。</li>
<li>UDP有不提供数据包分组、组装和不能对数据包进行排序的缺点，也就是说，当报文发送之后，是无法得知其是否安全完整到达的。</li>
<li>UDP用来支持那些需要在计算机之间传输数据的网络应用。包括网络视频会议系统在内的众多的客户&#x2F;服务器模式的网络应用都需要使用UDP协议</li>
</ul>
<h5 id="3、TCP报文段"><a href="#3、TCP报文段" class="headerlink" title="3、TCP报文段"></a>3、TCP报文段</h5><p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/20211026111838.png" alt="image-20211026111831751"></p>
<ul>
<li>字段含义<ul>
<li>TCP源端口（Source Port）：源计算机上的应用程序的端口号，占 16 位</li>
<li>TCP目的端口（Destination Port）：目标计算机的应用程序端口号，占 16 位</li>
<li>序号（Sequence Number）：占 32 位。它表示本报文段所发送数据的第一个字节的编号。在 TCP 连接中，所传送的字节流的每一个字节都会按顺序编号。当SYN标记不为1时，这是当前数据分段第一个字母的序列号；如果SYN的值是1时，这个字段的值就是初始序列值（ISN），用于对序列号进行同步。这时，第一个字节的序列号比这个字段的值大1，也就是ISN加1</li>
<li>TCP 确认号（Acknowledgment Number，ACK Number）：占 32 位。它表示接收方期望收到发送方下一个报文段的第一个字节数据的编号。其值是接收计算机即将接收到的下一个序列号，也就是下一个接收到的字节的序列号加1</li>
<li>TCP 首部长度（Header Length）：数据偏移是指数据段中的“数据”部分起始处距离 TCP 数据段起始处的字节偏移量，占 4 位。其实这里的“数据偏移”也是在确定 TCP 数据段头部分的长度，告诉接收端的应用程序，数据从何处开始</li>
<li>保留（Reserved）：占 4 位。为 TCP 将来的发展预留空间，目前必须全部为 0</li>
<li>URG（Urgent）：表示本报文段中发送的数据是否包含紧急数据。URG&#x3D;1 时表示有紧急数据。当 URG&#x3D;1 时，后面的紧急指针字段才有效</li>
<li>ACK：表示前面的确认号字段是否有效。ACK&#x3D;1 时表示有效。只有当 ACK&#x3D;1 时，前面的确认号字段才有效。TCP 规定，连接建立后，ACK 必须为 1</li>
<li>PSH（Push）：告诉对方收到该报文段后是否立即把数据推送给上层。如果值为 1，表示应当立即把数据提交给上层，而不是缓存起来</li>
<li>RST：表示是否重置连接。如果 RST&#x3D;1，说明 TCP 连接出现了严重错误（如主机崩溃），必须释放连接，然后再重新建立连接</li>
<li>SYN：在建立连接时使用，用来同步序号。当 SYN&#x3D;1，ACK&#x3D;0 时，表示这是一个请求建立连接的报文段；当 SYN&#x3D;1，ACK&#x3D;1 时，表示对方同意建立连接。SYN&#x3D;1 时，说明这是一个请求建立连接或同意建立连接的报文。只有在前两次握手中 SYN 才为 1</li>
<li>FIN：标记数据是否发送完毕。如果 FIN&#x3D;1，表示数据已经发送完成，可以释放连接</li>
<li>窗口大小（Window Size）：占 16 位。它表示从 Ack Number 开始还可以接收多少字节的数据量，也表示当前接收端的接收窗口还有多少剩余空间。该字段可以用于 TCP 的流量控制</li>
<li>校验和（TCP Checksum）：占 16 位。它用于确认传输的数据是否有损坏。发送端基于数据内容校验生成一个数值，接收端根据接收的数据校验生成一个值。两个值必须相同，才能证明数据是有效的。如果两个值不同，则丢掉这个数据包。Checksum 是根据伪头 + TCP 头 + TCP 数据三部分进行计算的</li>
<li>紧急指针（Urgent Pointer）：仅当前面的 URG 控制位为 1 时才有意义。它指出本数据段中为紧急数据的字节数，占 16 位。当所有紧急数据处理完后，TCP 就会告诉应用程序恢复到正常操作。即使当前窗口大小为 0，也是可以发送紧急数据的，因为紧急数据无须缓存</li>
<li>选项（Option）：长度不定，但长度必须是 32bits 的整数倍</li>
</ul>
</li>
</ul>
<h5 id="4、TCP建立连接的三次握手"><a href="#4、TCP建立连接的三次握手" class="headerlink" title="4、TCP建立连接的三次握手"></a>4、TCP建立连接的三次握手</h5><p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/20211026111934.png" alt="image-20211026111934441"></p>
<ul>
<li><p>第 1 次握手建立连接时，客户端向服务器发送 SYN 报文（SEQ&#x3D;x，SYN&#x3D;1），并进入 SYN_SENT 状态，等待服务器确认</p>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/20211026140447.png" alt="image-20211026140447458"></p>
</li>
<li><p>第 2 次握手实际上是分两部分来完成的，即 SYN+ACK（请求和确认）报文</p>
<ul>
<li>服务器收到了客户端的请求，向客户端回复一个确认信息（ACK&#x3D;x+1）。</li>
<li>服务器再向客户端发送一个 SYN 包（SEQ&#x3D;y）建立连接的请求，此时服务器进入 SYN_RECV 状态</li>
</ul>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/20211026140856.png" alt="image-20211026140856331"></p>
</li>
<li><p>第 3 次握手，是客户端收到服务器的回复（SYN+ACK 报文）。此时，客户端也要向服务器发送确认包（ACK）。此包发送完毕客户端和服务器进入 ESTABLISHED 状态，完成 3 次握手</p>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/20211026140945.png" alt="image-20211026140944974"></p>
</li>
</ul>
<h5 id="5、TCP断开连接的四次挥手（这里抓包是服务器向客户端发送断开请求）"><a href="#5、TCP断开连接的四次挥手（这里抓包是服务器向客户端发送断开请求）" class="headerlink" title="5、TCP断开连接的四次挥手（这里抓包是服务器向客户端发送断开请求）"></a>5、TCP断开连接的四次挥手（这里抓包是服务器向客户端发送断开请求）</h5><p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/20211026112025.png" alt="image-20210722150849030"></p>
<ul>
<li><p>第 1 次挥手，客户端向服务器端发送断开 TCP 连接请求的 [FIN，ACK] 报文，在报文中随机生成一个序列号 SEQ&#x3D;x，表示要断开 TCP 连接</p>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/20211026141149.png" alt="image-20211026141149651"></p>
</li>
<li><p>第 2 次挥手，当服务器端收到客户端发来的断开 TCP 连接的请求后，回复发送 ACK 报文，表示已经收到断开请求。回复时，随机生成一个序列号 SEQ&#x3D;y。由于回复的是客户端发来的请求，所以在客户端请求序列号 SEQ&#x3D;x的基础上加 1，得到 ACK&#x3D;x+1</p>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/20211026141243.png" alt="image-20211026141243186"></p>
</li>
<li><p>第 3 次挥手，服务器端在回复完客户端的 TCP 断开请求后，不会马上进行 TCP 连接的断开。服务器端会先确认断开前，所有传输到客户端的数据是否已经传输完毕。确认数据传输完毕后才进行断开，向客户端发送 [FIN，ACK] 报文，设置字段值为 1。再次随机生成一个序列号 SEQ&#x3D;z。由于还是对客户端发来的 TCP 断开请求序列号 SEQ&#x3D;x 进行回复，因此 ACK 依然为 x+1</p>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/20211026141420.png" alt="image-20211026141420260"></p>
</li>
<li><p>第 4 次挥手，客户端收到服务器发来的 TCP 断开连接数据包后将进行回复，表示收到断开 TCP 连接数据包。向服务器发送 ACK 报文，生成一个序列号 SEQ&#x3D;x+1。由于回复的是服务器，所以 ACK 字段的值在服务器发来断开 TCP 连接请求序列号 SEQ&#x3D;z 的基础上加 1，得到 ACK&#x3D;z+1</p>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/20211026141509.png" alt="image-20211026141509287"></p>
</li>
</ul>
<h5 id="6、TCP半关闭状态"><a href="#6、TCP半关闭状态" class="headerlink" title="6、TCP半关闭状态"></a>6、TCP半关闭状态</h5><ul>
<li>TCP连接只有一方发送了FIN，另一方没有发出FIN包，仍然可以在一个方向上正常发送数据</li>
</ul>
<h5 id="7、TCP半连接状态"><a href="#7、TCP半连接状态" class="headerlink" title="7、TCP半连接状态"></a>7、TCP半连接状态</h5><ul>
<li>发生在TCP3次握手中。如果客户端向服务端发起TCP请求，服务端也按照正常情况进行响应了，但是客户端不进行第3次握手，这就是半连接。半连接，会造成服务端分配的内存资源就一直这么耗着，直到资源耗尽（也就是常听说的SYN洪水攻击的原理）</li>
</ul>
<h5 id="8、常用的TCP端口号及其功能"><a href="#8、常用的TCP端口号及其功能" class="headerlink" title="8、常用的TCP端口号及其功能"></a>8、常用的TCP端口号及其功能</h5><table>
<thead>
<tr>
<th>端口</th>
<th>协议</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>21</td>
<td>FTP</td>
<td>FTP服务器所开放的控制端口</td>
</tr>
<tr>
<td>22</td>
<td>SSH</td>
<td>为远程登录会话和其他网络服务提供安全性的协议</td>
</tr>
<tr>
<td>23</td>
<td>TELNET</td>
<td>用于远程登录，可以远程控制管理目标计算机</td>
</tr>
<tr>
<td>25</td>
<td>SMTP</td>
<td>SMTP服务器开放的端口，用于发送邮件</td>
</tr>
<tr>
<td>53</td>
<td>DNS</td>
<td>DNS服务器开放的端口，用于区域传送</td>
</tr>
<tr>
<td>80</td>
<td>HTTP</td>
<td>超文本传输协议</td>
</tr>
<tr>
<td>110</td>
<td>POP3</td>
<td>用于邮件的接收</td>
</tr>
<tr>
<td>143</td>
<td>IMAP4</td>
<td>用于在线查看邮件</td>
</tr>
<tr>
<td>443</td>
<td>HTTPS</td>
<td>HTTP+SSL(TLS),提供安全的HTTP通道</td>
</tr>
<tr>
<td>3306</td>
<td>MySQL</td>
<td>MySQL服务器开放的默认端口</td>
</tr>
<tr>
<td>3389</td>
<td>RDP</td>
<td>远程桌面协议</td>
</tr>
</tbody></table>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/10/22/%E6%B5%81%E9%87%8F%E6%94%BB%E5%87%BB-%E7%BD%91%E7%BB%9C%E5%B1%82%E5%8D%8F%E8%AE%AE%EF%BC%88icmp%E9%87%8D%E5%AE%9A%E5%90%91%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="鹿祁">
      <meta itemprop="description" content="心有希冀，目有繁星，追光而遇，沐光而行">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鹿鹿祁">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/10/22/%E6%B5%81%E9%87%8F%E6%94%BB%E5%87%BB-%E7%BD%91%E7%BB%9C%E5%B1%82%E5%8D%8F%E8%AE%AE%EF%BC%88icmp%E9%87%8D%E5%AE%9A%E5%90%91%EF%BC%89/" class="post-title-link" itemprop="url">流量攻击-网络层协议（icmp重定向）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-10-22 22:03:08 / 修改时间：22:28:37" itemprop="dateCreated datePublished" datetime="2023-10-22T22:03:08+08:00">2023-10-22</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="二、ICMP-重定向"><a href="#二、ICMP-重定向" class="headerlink" title="二、ICMP 重定向"></a>二、ICMP 重定向</h4><p><strong>ICMP重定向报文是ICMP控制报文中的一种。在特定的情况下，当路由器检测到一台机器使用非优化路由的时候，它会向该主机发送一个ICMP重定向报文，请求主机改变路由。路由器也会把初始数据报向它的目的地转发</strong></p>
<h5 id="1、重定向案例分析"><a href="#1、重定向案例分析" class="headerlink" title="1、重定向案例分析"></a>1、重定向案例分析</h5><ul>
<li>案例环境</li>
</ul>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/20210914175158.png" alt="image-20210914175158804"></p>
<ul>
<li><p>案例分析</p>
<ul>
<li>如上图所示，主机PC要ping路由器R2的loopback 0地址：192.168.3.1，主机将判断出目标属于不同的网段，因此它要将 ICMP请求包发往自己的默认网关192.168.1.253（路由器R1的f0&#x2F;0接口）。但是，这之前主机PC首先必须发送ARP请求，请求路由器R1的 f0&#x2F;0（192.168.1.253）的MAC地址</li>
<li>当路由器R1收到此ARP请求包后，它首先用ARP应答包回答主机PC的ARP请求（通知主机PC：路由器R1自己的f0&#x2F;0接口的MAC地址）。然后， 它（路由器R1）将此ICMP请求转发到路由器R2的f0&#x2F;0接口：192.168.1.254（要求路由器R1正确配置了到网络 192.168.3.0&#x2F;24的路由）。此外，路由器R1还要发送一个ICMP重定向消息给主机PC，通知主机PC对于主机PC请求的地址的网关是： 192.168.1.254</li>
<li>路由器R2此时会发送一个ARP请求消息请求主机PC的MAC地址，而主机PC会发送ARP应答消息给路由器R2。最后路由器R2通过获得的主机PC的MAC地址信息，将ICMP应答消息发送给主机PC</li>
</ul>
</li>
<li><p>通过抓包分析</p>
<ul>
<li><p>整体报文情况</p>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/20211014152239.png" alt="image-20211014152239380"></p>
</li>
<li><p>请求报文：此请求报文没有对应的响应报文</p>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/20211014145449.png" alt="image-20211014145449679"></p>
</li>
<li><p>重定向报文：由网关响应给主机，将主机的 ICMP 请求进行重定向</p>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/20211014152457.png" alt="image-20211014152457232"></p>
</li>
<li><p>正常的 ICMP 请求报文：可以根据二层信息可以看出，目的MAC地址是 1.254 的 MAC 地址</p>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/20211014152712.png" alt="image-20211014152712312"></p>
</li>
</ul>
</li>
</ul>
<h4 id="三、实施-ICMP-重定向攻击（需要使用实体机验证）"><a href="#三、实施-ICMP-重定向攻击（需要使用实体机验证）" class="headerlink" title="三、实施 ICMP 重定向攻击（需要使用实体机验证）"></a>三、实施 ICMP 重定向攻击（需要使用实体机验证）</h4><h5 id="1、实验环境"><a href="#1、实验环境" class="headerlink" title="1、实验环境"></a>1、实验环境</h5><ul>
<li>一台 kali Linux 虚拟机，安装 netwox 工具（桥接）</li>
<li>一台 Windows 10 虚拟机（桥接）</li>
</ul>
<h5 id="2、实验步骤"><a href="#2、实验步骤" class="headerlink" title="2、实验步骤"></a>2、实验步骤</h5><ul>
<li><p>在 kali 上使用 netwox 工具实施 icmp 重定向网关</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#安装 netwox 工具apt-get install -y netwox#实施 ICMP 重定向，直接指定网关，使用 86 模块netwox 86 -g 192.168.188.2</span><br></pre></td></tr></table></figure>
</li>
<li><p>在 Windows 10 上通过 wireshark 抓包进行分析</p>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/20211025093706.png" alt="image-20211025093659217"></p>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/10/22/%E6%B5%81%E9%87%8F%E6%94%BB%E5%87%BB-%E7%BD%91%E7%BB%9C%E5%B1%82%E5%8D%8F%E8%AE%AE%EF%BC%88icmp%E5%8D%8F%E8%AE%AE%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="鹿祁">
      <meta itemprop="description" content="心有希冀，目有繁星，追光而遇，沐光而行">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鹿鹿祁">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/10/22/%E6%B5%81%E9%87%8F%E6%94%BB%E5%87%BB-%E7%BD%91%E7%BB%9C%E5%B1%82%E5%8D%8F%E8%AE%AE%EF%BC%88icmp%E5%8D%8F%E8%AE%AE%EF%BC%89/" class="post-title-link" itemprop="url">流量攻击-网络层协议（icmp协议）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-10-22 22:02:58 / 修改时间：22:28:14" itemprop="dateCreated datePublished" datetime="2023-10-22T22:02:58+08:00">2023-10-22</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="一、ICMP-基本概念"><a href="#一、ICMP-基本概念" class="headerlink" title="一、ICMP 基本概念"></a>一、ICMP 基本概念</h4><h5 id="1、ICMP-协议"><a href="#1、ICMP-协议" class="headerlink" title="1、ICMP 协议"></a>1、ICMP 协议</h5><ul>
<li><p>ICMP（Internet Control Message Protocol）Internet控制报文协议。它是TCP&#x2F;IP协议簇的一个子协议，用于在IP主机、路由器之间传递控制消息。控制消息是指网络通不通、主机是否可达、路由是否可用等网络本身的消息。这些控制消息虽然并不传输用户数据，但是对于用户数据的传递起着重要的作用</p>
</li>
<li><p>ICMP 协议属于网络层协议，封装在传输层与网络层之间</p>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/20210914155632.png" alt="image-20210914155632476"></p>
</li>
</ul>
<h5 id="2、ICMP-报文格式"><a href="#2、ICMP-报文格式" class="headerlink" title="2、ICMP 报文格式"></a>2、ICMP 报文格式</h5><ul>
<li><p>ICMP报文包含在IP数据报中，IP头部就在ICMP报文的前面</p>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/20210914162402.png" alt="image-20210914162402358"></p>
<ul>
<li>ICMP头部中的类型域用于说明ICMP报文的作用及格式，此外还有一个代码域用于详细说明某种ICMP报文的类型，所有数据都在ICMP头部后面</li>
</ul>
</li>
</ul>
<h4 id="二、分析ICMP流量"><a href="#二、分析ICMP流量" class="headerlink" title="二、分析ICMP流量"></a>二、分析ICMP流量</h4><h5 id="1、ICMP请求报文"><a href="#1、ICMP请求报文" class="headerlink" title="1、ICMP请求报文"></a>1、ICMP请求报文</h5><p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai202204010018346.png" alt="image-20220401001827226"></p>
<ul>
<li>Type：报文类型</li>
<li>Code：类型代码</li>
<li>Checksum：检验和</li>
<li>[Checksum Status: Good]：校验和状态</li>
<li>Identifier (BE)：标识符大端</li>
<li>Identifier (LE)：标识符小端</li>
<li>Sequence Number (BE)：序列号大端</li>
<li>Sequence Number (LE)：序列号小端</li>
<li>Data：数据字段</li>
</ul>
<h5 id="2、ICMP应答报文"><a href="#2、ICMP应答报文" class="headerlink" title="2、ICMP应答报文"></a>2、ICMP应答报文</h5><p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai202204010038936.png" alt="image-20220401003818855"></p>
<h5 id="3、13种ICMP报文类型"><a href="#3、13种ICMP报文类型" class="headerlink" title="3、13种ICMP报文类型"></a>3、13种ICMP报文类型</h5><table>
<thead>
<tr>
<th align="left">类型</th>
<th align="left">代码</th>
<th align="left">描述</th>
<th align="left">处理方法</th>
</tr>
</thead>
<tbody><tr>
<td align="left">0</td>
<td align="left">0</td>
<td align="left">回显应答</td>
<td align="left">用户进程</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left">0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15</td>
<td align="left">目的不可达： 网络不可达 主机不可达 协议不可达 端口不可达 需要进行分片但设置了不分片比特DF 源站选路失败 目的网络不认识 目的主机不认识 源主机被隔离（作废不用） 目的网络被强制禁止 目的主机被强制禁止 由于服务类型TOS，网络不可达 由于服务类型TOS，主机不可达 由于过滤，通信被强制禁止 主机越权 优先权中止生效</td>
<td align="left">“无路由到达主机” “无路由到达主机” “连接被拒绝” “连接被拒绝” “报文太长” “无路由到达主机” “无路由到达主机” “无路由到达主机” “无路由到达主机” “无路由到达主机” “无路由到达主机” “无路由到达主机” “无路由到达主机” （忽略） （忽略） （忽略）</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left">0</td>
<td align="left">源站被抑制(quench)</td>
<td align="left">TCP由内核处理，UDP则忽略</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left">0 1 2 3</td>
<td align="left">重定向 对网络重定向 对主机重定向 对服务类型和网络重定向 对服务类型和主机重定向</td>
<td align="left">内核更新路由表 内核更新路由表 内核更新路由表 内核更新路由表</td>
</tr>
<tr>
<td align="left">8</td>
<td align="left">0</td>
<td align="left">回显请求</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">9</td>
<td align="left">0</td>
<td align="left">路由通告</td>
<td align="left">用户进程</td>
</tr>
<tr>
<td align="left">10</td>
<td align="left">0</td>
<td align="left">路由请求</td>
<td align="left">用户进程</td>
</tr>
<tr>
<td align="left">11</td>
<td align="left">0 1</td>
<td align="left">超时传输 期间生存时间为0 在数据报组装期间生存时间为0</td>
<td align="left">用户进程 用户进程</td>
</tr>
<tr>
<td align="left">12</td>
<td align="left">0 1</td>
<td align="left">参数问题 坏的IP首部(包括各种差错) 缺少必须的选项</td>
<td align="left">“协议不可用” “协议不可用”</td>
</tr>
<tr>
<td align="left">13</td>
<td align="left">0</td>
<td align="left">时间戳请求</td>
<td align="left">内核产生应答</td>
</tr>
<tr>
<td align="left">14</td>
<td align="left">0</td>
<td align="left">时间戳应答</td>
<td align="left">用户进程</td>
</tr>
<tr>
<td align="left">15</td>
<td align="left">0</td>
<td align="left">信息请求(作废不用)</td>
<td align="left">(忽略)</td>
</tr>
<tr>
<td align="left">16</td>
<td align="left">0</td>
<td align="left">信息应答(作废不用)</td>
<td align="left">用户进程</td>
</tr>
<tr>
<td align="left">17</td>
<td align="left">0</td>
<td align="left">地址掩码请求</td>
<td align="left">内核产生应答</td>
</tr>
<tr>
<td align="left">18</td>
<td align="left">0</td>
<td align="left">地址掩码应答</td>
<td align="left">用户进程</td>
</tr>
</tbody></table>
<h4 id="三、常见的-ICMP-报文"><a href="#三、常见的-ICMP-报文" class="headerlink" title="三、常见的 ICMP 报文"></a>三、常见的 ICMP 报文</h4><h5 id="1、响应请求"><a href="#1、响应请求" class="headerlink" title="1、响应请求"></a>1、响应请求</h5><ul>
<li>ping命令，就是响应请求（Type&#x3D;8）和应答（Type&#x3D;0），一台主机向一个节点发送一个Type&#x3D;8的ICMP报文，如果途中没有异常，则目标返回Type&#x3D;0的ICMP报文，说明这台主机存在</li>
</ul>
<h5 id="2、目标不可到达"><a href="#2、目标不可到达" class="headerlink" title="2、目标不可到达"></a>2、目标不可到达</h5><ul>
<li>目标不可到达报文（Type&#x3D;3）在路由器或主机不能传递数据报时使用，例如我们要连接对方一个不存在的系统端口时，将返回Type&#x3D;3、Code&#x3D;3的ICMP报文。常见的不可到达类型还有网络不可到达 （Code&#x3D;0）、主机不可到达（Code&#x3D;1）、协议不可到达（Code&#x3D;2）等</li>
</ul>
<h5 id="3、源抑制"><a href="#3、源抑制" class="headerlink" title="3、源抑制"></a>3、源抑制</h5><ul>
<li>源抑制则充当一个控制流量的角色，它通知主机减少数据报流量，由于ICMP没有恢复传输的报文，所以只要停止该报文，主机就会逐渐恢复传输速率</li>
</ul>
<h5 id="4、超时报文"><a href="#4、超时报文" class="headerlink" title="4、超时报文"></a>4、超时报文</h5><ul>
<li>无连接方式网络的问题就是数据报会丢失，或者长时间在网络游荡而找不到目标，或者拥塞导致主机在规定时间内无法重组数据报分段，这时就要触发ICMP超时报文的产生。超时报文（Type&#x3D;11）的代码域有两种取值：Code&#x3D;0表示传输超时，Code&#x3D;1表示重组分段超时</li>
</ul>
<h5 id="5、时间戳"><a href="#5、时间戳" class="headerlink" title="5、时间戳"></a>5、时间戳</h5><ul>
<li>时间戳请求报文（Type&#x3D;13）和时间戳应答报文（Type&#x3D;14）用于测试两台主机之间数据报来回一次的传输时间。传输时，主机填充原始时间戳，接收方收到请求后填充接收时间戳后以Type&#x3D;14的报文格式返回，发送方计算这个时间差</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/10/22/%E6%B5%81%E9%87%8F%E6%94%BB%E5%87%BB-%E7%BD%91%E7%BB%9C%E5%B1%82%E5%8D%8F%E8%AE%AE%EF%BC%88arp%E6%94%BB%E5%87%BB%E4%B8%8E%E6%AC%BA%E9%AA%97%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="鹿祁">
      <meta itemprop="description" content="心有希冀，目有繁星，追光而遇，沐光而行">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鹿鹿祁">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/10/22/%E6%B5%81%E9%87%8F%E6%94%BB%E5%87%BB-%E7%BD%91%E7%BB%9C%E5%B1%82%E5%8D%8F%E8%AE%AE%EF%BC%88arp%E6%94%BB%E5%87%BB%E4%B8%8E%E6%AC%BA%E9%AA%97%EF%BC%89/" class="post-title-link" itemprop="url">流量攻击-网络层协议（arp攻击与欺骗）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-10-22 22:02:47 / 修改时间：22:27:53" itemprop="dateCreated datePublished" datetime="2023-10-22T22:02:47+08:00">2023-10-22</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="一、ARP-攻击"><a href="#一、ARP-攻击" class="headerlink" title="一、ARP 攻击"></a>一、ARP 攻击</h4><h5 id="1、使用-arpsnoof-工具"><a href="#1、使用-arpsnoof-工具" class="headerlink" title="1、使用 arpsnoof 工具"></a>1、使用 arpsnoof 工具</h5><ul>
<li><p>准备两台虚拟机，一台 win 10 作为被攻击主机，一台 kali Linux 作为攻击主机，确保两台主机都能上网，可以互相通信，我这里两台主机都使用 NAT 模式</p>
</li>
<li><p>在 kali Linux 上安装工具</p>
<ul>
<li><p>配置 apt 源</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">┌──(root@kali)-[/home/ka1]                    #注意，这里需要使用 root 用户登录 使用 sudo su└─# vim /etc/apt/sources.list#增加内容（中科院源）    deb https://mirrors.ustc.edu.cn/kali kali-rolling main non-free contrib    deb-src https://mirrors.ustc.edu.cn/kali kali-rolling main non-free contrib</span><br></pre></td></tr></table></figure>
</li>
<li><p>更新源</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">┌──(root@kali)-[/home/ka1/桌面]└─# apt-get update</span><br></pre></td></tr></table></figure>
</li>
<li><p>安装工具</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">┌──(root@kali)-[/home/ka1/桌面]└─# apt-get -y install dsniff</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h5 id="2、实施-ARP-攻击"><a href="#2、实施-ARP-攻击" class="headerlink" title="2、实施 ARP 攻击"></a>2、实施 ARP 攻击</h5><ul>
<li><p>确定 win 10 可以访问公网</p>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/20210913173558.png" alt="image-20210913173557834"></p>
</li>
<li><p>在 kali 上实施 ARP 攻击</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">┌──(root@kali)-[/home/ka1/桌面]└─# arpspoof -i eth0 -t 192.168.2.128 192.168.2.2#-i    接口名称#-t    攻击主机目标地址 攻击主机网关地址</span><br></pre></td></tr></table></figure>

<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/20210913173932.png" alt="image-20210913173932303"></p>
</li>
<li><p>再回到 win 10 主机上查看上网情况（可以看到，win 10 主机已经无法访问网络）</p>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/20210913174047.png" alt="image-20210913174047384"></p>
</li>
</ul>
<h5 id="3、流量分析"><a href="#3、流量分析" class="headerlink" title="3、流量分析"></a>3、流量分析</h5><ul>
<li><p>在 win 10 主机上使用 wireshark 工具进行流量抓取并筛选出 ARP 流量</p>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/20210914110905.png" alt="image-20210914110905678"></p>
</li>
<li><p>分析流量可以看出，攻击主机向本机（被攻击主机）发送 ARP 响应，并告知本机（被攻击主机）是来自网关的回应（携带了网关的 IP 地址）</p>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/20210914110701.png" alt="image-20210914110654434"></p>
</li>
</ul>
<h4 id="二、ARP-欺骗"><a href="#二、ARP-欺骗" class="headerlink" title="二、ARP 欺骗"></a>二、ARP 欺骗</h4><h5 id="1、使用-arpsnoof-工具-1"><a href="#1、使用-arpsnoof-工具-1" class="headerlink" title="1、使用 arpsnoof 工具"></a>1、使用 arpsnoof 工具</h5><h5 id="2、在-kali-上开启-ipv4-转发"><a href="#2、在-kali-上开启-ipv4-转发" class="headerlink" title="2、在 kali 上开启 ipv4 转发"></a>2、在 kali 上开启 ipv4 转发</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">┌──(root@kali)-[/home/ka1/桌面]└─# echo 1 &gt;&gt; /proc/sys/net/ipv4/ip_forward                    //这里使用重定向附加的方式在文件中增加内容</span><br></pre></td></tr></table></figure>

<h5 id="3、实施-ARP-欺骗"><a href="#3、实施-ARP-欺骗" class="headerlink" title="3、实施 ARP 欺骗"></a>3、实施 ARP 欺骗</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">┌──(root@kali)-[/home/ka1/桌面]└─# arpspoof -i eth0 -t 192.168.2.128 192.168.2.2#可实施正向和反向两种欺骗方式，主机在前网关在后，主机在后网关在前</span><br></pre></td></tr></table></figure>

<h5 id="4、使用-driftnet-工具"><a href="#4、使用-driftnet-工具" class="headerlink" title="4、使用 driftnet 工具"></a>4、使用 driftnet 工具</h5><ul>
<li><p>在 kali 上安装 driftnet 工具对 win 10 主机访问外网流量捕获图像并显示</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">┌──(root@kali)-[/home/ka1/桌面]└─# apt-get -y install driftnet</span><br></pre></td></tr></table></figure>
</li>
<li><p>在 kali 上检测 win 10 访问的图片并显示（使用 win 10 访问蜗牛学苑官方网站）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">┌──(root@kali)-[/home/ka1/桌面]└─# driftnet -i eth0</span><br></pre></td></tr></table></figure>

<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/20210914113717.png" alt="image-20210914113717691"></p>
</li>
</ul>
<h5 id="5、流量分析"><a href="#5、流量分析" class="headerlink" title="5、流量分析"></a>5、流量分析</h5><ul>
<li><p>在 win 10 主机上使用 wireshark 工具进行流量抓取并筛选出 ARP 流量</p>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/20210914114026.png" alt="image-20210914114026457"></p>
</li>
<li><p>分析流量可以看出，攻击主机 kali 不停的在向 win 10发送 ARP 回应包，告知 win 10它是网关，从而win 10访问互联网的流量就经由 kali 进行转发</p>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/20210914114416.png" alt="image-20210914114416392"></p>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/10/22/%E6%B5%81%E9%87%8F%E6%94%BB%E5%87%BB-%E7%BD%91%E7%BB%9C%E5%B1%82%E5%8D%8F%E8%AE%AE%EF%BC%88arp%E5%8D%8F%E8%AE%AE%E5%88%86%E6%9E%90%EF%BC%89/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="鹿祁">
      <meta itemprop="description" content="心有希冀，目有繁星，追光而遇，沐光而行">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鹿鹿祁">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/10/22/%E6%B5%81%E9%87%8F%E6%94%BB%E5%87%BB-%E7%BD%91%E7%BB%9C%E5%B1%82%E5%8D%8F%E8%AE%AE%EF%BC%88arp%E5%8D%8F%E8%AE%AE%E5%88%86%E6%9E%90%EF%BC%89/" class="post-title-link" itemprop="url">流量攻击-网络层协议（arp协议分析）</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-10-22 22:02:27 / 修改时间：22:27:15" itemprop="dateCreated datePublished" datetime="2023-10-22T22:02:27+08:00">2023-10-22</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="一、ARP-协议概述"><a href="#一、ARP-协议概述" class="headerlink" title="一、ARP 协议概述"></a>一、ARP 协议概述</h4><h5 id="1、什么是-ARP-协议"><a href="#1、什么是-ARP-协议" class="headerlink" title="1、什么是 ARP 协议"></a>1、什么是 ARP 协议</h5><ul>
<li>Address Resolution Protocol，地址解析协议，将一个已知的IP地址解析成MAC地址</li>
<li>ARP 协议通过 IP 地址向 MAC 地址的转换，解决网际层和网络访问层的衔接问题（网际层是 TCP&#x2F;IP 协议簇四层模型中的底层，是数据链路层和物理层的整合）</li>
<li>由于 IP 地址和 MAC 地址定位方式不同，ARP 协议成为数据传输的必备协议。主机发送信息前，必须通过 ARP 协议获取目标 IP 地址对应的 MAC 地址，才能正确地发送数据包。</li>
</ul>
<h5 id="2、为什么需要-ARP-协议"><a href="#2、为什么需要-ARP-协议" class="headerlink" title="2、为什么需要 ARP 协议"></a>2、为什么需要 ARP 协议</h5><ul>
<li>在网络访问层中，同一局域网中的一台主机要和另一台主机进行通信，需要通过 MAC 地址进行定位，然后才能进行数据包的发送。而在网络层和传输层中，计算机之间是通过 IP 地址定位目标主机，对应的数据报文只包含目标主机的 IP 地址，而没有 MAC 地址。因此，在发送之前需要根据 IP 地址获取 MAC 地址，然后才能将数据包发送到正确的目标主机，而这个获取过程是通过 ARP 协议完成的。</li>
</ul>
<h5 id="3、ARP-工作的基本流程"><a href="#3、ARP-工作的基本流程" class="headerlink" title="3、ARP 工作的基本流程"></a>3、ARP 工作的基本流程</h5><ul>
<li><p>ARP 工作流程分为两个阶段，一个是 ARP 请求（ARP广播）过程，另一个是 ARP 响应过程。</p>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/20210702152047.png" alt="image-20210702152046699"></p>
</li>
<li><p>如上图所示主机 A 与主机 B 进行通信，需要获取其 MAC 地址，基本流程如下：</p>
<ul>
<li>主机 A 以广播形式向网络中所有主机发送 ARP 请求，请求包中包含了目标 IP 地址 192.168.1.2。</li>
<li>主机 B 接收到请求，发现自己就是主机 A 要找的主机，返回响应，响应包中包含自己的 MAC 地址，其他主机收到默认将丢弃。</li>
</ul>
</li>
<li><p>使用两台虚拟机进行第一次通信，通过在源主机上使用 Wireshark 工具抓包如下图所示</p>
<ul>
<li><p>第一个包如下所示：ARP 请求包，A主机只知道B主机的 IP 地址，不知道 MAC 地址，以广播的方式发送 ARP 请求，物理地址不知道，用 6 组 0 进行填充</p>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/20210702153409.png" alt="img"></p>
</li>
<li><p>第二个包如下所示：ARP回应包，这时候 B 主机收到了 A 主机的请求报文，根据 IP 地址发现是在请求自己的 MAC 地址，从而做出回应</p>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/20210702154346.png" alt="image-20210702154346466"></p>
</li>
</ul>
</li>
</ul>
<h5 id="4、ARP分组的格式"><a href="#4、ARP分组的格式" class="headerlink" title="4、ARP分组的格式"></a>4、ARP分组的格式</h5><p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/20210707140903.png" alt="image-20210707140856444"></p>
<ul>
<li>以太网目的地址：是ARP请求的目的以太网地址，为全1时代表广播地址</li>
<li>以太网源地址：是发送ARP请求的以太网地址</li>
<li>帧类型：是后面的数据类型，ARP请求和ARP应答的这个值为 0x0806</li>
<li>硬件类型：表示硬件地址的类型，硬件地址不只以太网一种，当为以太网类型时此值为1</li>
<li>协议类型：表示要映射的协议地址的类型，要对IPv4地址进行映射，此值为 0x0800</li>
<li>硬件地址长度和协议地址长度：MAC地址占6字节，IP地址占4字节</li>
<li>op code：操作类型字段，值为1，表示进行ARP请求，值为2，表示进行ARP应答，值为3，表示进行RARP请求，值为4，表示进行RARP应答</li>
<li>发送端以太网地址：发送端ARP请求或应答的硬件地址，这里是以太网地址，和以太网源地址相同</li>
<li>发送端IP地址：发送ARP请求或应答的IP地址</li>
<li>目的以太网地址：目的端的硬件地址</li>
<li>目的IP地址：目的端的协议地址</li>
</ul>
<h5 id="5、ARP-缓存"><a href="#5、ARP-缓存" class="headerlink" title="5、ARP 缓存"></a>5、ARP 缓存</h5><ul>
<li>为了避免重复发送 ARP 请求，每台主机都有一个 ARP 高速缓存。当主机得到 ARP 响应后，将目标主机的 IP 地址和物理地址存入本机 ARP 缓存中，并保留一定时间。只要在这个时间范围内，下次请求 MAC 地址时，直接查询 ARP 缓存，而无须再发送 ARP 请求，从而节约了网络资源。</li>
</ul>
<h5 id="6、使用-ARP-命令"><a href="#6、使用-ARP-命令" class="headerlink" title="6、使用 ARP 命令"></a>6、使用 ARP 命令</h5><ul>
<li><p>Windows 系统中使用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#显示当前 ARP 项arp -a#清空 ARP 缓存，包括静态绑定 arp -d#添加静态绑定arp -s IP地址 MAC地址    举例：arp -s 192.168.1.2 00-0c-29-30-2d-24netsh -c “i i” add neighbors 192.168.233.169 00-0c-29-30-de-99</span><br></pre></td></tr></table></figure>
</li>
<li><p>思科设备上使用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#查看 ARP 缓存表Router#show arpProtocol  Address          Age (min)  Hardware Addr   Type   InterfaceInternet  192.168.1.1             0   0001.C730.2735  ARPA   GigabitEthernet0/0Internet  192.168.1.254           -   0030.A3D9.E201  ARPA   GigabitEthernet0/0#清除 ARP 缓存Router#clear arp-cache        //在模拟器上体现不明显#静态绑定 IP 和 MAC 对应关系Router(config)#arp 192.168.1.1 0001.C730.2735 arpa        //PT软件中不支持，可以使用 GNS3 来进行操作</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="二、ARP-攻击与欺骗"><a href="#二、ARP-攻击与欺骗" class="headerlink" title="二、ARP 攻击与欺骗"></a>二、ARP 攻击与欺骗</h4><h5 id="1、ARP-攻击原理"><a href="#1、ARP-攻击原理" class="headerlink" title="1、ARP 攻击原理"></a>1、ARP 攻击原理</h5><ul>
<li><p>首先明确ARP攻击发送的是ARP应答，但是ARP应答中的MAC地址为虚假地址，所以在其他主机想要进行通信时，会将目的MAC地址设置成此虚假MAC地址导致无法正常通信。</p>
</li>
<li><p>如下图所示：如果希望被攻击主机无法访问互联网，就需要对网关发送或被攻击主机发送虚假的ARP应答。当网关接收到虚假的ARP应答更新ARP条目后，如果网关再发生数据给PC1时，就会发送到虚假的MAC地址导致通信故障。</p>
</li>
</ul>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/20210702164638.png" alt="image-20210702164638510"></p>
<ul>
<li>例如张三要给李四打电话，他首先要知道李四的电话号码，这时有人告诉他李四的电话号码是12345678（不存在的号码），于是张三就把电话打到12345678，这样就无法找到李四了。</li>
</ul>
<h5 id="2、ARP-欺骗原理"><a href="#2、ARP-欺骗原理" class="headerlink" title="2、ARP 欺骗原理"></a>2、ARP 欺骗原理</h5><ul>
<li>欺骗网关<ul>
<li>如下图所示：目的是不为了让被攻击主机无法访问互联网，而是让被攻击主机访问互联网时的数据经过 PC2 再由网关转发到 Internet，所以这时被攻击主机 PC1 和 网关收到的都是真实的 MAC 地址，是攻击主机 PC2 的 MAC 地址</li>
</ul>
</li>
</ul>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/20210702165130.png" alt="image-20210702165130173"></p>
<ul>
<li>欺骗主机<ul>
<li>如下图所示：原理和欺骗网关一致，都是为了解惑被攻击主机发送给其他主机的数据流量</li>
</ul>
</li>
</ul>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/20210702165249.png" alt="image-20210702165249152"></p>
<p> <strong>ARP攻击最终的结果是导致网络中断，而ARP欺骗的最终结果是使得流量通过自身达到监控或控制的目的</strong></p>
<h4 id="三、ARP-攻击及欺骗防御手段"><a href="#三、ARP-攻击及欺骗防御手段" class="headerlink" title="三、ARP 攻击及欺骗防御手段"></a>三、ARP 攻击及欺骗防御手段</h4><p> <strong>不管是 ARP 攻击还是 ARP 欺骗都是伪造 ARP 应答来实现，那如果 PC 或网关在一开始就知道对方的 MAC 地址，那么就可以进行防御</strong></p>
<h5 id="1、防御手段"><a href="#1、防御手段" class="headerlink" title="1、防御手段"></a>1、防御手段</h5><ul>
<li>IP和MAC绑定，在主机上绑定网关的 MAC 并且在网关上绑定主机的 MAC</li>
<li>使用 ARP 防火墙</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/10/22/%E6%B5%81%E9%87%8F%E6%94%BB%E5%87%BB-%E7%A7%91%E6%9D%A5%E7%BD%91%E7%BB%9C%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="鹿祁">
      <meta itemprop="description" content="心有希冀，目有繁星，追光而遇，沐光而行">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鹿鹿祁">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/10/22/%E6%B5%81%E9%87%8F%E6%94%BB%E5%87%BB-%E7%A7%91%E6%9D%A5%E7%BD%91%E7%BB%9C%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7/" class="post-title-link" itemprop="url">流量攻击-科来网络分析工具</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-10-22 22:02:07 / 修改时间：22:26:42" itemprop="dateCreated datePublished" datetime="2023-10-22T22:02:07+08:00">2023-10-22</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="一、分析引导"><a href="#一、分析引导" class="headerlink" title="一、分析引导"></a>一、分析引导</h4><h5 id="1、分析模式"><a href="#1、分析模式" class="headerlink" title="1、分析模式"></a>1、分析模式</h5><ul>
<li><p>实时分析：实时分析以网络适配器作为数据采集来源，实时捕获网络通讯的数据包，并提供实时分析、实时诊断、实时报警等。</p>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai202204122127445.png" alt="image-20220412212708360"></p>
</li>
<li><p>回放分析：回放分析以数据包存储文件作为第二分析数据源，提供历史问题回溯分析，并支持原速和快速两种回放模式。</p>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai202204122127795.png" alt="image-20220412212733720"></p>
</li>
</ul>
<h5 id="2、选择网络适配器"><a href="#2、选择网络适配器" class="headerlink" title="2、选择网络适配器"></a>2、选择网络适配器</h5><ul>
<li><p>系统能够自动检测和显示当前的网络适配器及其 IP 地址、每秒数据包数，并图形化的显示当前网络适配器的流量趋势，您可以根据实际情况选择用于采集数据的网络适配器。</p>
</li>
<li><p>系统支持多网卡的数据采集，您可以同时选择多块网卡进行数据源的采集。</p>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai202204122129434.png" alt="image-20220412212958393"></p>
</li>
</ul>
<h5 id="3、开始分析"><a href="#3、开始分析" class="headerlink" title="3、开始分析"></a>3、开始分析</h5><ul>
<li><p>直接点击开始进行抓取数据包分析</p>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai202204122132021.png" alt="image-20220412213201956"></p>
</li>
</ul>
<h4 id="二、整体布局"><a href="#二、整体布局" class="headerlink" title="二、整体布局"></a>二、整体布局</h4><h5 id="1、标题栏"><a href="#1、标题栏" class="headerlink" title="1、标题栏"></a>1、标题栏</h5><p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai202204122155993.png" alt="image-20220412215514963"></p>
<ul>
<li>新建：创建一个新的工程</li>
<li>导出数据包：导出缓存中的数据包，保存到本地磁盘</li>
<li>定时分析：到达指定时间时，系统自动捕获数据并进行分析</li>
<li>全局配置导入导出<ul>
<li>导入配置：导入用户自定义的网络档案、分析方案、网络适配器等配置信息</li>
<li>导出配置：导出用户自定义的网络档案、分析方案、网络适配器等配置信息，方便下次重新调用</li>
</ul>
</li>
</ul>
<h5 id="2、功能区"><a href="#2、功能区" class="headerlink" title="2、功能区"></a>2、功能区</h5><ul>
<li><p>分析：包括数据包捕捉、网络档案设置、分析方案设置、数据存储设置、全局仪表盘以及数据包缓存状态显示，您可以从该栏中进行各项分析设置、快速查看网络全局利用率、每秒数据包、网络流量趋势以及数据包缓存状态等信息</p>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai202204122233162.png" alt="image-20220412223248845"></p>
</li>
<li><p>系统：包括协议解码器以及定时分析设置，此外，可以快速访问科来官方网站、CSNA 网络分析社区，重新注册、激活产品等</p>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai202204122233641.png" alt="image-20220412223352615"></p>
</li>
<li><p>工具：免费提供了 5 个网络小工具：Base64 编解码工具、科来Ping 工具、MAC 地址扫描器、数据生成器以及数据包播放器</p>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai202204122234538.png" alt="image-20220412223416498"></p>
</li>
<li><p>视图：提供了物理地址及 IP 地址的显示格式选择以及节点浏览器、警报视图、在线资源页面的显示或隐藏选择</p>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai202204122234150.png" alt="image-20220412223438123"></p>
</li>
</ul>
<h5 id="3、节点浏览器"><a href="#3、节点浏览器" class="headerlink" title="3、节点浏览器"></a>3、节点浏览器</h5><ul>
<li><p>可以按协议浏览、按物理端点浏览、按 IP 端点浏览、按 VoIP 通信节点浏览、按进程浏览、按应用浏览、按客户端浏览这 7 类方式，实时的反映网络中出现的协议、主机及该主机的物理地址和 IP 地址，主机当前是否正在通讯和通信进程。</p>
</li>
<li><p>节点浏览器以树状层级方式显示当前通讯的网络协议、物理地址、IP 地址和进程。通过节点浏览器，您可以快速定位和查看节点数据信息，如查看某个 IP 组信息、某个 VLAN 信息，单个 IP 地址、物理地址或协议的信息</p>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai202204122240077.png" alt="image-20220412224005030"></p>
</li>
</ul>
<h5 id="4、主视图区"><a href="#4、主视图区" class="headerlink" title="4、主视图区"></a>4、主视图区</h5><p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai202204122241742.png" alt="image-20220412224155678"></p>
<ul>
<li>我的图表<ul>
<li>系统默认提供了多个图表面板，您可以自定义添加图表面板，每个图表面板又可任意添加新的图表。除了添加全局的图表，您还可以从多个视图中对选中的网络对象进行图表创建并在图表视图中进行显示。</li>
<li>通过灵活的设置图表，您可以更直观的对所关心的网络对象和应用的重要流量参数进行实时的监控。</li>
</ul>
</li>
<li>概要统计<ul>
<li>对网络流量及常见网络应用进行详细的统计显示。通过概要统计视图，您可以快速的查看当前的网络流量、数据包大小分布、TCP 通讯情况、HTTP 通讯、DNS 通讯等多种类型的数据统计。</li>
<li>配合节点浏览器的使用，您可以快速查看单个网络对象或对象组的概要统计信息。在节点浏览器中选择某个网络对象，系统会自动过滤出该对象的统计数据，能极大的提高您的分析效率。</li>
</ul>
</li>
<li>诊断<ul>
<li>分为诊断分层、诊断发生地址以及详细事件描述 3 个分隔子窗口</li>
<li>诊断模块同样严格遵循 OSI 模型对网络事件进行分层显示：应用层、传输层、网络层、数据链路层</li>
</ul>
</li>
<li>协议<ul>
<li>提供全局的协议统计，遵循 OSI 七层协议分析，根据实际的网络协议封装顺序，不同的协议赋予不同的色彩，层次化的展现，并且，能够单独统计每一个层次下所使用的协议</li>
</ul>
</li>
<li>物理端点<ul>
<li>全新的物理端点视图，按 MAC 地址类型统计网络中物理端点之间的通讯情况，物理端点视图统计参数多达 46 种</li>
</ul>
</li>
<li>IP端点<ul>
<li>按 IP 类型统计 IP 地址之间的通讯情况。与物理端点视图类似，IP 端点的统计参数同样可以提供自定义统计参数显示以及按参数大小排序</li>
</ul>
</li>
<li>物理会话<ul>
<li>统提供全新的物理会话视图，详细统计网络中物理地址之间的通讯会话情况</li>
</ul>
</li>
<li>IP会话<ul>
<li>统计了 IP 地址间的通讯会话情况</li>
</ul>
</li>
<li>TCP会话<ul>
<li>提供了详细的 TCP 通讯会话分析</li>
</ul>
</li>
<li>UDP会话<ul>
<li>展现了网络中的 UDP 通讯情况</li>
</ul>
</li>
<li>服务<ul>
<li>展现了用户对外访问的服务类型情况</li>
</ul>
</li>
<li>端口<ul>
<li>用于实时显示网络中的端口流量统计信息，统计的端口包括 TCP 端口和UDP 端口</li>
</ul>
</li>
<li>VoIP呼叫<ul>
<li>用于实时显示网络中的 VoIP 呼叫统计信息</li>
</ul>
</li>
<li>进程<ul>
<li>提供了本机进程分析视图，能够帮助用户快速分析本地计算机的进程通信情况</li>
</ul>
</li>
<li>应用<ul>
<li>支持以应用为对象，进行网络通讯数据的分析和统计</li>
</ul>
</li>
<li>矩阵<ul>
<li>用于实时显示网络通讯的节点和会话信息</li>
<li>系统默认提供了 TOP 100 物理会话矩阵与物理节点矩阵以及 TOP 100 IPv4 会话矩阵与 IPv4 节点矩阵</li>
</ul>
</li>
<li>数据包<ul>
<li>可以详细查看网络中原始的数据包通讯情况，系统对每个数据包进行详细分析和界面，包括：概要解码，字段解码，十六制解码</li>
</ul>
</li>
<li>日志<ul>
<li>提供常见网络应用的日志显示及保存</li>
<li>每个日志由相应的分析模块提供，是否显示该日志由分析方案的设置决定</li>
<li>日志包括（全局日志、DNS 日志、Email 日志、HTTP 日志、FTP 日志、VoIP 信令事件日志、VoIP 呼叫日志）</li>
</ul>
</li>
<li>报表<ul>
<li>提供丰富的报表定制，可以生成各种统计数据的报表。并且，可以配合节点浏览器的选择，自定义生成各种网络对象的报表显示。</li>
</ul>
</li>
</ul>
<h5 id="5、警报浏览器"><a href="#5、警报浏览器" class="headerlink" title="5、警报浏览器"></a>5、警报浏览器</h5><ul>
<li><p>系统提供实时全局实时警报，以醒目的方式提醒管理员当前警报。并在主视图右下角显示当前触发的警报数量。</p>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai202204122304136.png" alt="image-20220412230431069"></p>
</li>
</ul>
<h5 id="6、状态栏"><a href="#6、状态栏" class="headerlink" title="6、状态栏"></a>6、状态栏</h5><p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai202204122305247.png" alt="image-20220412230547220"></p>
<ul>
<li>提供全局状态栏显示，状态栏包括以下信息<ul>
<li>当前分析模式与分析方案名称</li>
<li>网络适配器或回放文件再选择及状态显示</li>
<li>数据包捕捉过滤器状态显示与设置</li>
<li>工程数据统计，包括持续时间，包捕捉过滤统计</li>
<li>警报状态显示与设置</li>
</ul>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/10/22/%E6%B5%81%E9%87%8F%E6%94%BB%E5%87%BB-wireshark%E7%BD%91%E7%BB%9C%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="鹿祁">
      <meta itemprop="description" content="心有希冀，目有繁星，追光而遇，沐光而行">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="鹿鹿祁">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/10/22/%E6%B5%81%E9%87%8F%E6%94%BB%E5%87%BB-wireshark%E7%BD%91%E7%BB%9C%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7/" class="post-title-link" itemprop="url">流量攻击-wireshark网络分析工具</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2023-10-22 22:01:47 / 修改时间：22:26:21" itemprop="dateCreated datePublished" datetime="2023-10-22T22:01:47+08:00">2023-10-22</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h4 id="一、网络截获数据包的基础"><a href="#一、网络截获数据包的基础" class="headerlink" title="一、网络截获数据包的基础"></a>一、网络截获数据包的基础</h4><h5 id="1、以太网卡的工作模式"><a href="#1、以太网卡的工作模式" class="headerlink" title="1、以太网卡的工作模式"></a>1、以太网卡的工作模式</h5><p><strong>以太网卡在正常情况下只接收 MAC 地址与自己相匹配的数据帧（单播包），广播包，属于自己的组播包</strong></p>
<ul>
<li>网卡完成收发数据包的工作，两种接收模式<ul>
<li>混杂模式：不管数据帧中的目的地址是否与自己的地址匹配，都接收下来</li>
<li>非混杂模式：只接收目的地址相匹配的数据帧，以及广播数据包和组播数据包</li>
</ul>
</li>
</ul>
<h5 id="2、单播、组播、广播的概念"><a href="#2、单播、组播、广播的概念" class="headerlink" title="2、单播、组播、广播的概念"></a>2、单播、组播、广播的概念</h5><ul>
<li>单播：是在一个单个的发送者和一个接受者之间通过网络进行的通信</li>
<li>组播：它允许把 所发消息传送给所有可能目的地中的一个经过选择的子集，即向明确指出的多种地址输送信息</li>
<li>广播：在网络中只有一个单一的通信信道，由这个网络中所有的主机所共享</li>
</ul>
<h4 id="二、软件介绍"><a href="#二、软件介绍" class="headerlink" title="二、软件介绍"></a>二、软件介绍</h4><h5 id="1、简介"><a href="#1、简介" class="headerlink" title="1、简介"></a>1、简介</h5><ul>
<li>是一个网络封包分析软件。网络封包分析软件的功能是撷取网络封包，并尽可能显示出最为详细的网络封包资料。Wireshark使用WinPCAP作为接口，直接与网卡进行数据报文交换</li>
</ul>
<h5 id="2、界面功能介绍"><a href="#2、界面功能介绍" class="headerlink" title="2、界面功能介绍"></a>2、界面功能介绍</h5><p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/20211102115120.png" alt="image-20210709070844272"></p>
<h5 id="3、Wireshark过滤器"><a href="#3、Wireshark过滤器" class="headerlink" title="3、Wireshark过滤器"></a>3、Wireshark过滤器</h5><ul>
<li><p>捕获过滤器：在抓包之前设置，让Wireshark只抓取过滤器指定的包。</p>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/20211102172025.png" alt="image-20211102172025365"></p>
</li>
<li><p>显示过滤器：在抓包之前或者完成抓包之后都可，不影响抓包，只是方便查看。</p>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/20211102172217.png" alt="image-20211102172217707"></p>
</li>
</ul>
<h5 id="4、Wireshark抓包模式"><a href="#4、Wireshark抓包模式" class="headerlink" title="4、Wireshark抓包模式"></a>4、Wireshark抓包模式</h5><ul>
<li><p>在开始抓包之前还可修改Wireshark的抓包选项。通过工具栏或者菜单Capture-&gt;Options 打开抓包选项设置界面。这里可以设置很多选项，我们这里介绍一下 混杂模式 和 非混杂模式。</p>
<ul>
<li>混杂模式：抓取经过网卡的所有数据包，包括发往本网卡和非发往本网卡的。</li>
<li>非混杂模式：只抓取目标地址是本网卡的数据包，对于发往别的主机而经过本网卡的数据包忽略。</li>
</ul>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/20210709095037.png" alt="image-20210709095037654"></p>
</li>
</ul>
<h4 id="三、常见界面设置"><a href="#三、常见界面设置" class="headerlink" title="三、常见界面设置"></a>三、常见界面设置</h4><h5 id="1、列设置"><a href="#1、列设置" class="headerlink" title="1、列设置"></a>1、列设置</h5><ul>
<li><p>默认列（依次为：编号、时间、源地址、目的地址、协议、帧长度、信息）</p>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/20211102143407.png" alt="image-20211102143407222"></p>
</li>
<li><p>增加列</p>
<ul>
<li><p>如果想要增加列，可以根据数据包中的某个字段进行添加，例如：这里将 TTL 值添加为列</p>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/20211102145904.png" alt="image-20211102145904593"></p>
</li>
</ul>
</li>
</ul>
<h5 id="2、时间显示格式"><a href="#2、时间显示格式" class="headerlink" title="2、时间显示格式"></a>2、时间显示格式</h5><ul>
<li><p>默认显示的是从当前开始抓包，数据包产生的时间，我们在这里可以进行调整，设置为更方便的查看方式</p>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/20211102150629.png" alt="image-20211102150629465"></p>
</li>
<li><p>如果想要对两个数据包的时间间隔进行分析，可以通过设置时间参考来进行查看</p>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/20211102151517.png" alt="image-20211102151517457"></p>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/20211102151549.png" alt="image-20211102151549138"></p>
</li>
</ul>
<h5 id="3、名字解析"><a href="#3、名字解析" class="headerlink" title="3、名字解析"></a>3、名字解析</h5><ul>
<li><p>MAC 地址解析、网络名字解析、传输名字解析（默认只开启MAC地址解析）</p>
</li>
<li><p>开启方式（开启后也可能会出现解析错误并且资源消耗大）</p>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/20211102154059.png" alt="image-20211102154059219"></p>
</li>
</ul>
<h4 id="四、过滤器"><a href="#四、过滤器" class="headerlink" title="四、过滤器"></a>四、过滤器</h4><h5 id="1、捕获过滤器"><a href="#1、捕获过滤器" class="headerlink" title="1、捕获过滤器"></a>1、捕获过滤器</h5><p> <strong>当进行数据包捕获时，只有那些满足给定的包含&#x2F;排除表达式的数据包会被捕获，基于BPF语法（Berkeley Packet Filter）——基于libpcap&#x2F;wincap库，在抓包的过程中过滤掉某些类型的协议，不抓取过滤掉的协议</strong></p>
<ul>
<li><p>语法说明</p>
<ul>
<li>类型Type：host、net、port</li>
<li>方向Dir：src、dst</li>
<li>协议Proto：ether、ip、tcp、udp、http、ftp</li>
<li>逻辑运算符： &amp;&amp;与、||或、！非</li>
</ul>
</li>
<li><p>举例</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#抓取源地址为192.168.1.1，目的端口为80的流量src host 192.168.1.1 &amp;&amp; dst port 80 #抓取192.168.1.1和192.168.1.2的流量host 192.168.1.1 || host 192.168.1.2 #不要抓广播包！broadcast #抓取目的UDP端口为4569的封包udp dst port 4569#抓取目的或来源IP地址为192.168.4.7的封包host 192.168.4.7#抓取来源为TCP或UDP，并且端口在2000~5000范围内的封包src portrange 2000-5000#抓取来源IP地址为172.17.12.1，但目的地址不是192.168.2.0/24的封包src host 172.17.12.1 and not dst net 192.168.2.0/24#抓取来源IP为10.4.1.12或者来源网络为10.6.0.0/16，目的地TCP端口号在200至10000之间，并且目的位于网络10.0.0.0/8内的所有封包(src host 10.4.1.12 or src net 10.6.0.0/16) and tcp dst portrange 200-10000 and dst net 10.0.0.0/8</span><br></pre></td></tr></table></figure></li>
</ul>
<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/20211102171514.png" alt="image-20211102171514342"></p>
<h5 id="2、显示过滤器"><a href="#2、显示过滤器" class="headerlink" title="2、显示过滤器"></a>2、显示过滤器</h5><p> <strong>该过滤器根据指定的表达式用于在一个已捕获的数据包集合中，隐藏不想显示的数据包，或者只显示那些需要的数据包。</strong></p>
<ul>
<li><p>语法说明</p>
<ul>
<li>比较操作符：&#x3D;&#x3D; 等于（eq）、!&#x3D; 不等于（ne）、&gt; 大于（gt）、&lt; 小于（lt）、&gt;&#x3D; 大于等于（ge）、&lt;&#x3D; 小于等于（le）</li>
<li>逻辑操作符：and 两个条件同时满足、or 其中一个条件被满足、xor 有且仅有一个条件被满足、not 没有条件被满足</li>
<li>IP地址过滤：ip.addr、ip.src、ip.dst</li>
<li>端口过滤：tcp.port、tcp.srcport、tcp.dstport、tcp.flag.syn、tcp.flag.ack</li>
<li>协议过滤：arp、ip、icmp、udp、tcp、http、tls、………….等等</li>
</ul>
</li>
<li><p>举例</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#显示源IP等于192.168.1.100并且udp端口号为4000的封包ip.src == 192.168.1.100 and udp.port == 4000#显示SNMP或DNS或ICMP封包snmp || dns || icmp #显示来源或目的IP地址为10.1.1.1的封包ip.addr == 10.1.1.1#显示来源不为10.1.2.3或者目的不为10.4.5.6的封包ip.src != 10.1.2.3 or ip.dst != 10.4.5.6#显示来源不为10.1.2.3并且目的不为10.4.5.6的封包ip.src != 10.1.2.3 and ip.dst != 10.4.5.6#显示来源或目的UDP端口号为4569的封包udp.port eq 4569#显示目的TCP端口号为25的封包tcp.dstport == 25#显示带有TCP标志的封包tcp.flags#显示带有TCP SYN标志的封包tcp.flags.syn eq 0x02</span><br></pre></td></tr></table></figure>

<p><img src="https://woniumd.oss-cn-hangzhou.aliyuncs.com/security/yangwencai/20211102180701.png" alt="image-20211102180701347"></p>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/15/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/15/">15</a><span class="page-number current">16</span><a class="page-number" href="/page/17/">17</a><span class="space">&hellip;</span><a class="page-number" href="/page/22/">22</a><a class="extend next" rel="next" href="/page/17/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">鹿祁</p>
  <div class="site-description" itemprop="description">心有希冀，目有繁星，追光而遇，沐光而行</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">219</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">12</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">鹿祁</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  
  <script color='0,0,255' opacity='0.5' zIndex='-1' count='99' src="/lib/canvas-nest/canvas-nest.min.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>


  <script defer src="/lib/three/three.min.js"></script>


  















  

  

</body>
</html>
